apiVersion: skaffold/v2beta11
kind: Config
metadata:
  name: innovation-funding-service
profiles:
  - name: buildonly
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: false
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts:
        - image: data-service
          context: .
          custom:
            buildCommand: "gradle :ifs-data-layer:ifs-data-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: finance-data-service
          context: .
          custom:
            buildCommand: "gradle :ifs-data-layer:ifs-finance-data-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: survey-data-service
          context: .
          custom:
            buildCommand: "gradle :ifs-data-layer:ifs-survey-data-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: data-service-alerts
          context: .
          custom:
            buildCommand: "gradle :ifs-data-layer:data-service-alerts:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: sil-stub
          context: .
          custom:
            buildCommand: "gradle :ifs-sil-stub:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: registration-service
          context: .
          custom:
            buildCommand: "gradle :ifs-registration-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: survey-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-survey-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: project-setup-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-project-setup-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: project-setup-mgt-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-project-setup-mgt-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: front-door-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-front-door-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: competition-mgt-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-competition-mgt-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: assessment-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-assessment-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: application-service
          context: .
          custom:
            buildCommand: "gradle :ifs-web-service:ifs-application-service:test jib --image=$IMAGE -Pprofile=automated -Pcloud=automated -PtestGroups=dbpatch"
        - image: dbreset
          context: ifs-data-layer/ifs-data-service/src/main/resources
          docker:
            dockerfile: Dockerfile-dbreset
        - image: anonymised-db-data
          context: ifs-data-layer/ifs-data-service/src/main/docker/proxysql
          docker:
            dockerfile: Dockerfile-proxysql

  - name: custom
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: custom
      kustomize:
        paths:
          - os-files/kustomize/env/stub/custom

  - name: sysint
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: sysint
      kustomize:
        paths:
          - os-files/kustomize/env/aws/sysint

  - name: uat
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: uat
      kustomize:
        paths:
          - os-files/kustomize/env/aws/uat

  - name: demo
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: demo
      kustomize:
        paths:
          - os-files/kustomize/env/aws/demo

  - name: perf
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: perf
      kustomize:
        paths:
          - os-files/kustomize/env/aws/perf

  - name: prod
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: prod
      kustomize:
        paths:
          - os-files/kustomize/env/aws/prod
  - name: db-reset
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kustomize:
        paths:
          - os-files/kustomize/components/db-reset

  - name: local
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kubeContext: local
      kustomize:
        paths:
          - os-files/kustomize/env/stub/local/dev

  - name: anonymised-db-data
    build:
      local:
        useDockerCLI: false
        useBuildkit: false
        tryImportMissing: true
        push: true
      tagPolicy:
        gitCommit:
          ignoreChanges: true
      artifacts: []
    deploy:
      kustomize:
        paths:
          - os-files/kustomize/components/anonymised-db-data