//support tasks for executing scripts


task createTestSchema(type:Exec) {
    workingDir '../'
    commandLine 'docker-compose', '-f', 'docker-compose-services.yml', '-f', 'docker-compose-services-dev.yml', 'exec', '-T', 'mysql' ,'mysql' ,'-uroot' ,'-ppassword' ,'-e', 'create database if not exists ifs_test'
    doLast {
        exec {
            //wait for sql container to start.
            //TODO need better method of waiting for startup.
            workingDir '.'
            commandLine 'sleep', '10'
        }
    }
}

task createSchema(type:Exec) {
    workingDir '../'
    commandLine 'docker-compose', '-f', 'docker-compose-services.yml', '-f', 'docker-compose-services-dev.yml', 'exec', '-T', 'mysql' ,'mysql' ,'-uroot' ,'-ppassword' ,'-e', 'create database if not exists ifs'
    doLast {
        exec {
            //wait for sql container to start.
            //TODO need better method of waiting for startup.
            workingDir '.'
            commandLine 'sleep', '10'
        }
    }
}

task startMySql(type:Exec) {
    workingDir '../'
    commandLine 'docker-compose', '-f', 'docker-compose-services.yml', '-f', 'docker-compose-services-dev.yml', 'up', '-d', 'mysql'
    doLast {
        exec {
            //wait for sql container to start.
            //TODO need better method of waiting for startup.
            workingDir '.'
            commandLine 'sleep', '10'
        }
    }
}

task syncShib(type:Exec) {
    workingDir '../setup-files/scripts/docker'
    commandLine './syncShibServices.sh'
}

task loadShib(type:Exec) {
    workingDir '../setup-files/scripts/docker'
    commandLine './_load_shib.sh'
}