<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application Dashboard'" />
    <link href="/css/prototype.css" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="app-overview">

<th:block th:insert="prototypes/fragments/layout :: prototype-nav" />
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />


<main id="content">

	<th:block th:insert="prototypes/fragments/applicant-view :: prototype-subheader(${'Application overview'}, ${'/prototypes/IFS-1984-ps-dashboard'})" />


	<!-- HARDCODED PROTOTYPE HTML -->

    <th:block th:insert="prototypes/fragments/comp-admin :: prototype-comp-admin-page-title-subheading(${'Mobile Phone Data for Logistics Analytics'}, ${'Project details'}, ${null})" />

    <th:block th:unless="${param.user != null and param.user[0] == 'nonLead'}">
        <div class="message-alert">
            <p class="govuk-body">Please supply the following project details within 30 days of our successful notification.</p>
            <p class="govuk-body">We need this information before your project can begin.</p>
        </div>
    </th:block>

    <th:block th:if="${param.user != null and param.user[0] == 'nonLead'}">
        <div class="message-alert">
            <p class="govuk-body">The lead must supply the project details within 30 days of our successful notification.</p>
        </div>
    </th:block>

    <div class="success-alert hidden">
        <p class="govuk-body">Your project details are complete.</p>
        <p class="govuk-body">This can be edited up until your spend profile is generated.</p>
    </div>

	<h2 class="govuk-heading-m">Project information</h2>

	<p class="govuk-body" th:unless="${param.user != null and param.user[0] == 'nonLead'}">You are providing these details as the lead on behalf of the overall project.</p>

	<p class="govuk-body" th:unless="${param.user == null}">The lead must provide these details on behalf of the overall project.</p>

	<table>
		<thead>
			<tr>
				<th scope="col" style="width: 45%">Question</th>
				<th scope="col" style="width: 45%">Answer</th>
				<th scope="col" style="width: 10%">Submitted</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>
					<a href="/prototypes/IFS-1984-start-date" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Target start date</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Target start date</span>
				</td>
				<td id="start-date">
					-
				</td>
				<td>
					<span id="start-date-status" class="no">No</span>
				</td>
			</tr>
			<tr>
				<td>
					<a href="/prototypes/IFS-1984-project-address" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Project address</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Project address</span>
				</td>
				<td id="project-address">
					-
				</td>
				<td>
					<span id="project-address-status" class="no">No</span>
				</td>
			</tr>
			<tr>
				<td>
					<a href="/prototypes/IFS-1984-project-manager" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Project manager</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Project manager</span>
				</td>
				<td id="project-manager">
					-
				</td>
				<td>
					<span id="project-manager-status" class="no">No</span>
				</td>
			</tr>

		</tbody>
	</table>

	<h2 class="govuk-heading-m">Finance contacts</h2>

	<p class="govuk-body">Each partner must provide a finance contact. We will contact them with any queries around partner finances.</p>

	<table>
		<thead>
			<tr>
				<th scope="col" style="width: 45%">Partner</th>
				<th scope="col" style="width: 45%">Finance contact</th>
				<!-- <th scope="col" style="width: 15%">Turnover</th>
				<th scope="col" style="width: 15%">Staff headcount</th> -->
				<th scope="col" style="width: 10%">Submitted</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>
					<a href="/prototypes/IFS-1984-project-finance-contact" th:unless="${param.user != null and param.user[0] == 'nonLead'}" >Aptrans Ltd</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Aptrans Ltd</span>
				</td>
				<td>
					<span id="finance-contact">John Smith</span>
				</td>
				<!-- <td>
					<span id="finance-turnover">-</span>
				</td>
				<td>
					<span id="finance-headcount">-</span>
				</td> -->
				<td>
					<span id="finance-contact-status" class="yes">Yes</span>
				</td>
			</tr>
			<tr>
				<td>
					<span th:unless="${param.user != null and param.user[0] == 'nonLead'}">Biotech Corp</span>
					<a href="/prototypes/IFS-1984-project-finance-contact?user=nonLead" th:unless="${param.user == null or param.user[0] != 'nonLead'}">Biotech Corp</a>
				</td>
				<td>
					<span id="finance-partner-contact">-</span>
				</td>
				<!-- <td>
					<span id="finance-partner-turnover">-</span>
				</td>
				<td>
					<span id="finance-partner-headcount">-</span>
				</td> -->
				<td>
					<span id="finance-partner-contact-status" class="no">No</span>
				</td>
			</tr>
		</tbody>
	</table>

    <div class="extra-margin">

        <form action="/prototypes/IFS-1984-ps-dashboard">
            <input type="hidden" name="status" id="statusUpdate" value="">
            <button class="button button-large" th:unless="${param.user != null and param.user[0] == 'nonLead'}" disabled="disabled">Begin project setup</button>
        </form>

    </div>


	<!-- END OFHARDCODED PROTOTYPE HTML -->

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
<script src="/js/ifs_prototype/prototype.js" type="text/javascript"></script>

<script type="text/javascript">
	// <![CDATA[
	jQuery(document).ready(function(){

		function $_GET(param) {
	        var vars = {};
	        window.location.href.replace( location.hash, '' ).replace(
	            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
	            function( m, key, value ) { // callback
	                vars[key] = value !== undefined ? value : '';
	            }
	        );

	        if ( param ) {
	            return vars[param] ? vars[param] : null;
	        }
	        return vars;
	    }

		var startDay = $_GET('start-day'),
			startMonth = $_GET('start-month'),
			startYear = $_GET('start-year'),
			street = $_GET('street'),
			town = $_GET('town'),
			postcode = $_GET('postcode'),
			pmName = $_GET('pm-name-group'),
			pmNamePending = $_GET('name-pm1'),
			financesName = $_GET('finances-name-group'),
			financesNamePending = $_GET('name-finance-contact1'),
			financesTurnover = $_GET('finance-turnover'),
			financesHeadcount = $_GET('finance-headcount'),
			userType = $_GET('user'),
            resetStorage = $_GET('status');

        var m_names = new Array("Jan", "Feb", "Mar","Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec");


		if (resetStorage != null && resetStorage == 'reset'){
            window.localStorage.clear();
        }

		if (startDay != null || startMonth != null || startYear != null){
			localStorage.setItem('startDate', startDay+' '+ m_names[startMonth - 1] +' '+startYear)
		}
		var startDate = localStorage.getItem('startDate');


		if (postcode != null){
			localStorage.setItem('projectAddress', street+','+town+','+postcode)
		}
		var projectAddress = localStorage.getItem('projectAddress');


		if (pmName != null){
			localStorage.setItem('pmName', pmName);
			localStorage.removeItem('pmNamePending');
		}
		var pmName = localStorage.getItem('pmName');


		if (pmNamePending != null){
			localStorage.setItem('pmNamePending', pmNamePending);
			localStorage.removeItem('pmName');
		}
		var pmNamePending = localStorage.getItem('pmNamePending');


		if (financesName != null && userType == null){
			localStorage.setItem('financesName', financesName);
			localStorage.removeItem('financesNamePending');
		}else if(financesName != null && userType == 'nonLead'){
			localStorage.setItem('financesPartnerName', financesName);
			localStorage.removeItem('financesPartnerNamePending');
		}
		var financesName = localStorage.getItem('financesName');
		var financesPartnerName = localStorage.getItem('financesPartnerName');

		if (financesNamePending != null && userType == null){
			localStorage.setItem('financesNamePending', financesNamePending);
			localStorage.removeItem('financesName');
		}else if (financesNamePending != null && userType == 'nonLead'){
			localStorage.setItem('financesPartnerNamePending', financesNamePending);
			localStorage.removeItem('financesPartnerName');
		}
		var financesNamePending = localStorage.getItem('financesNamePending');
		var financesPartnerNamePending = localStorage.getItem('financesPartnerNamePending');


		if(startDate == null){
			jQuery('#start-date').text('-');
			jQuery('#start-date-status').text('No');
			jQuery('#start-date-status').addClass('no');
			jQuery('#start-date-status').removeClass('yes');
		}else{
			jQuery('#start-date').text(startDate);
			jQuery('#start-date-status').text('Yes');
			jQuery('#start-date-status').addClass('yes');
			jQuery('#start-date-status').removeClass('no');

		}

		if(projectAddress == null){
			jQuery('#project-address').text('-');
			jQuery('#project-address-status').text('No');
			jQuery('#project-address-status').addClass('no');
			jQuery('#project-address-status').removeClass('yes');
		}else{
			jQuery('#project-address').text(projectAddress.replace(/\+/g,' '));
			jQuery('#project-address-status').text('Yes');
			jQuery('#project-address-status').addClass('yes');
			jQuery('#project-address-status').removeClass('no');

		}

		if(pmName == null){
			jQuery('#project-manager').text('-');
			jQuery('#project-manager-status').text('No');
			jQuery('#project-manager-status').addClass('no');
			jQuery('#project-manager-status').removeClass('yes');
		}else{
			jQuery('#project-manager').text(pmName.replace(/\+/g,' '));

			if(pmNamePending == null){
				jQuery('#project-manager-status').text('Yes');
				jQuery('#project-manager-status').addClass('yes');
				jQuery('#project-manager-status').removeClass('no');

			}else{
				jQuery('#project-manager').text(pmNamePending.replace(/\+/g,' '));
				jQuery('#project-manager-status').text('Pending');
				jQuery('#project-manager-status').removeClass('yes');
				jQuery('#project-manager-status').removeClass('no');
			}
		}

        if(startDate == null || projectAddress == null || pmName == null || financesName == null){
            jQuery(".button-large").attr("disabled", "disabled");
            jQuery(".link-back").attr("href", "#");
            jQuery(".link-back").text("Dashboard");
        }else{
            if(financesPartnerName != null){
                jQuery(".success-alert").removeClass('hidden');
                jQuery(".message-alert").hide();
                jQuery("#statusUpdate").attr("value", "detailsComplete");
                jQuery(".link-back").attr("href", "/prototypes/IFS-1984-ps-dashboard?status=detailsComplete");
                jQuery(".link-back").text("Application overview");
            }else{
                jQuery("#statusUpdate").attr("value", "detailsNotComplete");
                jQuery(".link-back").attr("href", "/prototypes/IFS-1984-ps-dashboard?status=detailsNotComplete");
                jQuery(".link-back").text("Application overview");
            }
            jQuery(".button-large").removeAttr("disabled");
        }

		if(financesName == null && userType == null){
			jQuery('#finance-contact').text('-');
			jQuery('#finance-contact-status').text('No');
			jQuery('#finance-contact-status').addClass('no');
			jQuery('#finance-contact-status').removeClass('yes');

		}else if(financesName != null && userType == null){

			jQuery('#finance-contact').text(financesName.replace(/\+/g,' '));
			jQuery('#finance-partner-contact').text(financesPartnerName.replace(/\+/g,' '));

			if(financesNamePending == null){
				jQuery('#finance-contact-status').text('Yes');
				jQuery('#finance-contact-status').addClass('yes');
				jQuery('#finance-contact-status').removeClass('no');
			}else{
				jQuery('#finance-contact').text(financesNamePending.replace(/\+/g,' '));
				jQuery('#finance-contact-status').text('Pending');
				jQuery('#finance-contact-status').removeClass('yes');
				jQuery('#finance-contact-status').removeClass('no');
			}

            if(financesPartnerName != null){
                if(financesPartnerNamePending == null){
                    jQuery('#finance-partner-contact-status').text('Yes');
                    jQuery('#finance-partner-contact-status').addClass('yes');
                    jQuery('#finance-partner-contact-status').removeClass('no');
                }else{
                    jQuery('#finance-partner-contact').text(financesPartnerNamePending.replace(/\+/g,' '));
                    jQuery('#finance-partner-contact-status').text('Pending');
                    jQuery('#finance-partner-contact-status').removeClass('yes');
                    jQuery('#finance-partner-contact-status').removeClass('no');
                }
            }
		}

		if(financesPartnerName == null && userType == 'nonLead'){
			jQuery('#finance-partner-contact').text('-');
			jQuery('#finance-partner-contact-status').text('No');
			jQuery('#finance-partner-contact-status').addClass('no');
			jQuery('#finance-partner-contact-status').removeClass('yes');


		}else if(financesPartnerName != null && userType == 'nonLead'){

			jQuery('#finance-partner-contact').text(financesPartnerName.replace(/\+/g,' '));

			//jQuery('#finance-partner-turnover').text(financesTurnoverNonLead);
			//jQuery('#finance-turnover').text(financesTurnoverLead);
			//jQuery('#finance-partner-headcount').text(financesHeadcountPartner);
			//jQuery('#finance-headcount').text(financesHeadcountLead);


			if(financesPartnerNamePending == null){
				jQuery('#finance-partner-contact-status').text('Yes');
				jQuery('#finance-partner-contact-status').addClass('yes');
				jQuery('#finance-partner-contact-status').removeClass('no');
			}else{
				jQuery('#finance-partner-contact').text(financesPartnerNamePending.replace(/\+/g,' '));
				jQuery('#finance-partner-contact-status').text('Pending');
				jQuery('#finance-partner-contact-status').removeClass('yes');
				jQuery('#finance-partner-contact-status').removeClass('no');
			}
		}


		jQuery('#add-finance-contact').on('click',function(e){
			e.preventDefault();
			jQuery('#finance-contact-table').show();

		});

		jQuery('#invite-finance-contact').on('click',function(e){
			e.preventDefault();

			var financeContact = jQuery('#name-finance-contact1').val();

			jQuery('#finance-name').text(financeContact + ' (Pending)')
			jQuery("#finances-name-invite").attr('checked', 'checked');
			jQuery('#finance-contact-table').hide();
			jQuery('#invited-finance-contact').show();

		});



		jQuery('#add-pm').on('click',function(e){
			e.preventDefault();
			jQuery('#pm-table').show();

		});

		jQuery('#invite-pm').on('click',function(e){
			e.preventDefault();
			jQuery('#pm-table').hide();
		});


		jQuery('#postcode-lookup').on('click',function(e){
			e.preventDefault();
			jQuery("#select-address-block").show();
		});

		jQuery('#select-address').on('change',function(e){
			e.preventDefault();
			jQuery("#address-details").show();
			jQuery("#street").val("4 Station Road");
			jQuery("#county").val("Wiltshire");
			jQuery("#town").val("Swindon");
			jQuery("#postcode").val("SN1 2BD");

		});

		jQuery('#enter-address-manually').on('click',function(e){
			e.preventDefault();
			jQuery("#address-details").show();
			jQuery("#select-address-block").hide();
		});



	});
	// ]]>
</script>
</body>
</html>
