<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application Dashboard'" />
    <link href="/css/prototype.css" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="app-overview">

<th:block th:insert="prototypes/fragments/layout :: prototype-nav" />
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />


<main id="content">

	<th:block th:insert="prototypes/fragments/applicant-view :: prototype-subheader(${'Set up your project'}, ${(param.user != null and param.user[0] == 'nonLead' ? '/prototypes/1588-project-status?user=nonLead':'/prototypes/1588-project-status')})" />


	<!-- HARDCODED PROTOTYPE HTML -->
	<th:block th:insert="prototypes/fragments/applicant-view :: prototype-project-page-title(${'projectSetup'}, ${'Project details'})" />

	<p class="govuk-body">Please supply the following details for your project and the team. We need these to set up your project.</p>

	<h2 class="govuk-heading-m">Project details</h2>

	<p class="govuk-body" th:unless="${param.user != null and param.user[0] == 'nonLead'}">You are providing these details as the lead applicant on behalf of the overall project.</p>

	<p class="govuk-body" th:unless="${param.user == null}">The lead partner will provide these details on behalf of the project..</p>

	<table class="govuk-table">
		<thead class="govuk-table__head">
			<tr class="govuk-table__row">
				<th scope="col" style="width: 45%">Question</th>
				<th scope="col" style="width: 45%">Answer</th>
				<th scope="col" style="width: 10%">Submitted</th>
			</tr>
		</thead>
		<tbody class="govuk-table__body">
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					<a href="/prototypes/1575-start-date" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Target start date</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Target start date</span>
				</td>
				<td id="start-date">
					&nbsp;
				</td>
				<td class="govuk-table__cell">
					<span id="start-date-status">&nbsp;</span>
				</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					<a href="/prototypes/1575-project-address" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Project address</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Project address</span>
				</td>
				<td id="project-address">
					&nbsp;
				</td>
				<td class="govuk-table__cell">
					<span id="project-address-status">&nbsp;</span>
				</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					<a href="/prototypes/1575-project-manager" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Project manager</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Project manager</span>
				</td>
				<td id="project-manager">
					&nbsp;
				</td>
				<td class="govuk-table__cell">
					<span id="project-manager-status">&nbsp;</span>
				</td>
			</tr>

		</tbody>
	</table>

	<div class="extra-margin">

		<a href="#" class="govuk-button button-large" data-js-modal="modal-project-details" th:unless="${param.user != null and param.user[0] == 'nonLead'}">Submit all project details</a>


		<div class="modal-project-details" role="dialog" aria-hidden="true" style="margin-top: -174px;">
	        <button class="js-close close" aria-label="Close Popup">X</button>
	        <div>

				<h2 class="govuk-heading-m govuk-!-margin-0">Submit project details</h2>

				<p class="govuk-body">Are you sure that you wish to submit your project details to Innovate UK?</p>

				<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

            	<div class="alignright-button">
					<a href="#" aria-label="Close Popup" class="govuk-button-link js-close">Cancel</a>
            		<a href="/prototypes/1588-project-status?stage=level2" class="govuk-button">Submit</a>
            	</div>

	        </div>
	    </div>


	</div>


	<h2 class="govuk-heading-m">Finance contacts</h2>

	<p class="govuk-body">Each partner must provide a finance contact. We will contact them with any queries around partner finances.</p>

	<table class="govuk-table">
		<thead class="govuk-table__head">
			<tr class="govuk-table__row">
				<th scope="col" style="width: 45%">Partner</th>
				<th scope="col" style="width: 45%">Finance contact</th>
				<!-- <th scope="col" style="width: 15%">Turnover</th>
				<th scope="col" style="width: 15%">Staff headcount</th> -->
				<th scope="col" style="width: 10%">Submitted</th>
			</tr>
		</thead>
		<tbody class="govuk-table__body">
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					<a href="/prototypes/1575-finance-contact" th:unless="${param.user != null and param.user[0] == 'nonLead'}" >Aptrans Ltd</a>
					<span th:unless="${param.user == null or param.user[0] != 'nonLead'}">Aptrans Ltd</span>
				</td>
				<td class="govuk-table__cell">
					<span id="finance-contact">John Smith</span>
				</td>
				<!-- <td class="govuk-table__cell">
					<span id="finance-turnover">-</span>
				</td>
				<td class="govuk-table__cell">
					<span id="finance-headcount">-</span>
				</td> -->
				<td class="govuk-table__cell">
					<span id="finance-contact-status" class="yes">Yes</span>
				</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					<span th:unless="${param.user != null and param.user[0] == 'nonLead'}">Biotech Corp</span>
					<a href="/prototypes/1575-finance-contact?user=nonLead" th:unless="${param.user == null or param.user[0] != 'nonLead'}">Biotech Corp</a>
				</td>
				<td class="govuk-table__cell">
					<span id="finance-partner-contact">-</span>
				</td>
				<!-- <td class="govuk-table__cell">
					<span id="finance-partner-turnover">-</span>
				</td>
				<td class="govuk-table__cell">
					<span id="finance-partner-headcount">-</span>
				</td> -->
				<td class="govuk-table__cell">
					<span id="finance-partner-contact-status" class="no">No</span>
				</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">
					University of Cardiff
				</td>
				<td class="govuk-table__cell">
					Paula Moore
				</td>
				<!-- <td class="govuk-table__cell">
					<span id="finance-turnover">&pound;2,023,092</span>
				</td>
				<td class="govuk-table__cell">
					<span id="finance-headcount">76</span>
				</td> -->
				<td class="govuk-table__cell">
					<span id="finance-partner2-contact-status">Pending</span>
				</td>
			</tr>
		</tbody>
	</table>



	<!-- END OFHARDCODED PROTOTYPE HTML -->

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
<script src="/js/ifs_prototype/prototype.js" type="text/javascript"></script>

<script type="text/javascript">
	// <![CDATA[
	jQuery(document).ready(function(){

		function $_GET(param) {
	        var vars = {};
	        window.location.href.replace( location.hash, '' ).replace(
	            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
	            function( m, key, value ) { // callback
	                vars[key] = value !== undefined ? value : '';
	            }
	        );

	        if ( param ) {
	            return vars[param] ? vars[param] : null;
	        }
	        return vars;
	    }

		var startDay = $_GET('start-day'),
			startMonth = $_GET('start-month'),
			startYear = $_GET('start-year'),
			street = $_GET('street'),
			town = $_GET('town'),
			postcode = $_GET('postcode'),
			pmName = $_GET('pm-name-group'),
			pmNamePending = $_GET('name-pm1'),
			financesName = $_GET('finances-name-group'),
			financesNamePending = $_GET('name-finance-contact1'),
			financesTurnover = $_GET('finance-turnover'),
			financesHeadcount = $_GET('finance-headcount'),
			userType = $_GET('user');

		if (startDay != null || startMonth != null || startYear != null){
			localStorage.setItem('startDate', startDay+'/'+startMonth+'/'+startYear)
		}
		var startDate = localStorage.getItem('startDate');


		if (postcode != null){
			localStorage.setItem('projectAddress', street+','+town+','+postcode)
		}
		var projectAddress = localStorage.getItem('projectAddress');


		if (pmName != null){
			localStorage.setItem('pmName', pmName);
			localStorage.removeItem('pmNamePending');
		}
		var pmName = localStorage.getItem('pmName');


		if (pmNamePending != null){
			localStorage.setItem('pmNamePending', pmNamePending);
			localStorage.removeItem('pmName');
		}
		var pmNamePending = localStorage.getItem('pmNamePending');


		if (financesName != null && userType == null){
			localStorage.setItem('financesName', financesName);
			localStorage.removeItem('financesNamePending');
		}else if(financesName != null && userType != null){
			localStorage.setItem('financesPartnerName', financesName);
			localStorage.removeItem('financesPartnerNamePending');
		}
		var financesName = localStorage.getItem('financesName');
		var financesPartnerName = localStorage.getItem('financesPartnerName');

		if (financesNamePending != null && userType == null){
			localStorage.setItem('financesNamePending', financesNamePending);
			localStorage.removeItem('financesName');
		}else if (financesNamePending != null && userType != null){
			localStorage.setItem('financesPartnerNamePending', financesNamePending);
			localStorage.removeItem('financesPartnerName');
		}
		var financesNamePending = localStorage.getItem('financesNamePending');
		var financesPartnerNamePending = localStorage.getItem('financesPartnerNamePending');

		/*if (userType == null && financesTurnover != null){ // LEAD VIEW
			localStorage.setItem('financesTurnoverLead', '£'+financesTurnover);
		}else if(userType == null && financesTurnover == null){
			localStorage.setItem('financesTurnoverLead', '£1,000,012');
			localStorage.setItem('financesTurnoverNonLead', '-');
		}
		var financesTurnoverLead = decodeURIComponent(localStorage.getItem('financesTurnoverLead'));

		//alert('lead'+financesTurnoverLead);

		if (userType != null && financesTurnover != null){ // PARTNER VIEW
			localStorage.setItem('financesTurnoverNonLead', '£'+financesTurnover);
		}else if(userType != null && financesTurnover == null){
			//localStorage.setItem('financesTurnoverLead', '-');
			localStorage.setItem('financesTurnoverNonLead', '-');
		}
		var financesTurnoverNonLead = decodeURIComponent(localStorage.getItem('financesTurnoverNonLead'));

		//alert('non lead'+financesTurnoverNonLead);


		if (userType == null && financesHeadcount != null){ // LEAD VIEW
			localStorage.setItem('financesHeadcountLead', financesHeadcount);
		}else if(userType == null && financesHeadcount == null){
			localStorage.setItem('financesHeadcountLead', '50');
		}
		var financesHeadcountLead = decodeURIComponent(localStorage.getItem('financesHeadcountLead'));

		//alert('lead'+financesHeadcountLead);

		if (userType != null && financesHeadcount != null){ // PARTNER VIEW
			localStorage.setItem('financesHeadcountPartner', financesHeadcount);
		}else if(userType == null && financesHeadcount == null){
			localStorage.setItem('financesHeadcountPartner', '-');
		}
		var financesHeadcountPartner = decodeURIComponent(localStorage.getItem('financesHeadcountPartner'));

		*/


		if(startDate == null){
			jQuery('#start-date').text('-');
			jQuery('#start-date-status').text('No');
			jQuery('#start-date-status').addClass('no');
			jQuery('#start-date-status').removeClass('yes');
		}else{
			jQuery('#start-date').text(startDate);
			jQuery('#start-date-status').text('Yes');
			jQuery('#start-date-status').addClass('yes');
			jQuery('#start-date-status').removeClass('no');

		}

		if(projectAddress == null){
			jQuery('#project-address').text('-');
			jQuery('#project-address-status').text('No');
			jQuery('#project-address-status').addClass('no');
			jQuery('#project-address-status').removeClass('yes');
		}else{
			jQuery('#project-address').text(projectAddress.replace(/\+/g,' '));
			jQuery('#project-address-status').text('Yes');
			jQuery('#project-address-status').addClass('yes');
			jQuery('#project-address-status').removeClass('no');

		}

		if(pmName == null){
			jQuery('#project-manager').text('-');
			jQuery('#project-manager-status').text('No');
			jQuery('#project-manager-status').addClass('no');
			jQuery('#project-manager-status').removeClass('yes');
		}else{
			jQuery('#project-manager').text(pmName.replace(/\+/g,' '));

			if(pmNamePending == null){
				jQuery('#project-manager-status').text('Yes');
				jQuery('#project-manager-status').addClass('yes');
				jQuery('#project-manager-status').removeClass('no');

			}else{
				jQuery('#project-manager').text(pmNamePending.replace(/\+/g,' '));
				jQuery('#project-manager-status').text('Pending');
				jQuery('#project-manager-status').removeClass('yes');
				jQuery('#project-manager-status').removeClass('no');
			}
		}

		if(financesName == null & userType == null){
			jQuery('#finance-contact').text('John Smith');
			//jQuery('#finance-contact-status').text('No');
			//jQuery('#finance-contact-status').addClass('no');
			//jQuery('#finance-contact-status').removeClass('yes');

			//jQuery('#finance-turnover').text(financesTurnoverLead);
			//jQuery('#finance-headcount').text(financesHeadcountLead);
			//jQuery('#finance-partner-turnover').text(financesTurnoverNonLead);
			//jQuery('#finance-partner-headcount').text(financesHeadcountPartner);

			jQuery('#finance-partner-contact').text(financesPartnerName.replace(/\+/g,' '));

		}else if(financesName != null & userType == null){

			//jQuery('#finance-turnover').text(financesTurnoverLead);
			//jQuery('#finance-headcount').text(financesHeadcountLead);
			//jQuery('#finance-partner-turnover').text(financesTurnoverNonLead);
			//jQuery('#finance-partner-headcount').text(financesHeadcountPartner);

			jQuery('#finance-contact').text(financesName.replace(/\+/g,' '));
			jQuery('#finance-partner-contact').text(financesPartnerName.replace(/\+/g,' '));

			if(financesNamePending == null){
				jQuery('#finance-contact-status').text('Yes');
				jQuery('#finance-contact-status').addClass('yes');
				jQuery('#finance-contact-status').removeClass('no');
			}else{
				jQuery('#finance-contact').text(financesNamePending.replace(/\+/g,' '));
				jQuery('#finance-contact-status').text('Pending');
				jQuery('#finance-contact-status').removeClass('yes');
				jQuery('#finance-contact-status').removeClass('no');
			}
		}

		if(financesPartnerName == null & userType == 'nonLead'){
			jQuery('#finance-partner-contact').text('-');
			jQuery('#finance-partner-contact-status').text('No');
			jQuery('#finance-partner-contact-status').addClass('no');
			jQuery('#finance-partner-contact-status').removeClass('yes');

			//jQuery('#finance-partner-turnover').text(financesTurnoverNonLead);

		}else if(financesPartnerName != null & userType == 'nonLead'){

			jQuery('#finance-partner-contact').text(financesPartnerName.replace(/\+/g,' '));

			//jQuery('#finance-partner-turnover').text(financesTurnoverNonLead);
			//jQuery('#finance-turnover').text(financesTurnoverLead);
			//jQuery('#finance-partner-headcount').text(financesHeadcountPartner);
			//jQuery('#finance-headcount').text(financesHeadcountLead);


			if(financesPartnerNamePending == null){
				jQuery('#finance-partner-contact-status').text('Yes');
				jQuery('#finance-partner-contact-status').addClass('yes');
				jQuery('#finance-partner-contact-status').removeClass('no');
			}else{
				jQuery('#finance-partner-contact').text(financesPartnerNamePending.replace(/\+/g,' '));
				jQuery('#finance-partner-contact-status').text('Pending');
				jQuery('#finance-partner-contact-status').removeClass('yes');
				jQuery('#finance-partner-contact-status').removeClass('no');
			}
		}


		jQuery('#add-finance-contact').on('click',function(e){
			e.preventDefault();
			jQuery('#finance-contact-table').show();

		});

		jQuery('#invite-finance-contact').on('click',function(e){
			e.preventDefault();

			var financeContact = jQuery('#name-finance-contact1').val();

			jQuery('#finance-name').text(financeContact + ' (Pending)')
			jQuery("#finances-name-invite").attr('checked', 'checked');
			jQuery('#finance-contact-table').hide();
			jQuery('#invited-finance-contact').show();

		});



		jQuery('#add-pm').on('click',function(e){
			e.preventDefault();
			jQuery('#pm-table').show();

		});

		jQuery('#invite-pm').on('click',function(e){
			e.preventDefault();
			jQuery('#pm-table').hide();
		});


		jQuery('#postcode-lookup').on('click',function(e){
			e.preventDefault();
			jQuery("#select-address-block").show();
		});

		jQuery('#select-address').on('change',function(e){
			e.preventDefault();
			jQuery("#address-details").show();
			jQuery("#street").val("4 Station Road");
			jQuery("#county").val("Wiltshire");
			jQuery("#town").val("Swindon");
			jQuery("#postcode").val("SN1 2BD");

		});

		jQuery('#enter-address-manually').on('click',function(e){
			e.preventDefault();
			jQuery("#address-details").show();
			jQuery("#select-address-block").hide();
		});

	});
	// ]]>
</script>
</body>
</html>
