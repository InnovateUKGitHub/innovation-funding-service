<!DOCTYPE html>
<html lang="en" class="govuk-template" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle=|Changes to finance - ${model.projectName}"/>
</head>
<body class="govuk-template__body ">
<th:block th:insert="fragments/layout :: body-start"/>
<th:block th:insert="fragments/layout :: global-header"/>

<div class="govuk-width-container">
    <th:block th:insert="fragments/layout :: phase-banner" />
    <th:block th:if="${model.internal}" th:insert="fragments/layout :: header-sub" th:with="linkTitle='Eligibility',linkUrl=@{/project/{projectId}/finance-check/organisation/{orgId}/eligibility(projectId=${model.projectId},orgId=${model.organisationId})}" />
    <th:block th:unless="${model.internal}" th:insert="fragments/layout :: header-sub" th:with="linkTitle='Eligibility',linkUrl=@{/project/{projectId}/finance-checks/eligibility(projectId=${model.projectId})}"  />

    <main class="govuk-main-wrapper" id="main-content" role="main">
        <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Changes to finances',subTitle=|${model.applicationId}: ${model.projectName}|,size='govuk-heading-xl'" />


        <th:block th:if="${model.financeSummary != null}" th:with="summaryModel=${model.financeSummary}">
            <h2 class="govuk-heading-m">Finance summary</h2>
            <div class="table-overflow">
                <table class="govuk-table table-overview">

                    <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header" scope="col">Section</th>
                        <th class="govuk-table__header govuk-table__header--numeric" scope="col">Submitted</th>
                        <th class="govuk-table__header govuk-table__header--numeric" scope="col">Updated</th>
                        <th class="govuk-table__header govuk-table__header--numeric" scope="col">Variance</th>
                    </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                    <tr class="govuk-table__row" th:each="entry : ${summaryModel.entries}">
                        <th class="govuk-table__header" scope="row" th:text="${entry.section}" />
                        <td class="govuk-table__cell govuk-table__cell--numeric"><th:block th:text="${#numbers.formatDecimal(entry.applicationCost,1,'DEFAULT',2,'DEFAULT')}"/></td>
                        <td class="govuk-table__cell govuk-table__cell--numeric">
                            <th:block th:if="${entry.projectCostDifferent}">
                                <th:block th:text="${#numbers.formatDecimal(entry.projectCost,1,'DEFAULT',2,'DEFAULT')}"/>
                            </th:block>
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric">
                            <th:block th:if="${entry.projectCostDifferent}">
                                <th:block th:text="${entry.varianceDirection}"/> <th:block th:text="${entry.variance}"/>
                            </th:block>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </th:block>

        <h2 class="govuk-heading-m">Project finances</h2>

        <table class="govuk-table table-overview">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col">Section</th>
                <th class="govuk-table__header govuk-table__header--numeric" scope="col">Submitted (&pound;)</th>
                <th class="govuk-table__header govuk-table__header--numeric" scope="col">Updated (&pound;)</th>
                <th class="govuk-table__header govuk-table__header--numeric" scope="col">Variance (&pound;)</th>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            <tr class="govuk-table__row" th:each="entry : ${model.projectFinances.entries}">
                <th class="govuk-table__header" scope="row" th:text="${entry.section}" />
                <td class="govuk-table__cell govuk-table__cell--numeric"><th:block th:text="${#numbers.formatDecimal(entry.applicationCost,1,'DEFAULT',2,'DEFAULT')}"/></td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                    <th:block th:if="${entry.projectCostDifferent}">
                        <th:block th:text="${#numbers.formatDecimal(entry.projectCost,1,'DEFAULT',2,'DEFAULT')}"/>
                    </th:block>
                </td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                    <th:block th:if="${entry.projectCostDifferent}">
                        <th:block th:text="${entry.varianceDirection}"/> <th:block th:text="${entry.variance}"/>
                    </th:block>
                </td>
            </tr>
            </tbody>
            <tfoot>
            <tr class="govuk-table__row" th:with="totalProjectCosts=${model.projectFinances.totalProjectCosts}">
                <th class="govuk-table__header" scope="row">Total project costs</th>
                <td class="govuk-table__cell govuk-table__cell--numeric"><th:block th:text="${#numbers.formatDecimal(totalProjectCosts.applicationCost,1,'DEFAULT',2,'DEFAULT')}"/></td>
                <td class="govuk-table__cell govuk-table__cell--numeric"><th:block th:text="${#numbers.formatDecimal(totalProjectCosts.projectCost,1,'DEFAULT',2,'DEFAULT')}"/></td>
                <td class="govuk-table__cell govuk-table__cell--numeric">
                    <th:block th:if="${totalProjectCosts.projectCostDifferent}">
                        <th:block th:text="${totalProjectCosts.varianceDirection}"/> <th:block th:text="${totalProjectCosts.variance}"/>
                    </th:block>
                </td>
            </tr>
            </tfoot>
        </table>

        <th:block th:if="${model.milestoneDifferences != null}" th:with="milestonesModel=${model.milestoneDifferences}">

            <h2 class="govuk-heading-m">Payment milestones</h2>

            <table class="govuk-table table-overview">
                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header" scope="col">Milestone</th>
                    <th class="govuk-table__header" scope="col">Section</th>
                    <th class="govuk-table__header govuk-table__header--numeric" scope="col">Submitted</th>
                    <th class="govuk-table__header govuk-table__header--numeric" scope="col">Updated</th>
                    <th class="govuk-table__header govuk-table__header--numeric" scope="col">Variance</th>
                </tr>
                </thead>
                <tbody class="govuk-table__body">
                <th:block th:each="milestoneDiff : ${milestonesModel.milestoneDifferences}">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__cell" scope="row" th:text="${milestoneDiff.description}" rowspan="2"/>
                        <td class="govuk-table__cell">Month completed</td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.monthSubmitted}">
                            0
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.monthUpdated}">
                          0
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.monthVariance}">
                            0
                        </td>
                    </tr>
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">Payment requested (&pound;)</td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.paymentSubmitted}">
                            0
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.paymentUpdated}">
                            0
                        </td>
                        <td class="govuk-table__cell govuk-table__cell--numeric" th:text="${milestoneDiff.paymentVariance}">
                            0
                        </td>
                    </tr>
                </th:block>
                </tbody>
            </table>

        </th:block>

        <a th:if="${model.internal}" class="govuk-button govuk-button--secondary" th:href="@{/project/{projectId}/finance-check/organisation/{orgId}/eligibility(projectId=${model.projectId},orgId=${model.organisationId})}">Return to eligibility</a>
        <a th:unless="${model.internal}" class="govuk-button govuk-button--secondary" th:href="@{/project/{projectId}/finance-checks/eligibility(projectId=${model.projectId})}">Return to eligibility</a>

        <th:block th:insert="fragments/layout :: main-content-end"/>
    </main>
</div>

<th:block th:insert="fragments/layout :: footer"/>
<th:block th:insert="fragments/layout :: body-end"/>

</body>
</html>
