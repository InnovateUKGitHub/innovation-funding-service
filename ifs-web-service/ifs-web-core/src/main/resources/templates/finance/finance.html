<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!-- ===========================Form: finance =========================== -->
    <th:block th:fragment="finance">
        <th:block th:with="readonly=${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <th:block th:unless="${readonly}">
                <div th:class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ organisationGrantClaimPercentageId +'-grantClaimPercentage]}') or #fields.hasErrors('${form.formInput[cost-'+ organisationGrantClaimPercentageId +']}')}? 'error'">
                    <label class="form-label form-label-bold" for="cost-financegrantclaim">
                        <div th:text="'Enter your funding level (maximum ' + ${maximumGrantClaimPercentage} + '%).'" />
                        <span class="form-hint" th:text="'The maximum funding level is ' + ${maximumGrantClaimPercentage} + '%. This is based on your organisation size and the project research category.' " />
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+organisationGrantClaimPercentageId+'-grantClaimPercentage'})" />
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+organisationGrantClaimPercentageId})" />
                    </label>
                    <th:block th:insert="question-type/form-elements :: form-guidance (guidable=${formInput})" />
                    <input type="number"
                           min="0"
                           required="required"
                           th:max="${maximumGrantClaimPercentage}"
                           th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:class="${maximumGrantClaimPercentage != null and maximumGrantClaimPercentage &lt; organisationGrantClaimPercentage} ? 'width-small form-control field-error' : 'width-small form-control'"
                           id="cost-financegrantclaim"
                           th:name="${'finance-grantclaimpercentage-' + question.id + '-' + organisationGrantClaimPercentageId}"
                           th:value="${organisationGrantClaimPercentage}"
                           placeholder="0"
                           th:attr="data-min-errormessage=#{validation.field.percentage.max.value.or.higher('%min%')},
                                    data-max-errormessage=#{validation.field.percentage.max.value.or.lower('%max%')}"
                            />%
                </div>
            </th:block>
            <th:block th:if="${readonly}">
                <dl class="readonly-data" th:unles="${organisationGrantClaimPercentage == null}">
                    <dt th:text="${question.name}">Your Funding level</dt>
                    <dd th:text="${organisationGrantClaimPercentage+'%'}">50%</dd>
                </dl>
            </th:block>
        </th:block>
    </th:block>

    <!-- ===========================Form: organisation_size =========================== -->
    <th:block th:fragment="organisation_size">
        <div class="message-alert extra-margin-bottom" th:if="${model.organisationSizeAlert}">
            <h2 class="heading-small no-margin">Organisation size determines funding</h2>
            <p>The organisation size is used to calculate your funding level in the application.</p>
            <p>Changing this selection will reset your funding level.</p>
        </div>
        <th:block th:with="readonly=${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <th:block th:unless="${readonly}">
                <!--/* edit */-->
                <div class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? error">
                    <fieldset>
                        <legend>
                            <span class="form-label form-label-bold" th:text="${question.name}"/>
                            <th:block th:insert="question-type/form-elements :: form-hint (hint=${question.getDescription()})" />
                            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" />
                        </legend>
                        <th:block th:insert="question-type/form-elements :: form-guidance (guidable=${formInput})" />
                        <label class="block-label selection-button-radio" th:for="'financePosition-organisationSize-'+${size.id}" th:each="size : ${organisationSizes}">
                            <input type="radio"
                                   th:id="'financePosition-organisationSize-'+${size.id}"
                                   th:name="'financePosition-organisationSize'"
                                   th:value="${size.id}"
                                   th:checked="${size.id == model.finance.organisationFinanceSize}"
                                   required="required" />
                            <th:block th:text="${size.description}" />
                        </label>
                    </fieldset>
                </div>
            </th:block>
            <th:block th:if="${readonly}">
                <!--/* view  */-->
                <dl class="readonly-data">
                    <dt th:text="${formInput.description}">Organisation size</dt>

                    <th:block th:unless="${model.finance.organisationFinanceSize == null}" th:each="size : ${organisationSizes}">
                        <dd th:if="${model.finance.organisationFinanceSize == size.id}" th:text="${size.description}">Micro / small: claim up to 70%</dd>
                    </th:block>
                </dl>
            </th:block>
        </th:block>
    </th:block>

    <!-- =========================== Form: Staff Turnover =========================== -->
    <th:block th:fragment="staff_turnover">
        <th:block th:with="readonly=${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <th:block th:unless="${readonly}">
                <!--/* edit */-->
                <div class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? error : ''">
                    <label th:for="'formInput-'+${formInput.id}" th:id="'form-label-'+${formInput.id}">
                        <span class="form-label form-label-bold" th:text="${formInput.description}"/>
                        <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
                    </label>
                    <input class="form-control width-medium"
                           th:id="'formInput-'+${formInput.id}"
                           th:name="'formInput['+${formInput.id}+']'"
                           th:value="*{formInput[__${formInput.id}__]}"
                           required="required"
                           min="0"
                           max="2147483647"
                           type="number" />
                </div>
            </th:block>
            <th:block th:if="${readonly}">
                <!--/* view  */-->
                <dl class="readonly-data">
                    <dt th:text="${formInput.description}">Turnover (&pound;)</dt>
                    <dd th:text="'£ '+ *{#numbers.formatInteger(formInput[__${formInput.id}__],0,'COMMA')}">&pound; 100,000,000</dd>
                </dl>
            </th:block>
        </th:block>
    </th:block>

    <!-- =========================== Form: Staff Count =========================== -->
    <th:block th:fragment="staff_count">
        <th:block th:with="readonly=${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <th:block th:unless="${readonly}">
                <!--/* edit */-->
                <div class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? error : ''">
                    <label th:for="'formInput-'+${formInput.id}" th:id="'form-label-'+${formInput.id}">
                        <span class="form-label form-label-bold" th:text="${formInput.description}" />
                        <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
                    </label>
                    <input class="form-control width-medium"
                           type="number"
                           th:id="'formInput-'+${formInput.id}"
                           th:name="'formInput['+${formInput.id}+']'"
                           min="0"
                           max="2147483647"
                           th:value="*{formInput[__${formInput.id}__]}"
                           required="required" />
                </div>
            </th:block>
            <th:block th:if="${readonly}">
                <!--/* view */-->
                <dl class="readonly-data">
                    <dt th:text="${formInput.description}">Full time employees</dt>
                    <dd th:text="*{formInput[__${formInput.id}__]}">440</dd>
                </dl>
            </th:block>
        </th:block>
    </th:block>

    <!-- =========================== Form: Financial Year End =========================== -->
    <div th:fragment="financial_year_end"  class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'error' : ''">
        <fieldset th:with="value=(*{formInput[__${formInput.id}__]})">
            <legend>
                <span class="form-label form-label-bold">End of last financial year</span>
                <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
                <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
            </legend>
            <div class="date-group" data-past-date="">
                <!--/* this is added for javascript date validation, if we have more mm yyyy fields we might want to do this in a cleaner way */-->
                <div class="day">
                    <input th:id="'year-end-day-'+${formInput.id}" type="hidden" value="1" class="js-visited day" disabled="disabled" />
                </div>
                <div class="month" th:with="month=${#strings.substringBefore(value, '-')}">
                    <label class="form-label" th:for="${formInput.id}+'.MMYYYY.month'">
                        <span>Month</span>
                    </label>
                    <input class="form-control width-extra-small"
                           th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:id="${formInput.id}+'.MMYYYY.month'"
                           th:name="'formInput['+${formInput.id}+'].MMYYYY.month'"
                           th:value="${month}"
                           th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'field-error' : ''"
                           required="required"
                           placeholder="MM"
                           max="12"
                           min="0"
                           type="number" />
                </div>
                <div class="year" th:with="year=${#strings.substringAfter(value, '-')}">
                    <label class="form-label" th:for="${formInput.id}+'.MMYYYY.year'">
                        <span>Year</span>
                    </label>
                    <input class="form-control width-extra-small"
                           th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:id="${formInput.id}+'.MMYYYY.year'"
                           th:name="'formInput['+${formInput.id}+'].MMYYYY.year'"
                           th:value="${year}"
                           th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'field-error' : ''"
                           placeholder="YYYY"
                           required="required"
                           min="0"
                           type="number" />
                </div>
            </div>
        </fieldset>
    </div>

    <!-- =========================== Form: Financial Staff Count =========================== -->
    <div th:fragment="financial_staff_count" class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? error : ''">
        <label class="form-label form-label-bold" th:for="'formInput-'+${formInput.id}" th:id="'form-label-'+${formInput.id}">
            <span th:text="${formInput.description}"/>
            <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
        </label>
        <input class="form-control width-medium"
               th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
               type="number"
               th:id="${formInput.id}"
               th:name="'formInput['+${formInput.id}+']'"
               th:min="0"
               th:max="2147483647"
               th:value="*{formInput[__${formInput.id}__]}"
               th:required="required"
        />
    </div>

    <!-- ===========================Form: your_finance =========================== -->
    <th:block th:fragment="your_finance">
        <h2 class="heading-medium no-margin" th:text="${#strings.replace(question.name,'{organisationName}',
        userOrganisation.name)}" />
        <p ifs:utext="${question.description}" />

        <section class="collapsible" th:each="subSection : ${subSections.get(currentSectionId)}" th:if="${subSections !=null}">
            <h2>
                <th:block th:text="${subSection.getName()}" />
                <span th:attr="data-mirror='#section-total-'+${subSection.id}" />
            </h2>
            <div class="collapsible-content">
                <th:block th:each="question : ${subsectionQuestions.get(subSection.id)}">
                    <th:block th:each="formInput, status : ${subSectionQuestionFormInputs.get(question.id)}">
                        <th:block th:if="${formInput.type.displayableFinanceType}">
                            <div th:replace="finance/finance :: ${formInput.type.nameLower} (viewmode=${(readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))} ? 'approved' : 'edit')" th:with="formInputIndex=(${status.index})" />
                        </th:block>
                        <th:block th:if="${formInput.type.displayableQuestionType}">
                            <div th:replace="question-type/types :: ${formInput.type.nameLower} (complete=${(readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))} ? 'complete' : '')" th:with="formInputIndex=(${status.index})" />
                        </th:block>
                    </th:block>
                </th:block>
            </div>
        </section>
        <div class="grid-row total-cost">
            <div class="column-half">
                <label for="total-cost" class="heading-medium">'<th:block th:text="${userOrganisation.name}"></th:block>' Total project costs</label>
            </div>
            <div class="column-half alignright">
                <input type="text"
                       id="total-cost"
                       readonly="readonly"
                       class="heading-medium width-full alignright"
                       data-calculation-fields="[id*=section-total]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(organisationFinanceTotal, 0, 'COMMA', 0, 'POINT')}"/>
            </div>
        </div>
    </th:block>

    <!-- ===========================Form: labour =========================== -->
    <th:block th:fragment="labour (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))},formInputIndex=${status.index}">
        <th:block th:if="${viewmode == 'approved'}">

            <dl class="standard-definition-list">
                <dt>Working days per year</dt>
                <dd th:text="${costCategory.workingDaysPerYear}">232</dd>
            </dl>
            <h3>Number of staff and roles within the project</h3>
            <table class="labour-costs-table">
                <thead>
                    <tr>
                        <th scope="col">Role within project</th>
                        <th scope="col" class="numeric">Gross annual salary</th>
                        <th scope="col" class="numeric">Rate (£/day)</th>
                        <th scope="col" class="numeric">Days to be spent by all staff at this grade</th>
                        <th scope="col" class="numeric">Total costs</th>
                    </tr>
                </thead>
                <tbody>
                    <th:block th:each="cost, iteration : ${costCategory.costs}">
                        <tr>
                            <td th:text="${cost.getRole()}" />
                            <td class="numeric" th:text="${cost.grossAnnualSalary != null ? #numbers.formatDecimal(cost.grossAnnualSalary,0,0) : '0'}" />
                            <td class="numeric" th:text="${(costCategory?.workingDaysPerYear != null and cost.getRate(costCategory.workingDaysPerYear) != null) ? '£ '+#numbers.formatDecimal(cost.getRate(costCategory.workingDaysPerYear),0,0) : '£ 0'}" />
                            <td class="numeric" th:text="${cost.labourDays}" />
                            <td class="numeric" th:text="'£ ' + ${#numbers.formatDecimal(cost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}" />
                        </tr>
                    </th:block>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="4" scope="row">Total labour costs</th>
                        <td th:id="${'section-total-'+subSection.id}" class="numeric" th:text="'£ ' + ${costCategory.getTotal() != null ? #numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT') : 0}" />
                    </tr>
                </tfoot>
            </table>
        </th:block>

        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">

            <div th:attr="data-repeatable-container=${question.id}" th:if="${costCategory!=null}">
                <div class="form-group inline"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}') or #fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +'-labourDays]}')} ? 'error' : ''">
                    <label th:for="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}">
                        <span>Working days per year</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.workingDaysPerYearCostItem?.id})" />
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.workingDaysPerYearCostItem?.id +'-labourDays'})" />
                    </label>
                    <input type="number"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}') or #fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +'-labourDays]}')} ? 'field-error' : ''"
                           th:id="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}"
                           th:name="${'labour-labourDaysYearly-' + question.id + '-' + costCategory.workingDaysPerYearCostItem?.id}"
                           ifs:nonZeroValue="${costCategory.workingDaysPerYear}"
                           th:readonly="${viewmode == 'readonly'}"
                           placeholder="0"
                           min="1"
                           max="365"
                           required="required" />
                </div>
                <h3>Number of staff and roles within the project</h3>
                <div class="form-group">
                    <table class="labour-costs-table">
                        <thead>
                        <tr>
                            <th id="labour-role" scope="col" class="width-medium">Role within project</th>
                            <th id="labour-salary" scope="col" class="numeric">Gross annual salary</th>
                            <th id="labour-rate" scope="col" class="numeric">Rate (£/day)</th>
                            <th id="labour-days" scope="col" class="numeric width-medium">Days to be spent by all staff at this grade</th>
                            <th scope="col"  th:if="${viewmode == 'edit'}">
                                <span class="visuallyhidden">Actions</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost, iteration : ${costCategory.costs}">
                                <th:block th:insert="finance/finance :: labour_row" th:with="iterationIndex=${iteration.count}" />
                            </th:block>
                        </tbody>
                    </table>
                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:insert="question-type/types :: add_row(text='Add another role', question=${question},rowcontainer='.labour-costs-table tbody')" />
                    </p>
                </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id}">Total labour costs</label>
                        <input class="form-control form-control-1-4 alignright"
                               data-calculation-fields="[id*=labourTotalCost]"
                               data-calculation-operations="+"
                               th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                               readonly="readonly"
                               type="text"
                               th:id="${'section-total-'+subSection.id}"
                               th:value="'£ ' + ${costCategory.getTotal() != null ? #numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT') : 0}" />

                    </div>
                </div>
            </th:block>
        </th:block>

        <th:block th:fragment="labour_row">
            <th:block  th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
                <td class="form-group"   th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? 'error' : ''">

                    <label th:for="${'cost-labour-'+costIdentifier+'-role'}">
                        <span class="visuallyhidden">Role within project</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-role'})" />
                    </label>
                    <input type="text"
                           class="form-control width-full"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? field-error : ''"
                           th:name="${'labour-role-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-labour-'+costIdentifier+'-role'}"
                           th:value="${cost.getRole()}"
                           th:readonly="${viewmode == 'readonly'}"
                           required="required"
                           maxlength="255"  />
                </td>
                <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-grossAnnualSalary]}')} ? 'error' : ''">
                    <label th:for="${'cost-labour-'+costIdentifier+'-labourGrossSalary'}">
                        <span class="visuallyhidden">Gross annual salary</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-grossAnnualSalary'})" />
                    </label>
                    <input type="number"
                           class="form-control width-full"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+costIdentifier+'-grossAnnualSalary]}')} ? field-error : ''"
                           th:name="${'labour-grossAnnualSalary-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-labour-'+costIdentifier+'-labourGrossSalary'}"
                           th:readonly="${viewmode == 'readonly'}"
                           ifs:nonZeroValue="${cost.grossAnnualSalary != null ? #numbers.formatDecimal(cost.grossAnnualSalary,0,0) : '0'}"
                           placeholder="0"
                           required="required"
                           min="1"
                           max="9999999999999999999"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                            />
                </td>
                <td class="numeric">
                    <label th:for="${'cost-labour-'+costIdentifier+'-labourRate'}">
                        <span class="visuallyhidden">Rate (&pound;/day)</span>
                    </label>
                    <input type="text"
                           class="form-control width-full"
                           th:attr="data-calculation-fields=${'#cost-labour-'+costIdentifier+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'},data-calculation-rawValue=${costCategory?.workingDaysPerYear != null ? cost.getRate(costCategory.workingDaysPerYear) : 0}"
                           data-calculation-operations="/"
                           readonly="readonly"
                           th:id="${'cost-labour-'+costIdentifier+'-labourRate'}"
                           th:name="${'labour-labourRate-' + question.id + '-' + costIdentifier}"
                           th:value="${(costCategory?.workingDaysPerYear != null and cost.getRate(costCategory.workingDaysPerYear) != null) ? '£ '+#numbers.formatDecimal(cost.getRate(costCategory.workingDaysPerYear),0,0) : '£ 0'}"
                           maxlength="255" />
                </td>
                <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-labourDays]}')} ? 'error' : ''">
                    <label th:for="${'cost-labour-'+costIdentifier+'-labourDays'}">
                        <span class="visuallyhidden">Days to be spent by all staff at this grade</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-labourDays'})" />
                    </label>
                    <input type="number"
                           class="form-control width-full"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+costIdentifier+'-labourDays]}')} ? field-error : ''"
                           th:readonly="${viewmode == 'readonly'}"
                           th:id="${'cost-labour-'+costIdentifier+'-labourDays'}"
                           th:name="${'labour-labourDays-' + question.id + '-' + costIdentifier}"
                           ifs:nonZeroValue="${cost.labourDays}"
                           placeholder="0"
                           required="required"
                           min="1"
                           max="999999999"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                            />
                </td>
                <td rowspan="2" class="rowspan buttoncolumn" th:if="${viewmode == 'edit'}">
                    <button th:unless="${cost.id == null}"
                            type="submit"
                            name="remove_cost"
                            class="buttonlink js-remove-row"
                            th:value="${cost.id}"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                  <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </td>
            </tr>
            <tr th:attr="data-repeatable-row=${costIdentifier}">
                <td colspan="4" class="numeric colspan">
                    <label th:for="${'cost-labour-'+costIdentifier+'-labourTotalCost'}"><span>Total costs</span></label>
                    <input type="text"
                           class="form-control width-medium"
                           data-calculation-operations="/,*"
                           th:name="${'labour-total-' + question.id + '-' + costIdentifier}"
                           readonly="readonly"
                           th:id="${'cost-labour-'+costIdentifier+'-labourTotalCost'}"
                           th:attr="data-calculation-fields=${'#cost-labour-'+costIdentifier+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly,#cost-labour-'+costIdentifier+'-labourDays'},data-calculation-rawvalue=${cost.getTotal(costCategory.workingDaysPerYear)}"
                           th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}" />
                </td>

            </tr>
        </th:block>
    </th:block>
    <!-- ===========================Form: overheads =========================== -->
    <th:block th:fragment="overheads(viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))},type=${formInput.type.nameLower},labourQuestion=${financeQuestions.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).LABOUR)}">
        <th:block th:with="overheadCosts=${costCategory?.costs?.isEmpty()} ? null : ${costCategory?.costs[0]}, overheadRate=${overheadCosts?.rateType==null} ? ${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).NONE} : ${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).valueOf(overheadCosts?.rateType)}" >

            <th:block th:if="${viewmode == 'approved'}">
                <th:block th:switch="${overheadRate.name()}">
                    <th:block th:case="'NONE'">
                        No overhead costs
                        <div aria-hidden="true">£ 0</div>
                    </th:block>
                    <th:block th:case="'DEFAULT_PERCENTAGE'">
                        <table>
                            <tbody>
                                <tr>
                                    <th scope="col">20% of labour costs</th>
                                    <th scope="col" class="alignright">
                                        <span class="visuallyhidden">total overhead costs</span>
                                    </th>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th scope="row">Total overhead costs</th>
                                    <td class="alignright" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatInteger(costCategory?.getTotal(),0, 'COMMA')}">£0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </th:block>
                    <th:block th:case="'CUSTOM_RATE'">
                        <table>
                            <tbody>
                                <tr>
                                    <th scope="row">Custom administration support costs</th>
                                    <td class="alignright">
                                        Rate calculated: <th:block th:text="${overheadCosts?.getRate()+'%'}">28%</th:block>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th scope="col">Total administration support cost</th>
                                    <td class="alignright" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatInteger(costCategory?.getTotal(),0, 'COMMA')}">£0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </th:block>
                    <th:block th:case="'TOTAL'">
                        <table>
                            <tbody>
                                <tr>
                                    <th scope="col">Calulated overheads</th>
                                    <th scope="col"><span class="visuallyhidden">Total calculated overheads</span></th>
                                </tr>
                                <tr>
                                    <td class="form-group download">
                                        <h3 class="heading-small no-margin">Download the overhead calculation spreadsheet</h3>
                                        <a th:href="@{${'/application/download/overheadfile/'+overheadCosts?.id}}" th:text="${overheadCosts?.calculationFile?.get()?.name}">Overhead calculation spreadsheet.pdf</a>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th scope="row">Total cost of overheads as calculated in the spreadsheet</th>
                                    <td class="alignright" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatInteger(costCategory?.getTotal(),0, 'COMMA')}">£0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </th:block>
                </th:block>
            </th:block>
            <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
                <p ifs:utext="${question.getDescription()}" />

                <div class="form-group">
                    <fieldset>
                        <legend class="visuallyhidden">Overhead costs</legend>
                        <label class="block-label selection-button-radio" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_0'}" data-target="overhead-none">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_0'}"
                                   type="radio"
                                   required="required"
                                   th:name="${'overheads-type-' + question.id + '-'+ overheadCosts?.id}"
                                   th:value="${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).NONE}"
                                   th:checked="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).NONE)}"
                                   th:disabled="${viewmode == 'readonly'}"/>
                            No overhead costs
                        </label>
                        <label class="block-label selection-button-radio" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_1'}"  data-target="overhead-default-percentage">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_1'}"
                                   type="radio"
                                   required="required"
                                   th:name="${'overheads-type-' + question.id + '-'+ overheadCosts?.id}"
                                   th:value="${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE}"
                                   th:checked="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE)}"
                                   th:disabled="${viewmode == 'readonly'}" />
                            20% of labour costs
                        </label>

                            <label th:unless="${overheadCosts?.getUseTotalOption()}" class="block-label selection-button-radio" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_2'}"  data-target="overhead-custom-percentage">
                                <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_2'}"
                                       type="radio"
                                       required="required"
                                       th:name="${'overheads-type-' + question.id + '-'+ overheadCosts?.id}"
                                       th:value="${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE}"
                                       th:checked="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)}"
                                       th:disabled="${viewmode == 'readonly'}"/>
                                Custom overhead costs
                            </label>
                            <label th:if="${overheadCosts?.getUseTotalOption()}" class="block-label selection-button-radio" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_3'}"  data-target="overhead-total">
                                <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_3'}"
                                       type="radio"
                                       required="required"
                                       th:name="${'overheads-type-' + question.id + '-'+ overheadCosts?.id}"
                                       th:value="${T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).TOTAL}"
                                       th:checked="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).TOTAL)}"
                                       th:disabled="${viewmode == 'readonly'}" />
                                Calculate overheads
                            </label>
                    </fieldset>
                </div>
                <div class="form-group" id="overhead-none">
                    <h3 class="heading-medium">No overhead costs</h3>
                    <p>You are not currently applying for overhead costs</p>
                    <input type="hidden" value="£ 0" data-calculation-rawvalue="0" th:id="${'section-total-'+subSection.id+'-labour-cost-none'}"/>
                </div>
                <div id="overhead-default-percentage">
                    <h3 class="heading-medium">20% of labour costs</h3>
                    <p>There is no need to provide any further supporting documentation or calculations. Actual costs can be claimed up to a maximum of this calculated figure.</p>
                    <div class="alignright inline form-group">
                        <label th:for="${'section-total-'+subSection.id+'-default'}">
                            <span>Total overhead costs</span>
                        </label>
                        <input type="text"
                               th:name="${'overheads-totalCosts-' + question.id + '-'+overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-default'}"
                               th:attr="data-calculation-fields=${'#section-total-'+labourQuestion.section+',0.2'},data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="*"
                               th:value="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.getTotal(),0, 'COMMA', 0, 'POINT')} : '£ 0'" />
                    </div>
                </div>
                <div th:unless="${overheadCosts?.getUseTotalOption()}" id="overhead-custom-percentage">
                    <h3 class="heading-medium">Custom overhead costs</h3>
                    <p>
                        If you feel your overhead costs are higher than 20% you may calculate a value using an Innovate UK model.
                        The model shows you which types of indirect costs associated with your project you may claim. For support with this option,
                        please contact our Customer Support Service on 01793 44 2700. They will be happy to provide you with the calculation model sheet (together with guidance documentation).
                        Any value claimed under this model will be subject to a review. This will assess the appropriateness of your claim if your grant application is successful.
                    </p>
                    <div class="form-group alignright inline" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'error' : ''">
                        <label th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-customRate'}">
                            <span>Rate calculated (%)</span>
                            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+overheadCosts?.id+'-rate'})" />
                        </label>
                        <input type="number"
                               th:readonly="${viewmode == 'readonly'}"
                               th:name="${'overheads-customRate-' + question.id + '-'+overheadCosts?.id}"
                               th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-customRate'}"
                               min="1"
                               max="100"
                               required="required"
                               class="form-control form-control-1-4 alignright"
                               th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'field-error' : ''"
                               placeholder="0"
                               ifs:nonZeroValue="${overheadCosts?.getRate()!=null and overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)} ? ${overheadCosts?.getRate()} : 0" />
                    </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id+'-custom'}">
                          <span>Total overhead costs</span>
                        </label>
                        <input type="text"
                               th:name="${'overheads-totalCosts-' + question.id + '-'+overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-custom'}"
                               th:attr="data-calculation-fields=${'#section-total-'+labourQuestion.section+',100,#cost-'+ type + '-'+overheadCosts?.id+'-customRate'},data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="/,*"
                               th:value="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.getTotal(),0, 'COMMA', 0, 'POINT')} : '£ 0'"/>
                    </div>
                </div>
                <div th:if="${overheadCosts?.getUseTotalOption()}" id="overhead-total">
                    <h3 class="heading-medium">Calculate overheads</h3>
                    <p>
                        If you feel your overheads are higher than 20% you may calculate a value using the Innovate UK model in the spreadsheet available below.
                        The model shows you which types of indirect costs associated with your project you may claim.
                        For support with this option, please contact our Customer Support Service on 01793 44 2700. Any value claimed under this model will be subject to a review.
                        This will assess the appropriateness of your claim if your grant application is successful.
                    </p>
                    <div class="form-group download">
                        <h3 class="heading-small no-margin">Download the overhead calculation spreadsheet</h3>
                        <ul>
                            <li>Download as an Excel document <a href="/files/overheads.xlsx">overhead calculation spreadsheet.xlsx (16KB)</a></li>
                            <li>Download as an Open Office document <a href="/files/overheads.ods">overhead calculation spreadsheet.ods (10KB)</a></li>
                        </ul>
                    </div>
                    <div class="upload-section extra-margin">
                        <h3 class="heading-small no-margin">Upload your completed spreadsheet</h3>
                        <div class="form-group">
                            <input type="hidden" name="fileoverheadid" th:value="${overheadCosts?.id}"/>
                            <th:block th:with="uploadViewmode=${viewmode == 'readonly'} ? 'readonly' : 'edit',
                                               downloadUrl=@{${'/application/download/overheadfile/'+overheadCosts?.id}},
                                               filename=${overheadCosts?.calculationFile?.get()?.name},
                                               inputField='overheadfile',
                                               validationField='',
                                               mayRemove=${viewmode == 'readonly'},
                                               removeName='overheadfiledelete',
                                               saveName='overheadfilesubmit'">
                                <th:block th:insert="question-type/types :: fileupload-fragment(${uploadViewmode},${downloadUrl},${filename},${inputField},${validationField},${mayRemove},${removeName},${saveName})" />
                            </th:block>
                        </div>
                    </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id+'-total'}">
                            <span>Enter the total cost of overheads as calculated in the spreadsheet £</span>
                        </label>
                        <input type="text"
                               th:readonly="${viewmode=='readonly'}"
                               th:name="${'overheads-total-' + question.id + '-'+overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-calculate'}"
                               th:value="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).TOTAL)} ? ${costCategory?.getTotal()} : '0'"/>
                        <input type="hidden"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-calculate-formatted'}"
                               th:attr="data-calculation-fields='#'+${'cost-'+ type + '-'+overheadCosts?.id+'-calculate'}+',1',data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="*"
                               th:value="${overheadRate.equals(T(org.innovateuk.ifs.finance.resource.cost.OverheadRateType).TOTAL)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.getTotal(),0, 'COMMA', 0, 'POINT')} : '£ 0'"/>
                    </div>
                </div>
            </th:block>
        </th:block>
    </th:block>

    <!-- ===========================Form: materials =========================== -->
    <th:block th:fragment="materials (viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>

        <th:block th:if="${(viewmode == 'approved')}">
            <table id="material-costs-table">
                <thead>
                <tr>
                    <th id="materials-item" scope="col">Item</th>
                    <th id="materials-quantity" scope="col" class="numeric">Quantity</th>
                    <th id="materials-cost" scope="col" class="numeric">Cost per item</th>
                    <th id="materials-total" scope="col" class="numeric">Total</th>
                    <th scope="col" th:if="${viewmode == 'edit'}">
                        <span class="visuallyhidden">Actions</span>
                    </th>
                </tr>
                </thead>
                <tbody>
                    <tr th:each="cost, iteration : ${costCategory.costs}">
                        <td th:text="${cost.getItem()}"></td>
                        <td class="numeric" th:text="${cost.getQuantity()}"></td>
                        <td class="numeric" th:text="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}"></td>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(cost.total,0,'COMMA',0,'POINT')}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row" colspan="3">Total materials costs</th>
                        <td th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" class="numeric"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>

        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">

            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="material-costs-table">
                        <thead>
                        <tr>
                            <th id="materials-item" scope="col">Item</th>
                            <th id="materials-quantity" scope="col" class="numeric">Quantity</th>
                            <th id="materials-cost" scope="col" class="numeric">Cost per item</th>
                            <th id="materials-total" scope="col" class="numeric">Total</th>
                            <th scope="col" th:if="${viewmode == 'edit'}">
                                <span class="visuallyhidden">Actions</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost, iteration : ${costCategory.costs}">
                                <th:block th:insert="finance/finance :: materials_row" th:with="iterationIndex=${iteration.count}" />
                            </th:block>
                        </tbody>
                    </table>

                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:insert="question-type/types :: add_row(text='Add another materials cost', question=${question},rowcontainer='#material-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}">Total materials costs</label>
                    <input class="form-control alignright form-control-1-4"
                           readonly="readonly"
                           type="text"
                           data-calculation-fields="[id*=materialTotal]"
                           data-calculation-operations="+"
                           th:id="${'section-total-'+subSection.id}"
                           th:attr="data-calculation-rawvalue=${costCategory.total}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
                </div>
            </div>
        </th:block>
    </th:block>
    <!-- =========================== repeating rows - Materials  =========================== -->

    <th:block th:fragment="materials_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'error' : ''">
                    <label th:for="${'cost-materials-'+costIdentifier+'-item'}">
                        <span class="visuallyhidden">Item</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-item'})" />
                    </label>
                    <input type="text"
                           class="form-control width-full"
                           th:name="${'materials-item-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-item'}"
                           th:value="${cost.getItem()}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'field-error' : ''"
                           required="required"
                           maxlength="255" />
                </td>
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'error' : ''">
                  <label th:for="${'cost-materials-'+costIdentifier+'-quantity'}">
                      <span class="visuallyhidden">Quantity</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-quantity'})" />
                  </label>
                    <input type="number"
                           class="form-control width-full"
                           th:name="${'materials-quantity-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-quantity'}"
                           placeholder="0"
                           ifs:nonZeroValue="${cost.getQuantity()}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'field-error' : ''"
                           min="1"
                           max="999999999"
                           required="required"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                           />
                </td>
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''">
                    <label th:for="${'cost-materials-'+costIdentifier+'-cost'}">
                        <span class="visuallyhidden">Cost per item</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                    </label>
                    <input type="number"
                           class="form-control width-full"
                           th:name="${'materials-cost-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-cost'}"
                           ifs:nonZeroValue="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''"
                           placeholder="0"
                           min="1"
                           max="9999999999999999999"
                           required="required"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}" />
                </td>
                <td>
                  <label th:for="${'cost-materials-'+costIdentifier+'-materialTotal'}">
                      <span class="visuallyhidden">Total</span>
                  </label>
                    <input type="text"
                           class="alignright form-control width-full"
                           th:name="${'materials-total-' + question.id + '-' + costIdentifier}"
                           th:attr="data-calculation-fields='#'+${'cost-materials-'+costIdentifier+'-quantity'}+',#'+${'cost-materials-'+costIdentifier+'-cost'},data-calculation-rawvalue=${cost.total}"
                           th:id="${'cost-materials-'+costIdentifier+'-materialTotal'}"
                           data-calculation-operations="*"
                           readonly="readonly"
                           th:value="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 0)}"
                            />
                </td>
                <td class="alignright buttoncolumn remove" th:if="${viewmode == 'edit'}">
                    <button th:unless="${cost.id == null}"
                            type="submit"
                            name="remove_cost"
                            th:value="${cost.id}"
                            th:class="'buttonlink js-remove-row'"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                    <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </td>
            </tr>
        </th:block>
    </th:block>

    <!-- ===========================Form: capital usage =========================== -->
    <th:block th:fragment="capital_usage(viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>
        <th:block th:if="${(viewmode == 'approved')}">
            <table id="capital-usage-table">
                <thead>
                    <tr>
                        <th scope="col" id="cap-usage-description">Item description</th>
                        <th scope="col" id="cap-usage-new-existing">New or Existing</th>
                        <th scope="col" id="cap-usage-depreciation-period">Depreciation period</th>
                        <th scope="col" class="numeric" id="cap-usage-net-present-value">Net present value</th>
                        <th scope="col" class="numeric" id="cap-usage-residual-value">Residual value</th>
                        <th scope="col" class="numeric" id="cap-usage-utilisation">Utilisation</th>
                        <th scope="col" class="numeric" id="cap-usage-cost">Net cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.description}"></td>
                        <td th:text="${cost.existing}"></td>
                        <td th:text="${cost.deprecation}"></td>
                        <td class="numeric" th:text="${#numbers.formatDecimal(cost.npv,0,0)}"></td>
                        <td class="numeric" th:text="${#numbers.formatDecimal(cost.residualValue,0,0)}"></td>
                        <td class="numeric" th:text="${cost.utilisation}"></td>
                        <td class="numeric" th:text="'£ ' + ${cost.total &lt; 0 ? 0 : #numbers.formatDecimal(cost.total, 0, 0)}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="6">Total capital usage</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total &lt; 0 ? 0 : costCategory.total, 0, 'COMMA', 0, 'POINT')}">£0</td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div id="capital_usage">
                <th:block th:each="cost : ${costCategory.costs}">
                    <th:block th:insert="finance/finance :: capital_usage_row" />
                </th:block>
            </div>
            <p class="alignright" th:if="${viewmode == 'edit'}">
                <th:block th:insert="question-type/types :: add_row(text='Add another asset', question=${question},rowcontainer='#capital_usage')" />
            </p>
            <div class="form-group alignright extra-margin inline">
                <label th:for="${'section-total-'+subSection.id}">Total capital usage costs</label>
                <input class="form-control form-control-1-4 alignright"
                       readonly="readonly"
                       type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=netCost]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total &lt; 0 ? 0 : costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </th:block>
    </th:block>

    <!-- ===========================Form: capital usage repeating row =========================== -->

    <th:block th:fragment="capital_usage_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <div th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}" class="form-row">
                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-description]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-description'}">
                        <span>Item description</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-description'})" />
                      </label>
                    <th:block th:insert="question-type/form-elements :: form-finance-textarea (type='capital_usage', id=${costIdentifier}, name='description', value=${cost.getDescription()},readonly=${viewmode == 'readonly'},required=true)" />
                </div>
                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-existing]}')} ? 'error' : ''">
                    <fieldset class="inline">
                        <legend>New or existing item</legend>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-existing'})" />
                        <label class="block-label selection-button-radio selection-button-radio">
                            <input th:id="${'cost-capital_usage-'+costIdentifier+'-existing_0'}"
                                   type="radio"
                                   th:name="${'capital_usage-existing-' + question.id + '-' + costIdentifier}"
                                   value="New"
                                   required="required"
                                   th:checked="${cost.existing == 'New'}"
                                   th:disabled="${viewmode == 'readonly'}" />
                            New
                        </label>
                        <label class="block-label selection-button-radio selection-button-radio">
                            <input th:id="${'cost-capital_usage-'+costIdentifier+'-existing_1'}"
                                   type="radio"
                                   th:name="${'capital_usage-existing-' + question.id + '-' + costIdentifier}"
                                   value="Existing"
                                   required="required"
                                   th:checked="${cost.existing == 'Existing'}"
                                   th:disabled="${viewmode == 'readonly'}" />
                            Existing
                        </label>
                    </fieldset>
                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-deprecation]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-deprecation_period'}" class="form-label">
                        <span>Depreciation period (months)</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-deprecation'})" />
                    </label>
                    <input  type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-deprecation_period'}"
                            class="form-control form-finances-capital-usage-depreciation"
                            th:name="${'capital_usage-deprecation-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${cost.deprecation}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="1"
                            max="999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-deprecation]}')} ? 'field-error' : ''"
                             />
                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-npv]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-npv'}" class="form-label">
                        <span>Net present value at the start of your project or the price you bought it for (£)</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-npv'})" />
                    </label>
                    <input
                            type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-npv'}"
                            class="form-control form-finances-capital-usage-npv"
                            th:name="${'capital_usage-npv-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${cost.npv != null ? #numbers.formatDecimal(cost.npv,0,0) : '0'}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="1"
                            max="9999999999999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-npv]}')} ? 'field-error' : ''" />

                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-residualValue]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-residual_value'}" class="form-label">
                        <span>Residual value at end of project (£)</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-residualValue'})" />
                    </label>
                    <input
                            type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-residual_value'}"
                            class="form-control form-finances-capital-usage-residual-value"
                            th:name="${'capital_usage-residualValue-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${#numbers.formatDecimal(cost.residualValue,0,0)}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="0"
                            max="9999999999999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-residualValue]}')} ? 'field-error' : ''"/>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-utilisation]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-utilisation'}" class="form-label">
                        <span>Utilisation (%)</span>
                        <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-utilisation'})" />
                    </label>
                    <input type="number"
                           th:id="${'cost-capital_usage-'+costIdentifier+'-utilisation'}"
                           class="form-control form-finances-capital-usage-utilisation"
                           th:name="${'capital_usage-utilisation-' + question.id + '-' + costIdentifier}"
                           ifs:nonZeroValue="${cost.utilisation}"
                           th:readonly="${viewmode == 'readonly'}"
                           placeholder="0"
                           min="0"
                           max="100"
                           required="required"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-utilisation]}')} ? 'field-error' : ''"/>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-netCost]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-netCost'}" class="form-label">
                       <span>Net cost</span>
                       <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-netCost'})" />
                    </label>
                    <input type="text"
                           class="form-control"
                           th:attr="data-calculation-fields=${'#cost-capital_usage-'+costIdentifier+'-npv,#cost-capital_usage-'+costIdentifier+'-residual_value,#cost-capital_usage-'+costIdentifier+'-utilisation,100'}"
                           data-calculation-operations="-,*,/,negativeRoundUp"
                           readonly="readonly"
                           th:id="${'cost-capital_usage-'+costIdentifier+'-netCost'}"
                           th:name="${'capital_usage-netCost-' + question.id + '-' + costIdentifier}"
                           th:value="'£ ' + ${cost.total &lt; 0 ? 0 : #numbers.formatDecimal(cost.total, 0, 0)}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-netCost]}')} ? 'error' : ''"
                           />
                </div>
                <th:block th:if="${viewmode == 'edit'}">
                    <button th:unless="${cost.id == null}" type="submit"
                            name="remove_cost"
                            class="buttonlink js-remove-row"
                            th:value="${cost.id}"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                    <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </th:block>
            </div>
        </th:block>
    </th:block>

    <!-- ===========================Form: subcontracting cost =========================== -->
    <th:block th:fragment="subcontracting (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>
        <th:block th:if="${viewmode == 'approved'}">
            <table id="subcontracting-table">
                <thead>
                    <tr>
                        <th scope="col" id="subcontracting-name">Subcontractor name</th>
                        <th scope="col" id="subcontracting-country">Country</th>
                        <th scope="col" id="subcontracting-role">Role</th>
                        <th scope="col" class="numeric" id="subcontracting-cost">Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.name}">Mr Francis Bois</td>
                        <td th:text="${cost.country}">France</td>
                        <td th:text="${cost.role}">Specialist consultant</td>
                        <td class="numeric" th:text="'£ '+${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}">£ 150,000</td>
                    </tr>
                </tbody>
                <tfoot>
                <tr>
                    <th colspan="3" scope="row">Total subcontracting costs</th>
                    <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}">£150,000</td>
                </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div id="subcontracting">
                <th:block th:each="cost : ${costCategory.costs}">
                    <th:block th:insert="finance/finance :: subcontracting_row" />
                </th:block>
            </div>
            <p class="alignright" th:if="${viewmode == 'edit'}">
              <th:block th:insert="question-type/types :: add_row(text='Add another subcontractor', question=${question},rowcontainer='#subcontracting')" />
            </p>
            <div class="form-group alignright extra-margin inline">
                <label th:for="${'section-total-'+subSection.id}">Total subcontracting costs</label>
                <input class="form-control form-control-1-4 alignright"
                       readonly="readonly"
                       type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=subcontractingCost]"
                       data-calculation-operations="+"
                       th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </th:block>
    </th:block>

    <th:block th:fragment="subcontracting_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <div class="form-row" th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-name]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-name'}">
                    <span>Subcontractor name</span>
                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-name'})" />
                </label>
                <input type="text"
                       th:name="${'subcontracting-name-' + question.id + '-' + costIdentifier}"
                       class="form-control form-finances-subcontracting-company"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-name'}"
                       th:value="${cost.name}"
                       th:readonly="${viewmode == 'readonly'}"
                       maxlength="255"
                       required="required"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-name]}')} ? 'field-error' : ''"  />
            </div>
            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-country]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-country'}">
                    <span>Country where the subcontractor will work</span>
                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-country'})" />
                </label>
                <input type="text"
                       th:name="${'subcontracting-country-' + question.id + '-' + costIdentifier}"
                       class="form-control"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-country'}"
                       th:value="${cost.country}"
                       th:readonly="${viewmode == 'readonly'}"
                       maxlength="255"
                       required="required"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-country]}')} ? 'field-error' : ''"   />
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-'+ type + '-'+costIdentifier+'-role'}">
                  <span>Role of the subcontractor in the project and description of the work they’ll do</span>
                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-role'})" />
                </label>

                <th:block th:insert="question-type/form-elements :: form-finance-textarea (type='subcontracting', id=${costIdentifier}, name='role', value=${cost.role},readonly=${viewmode == 'readonly'},required=true)" />
            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-subcontractingCost'}">
                      <span>Cost</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                  </label>
                <input type="number"
                       class="form-control"
                       th:name="${'subcontracting-subcontractingCost-' + question.id + '-' + costIdentifier}"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-subcontractingCost'}"
                       ifs:nonZeroValue="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''"
                       />
            </div>
            <th:block th:if="${(viewmode == 'edit')}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </th:block>
        </div>
        </th:block>
    </th:block>

    <!-- ===========================Form: travel cost =========================== -->

    <th:block th:fragment="travel (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.description}"></p>

        <th:block th:if="${(viewmode == 'approved')}">
            <table id="travel-costs-table">
                <thead>
                    <tr>
                        <th id="travel-purpose">Purpose of journey or description of subsistence cost</th>
                        <th id="travel-times" class="numeric">Number of times</th>
                        <th id="travel-cost" class="numeric">Cost each (£)</th>
                        <th id="travel-total" class="numeric">Total (£)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost, iteration : ${costCategory.costs}">
                        <td th:text="${cost.item}"></td>
                        <td class="numeric" th:text="${cost.quantity}"></td>
                        <td class="numeric" th:text="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"></td>
                        <td class="numeric" th:text="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row" colspan="3">Total travel and subsistence</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="travel-costs-table">
                        <thead>
                        <tr>
                            <th id="travel-purpose">Purpose of journey or description of subsistence cost</th>
                            <th id="travel-times" class="numeric">Number of times</th>
                            <th id="travel-cost" class="numeric">Cost each (£)</th>
                            <th id="travel-total" class="numeric">Total (£)</th>
                            <th th:if="${viewmode == 'edit'}"><span class="visuallyhidden">Actions</span></th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost, iteration : ${costCategory.costs}">
                                <th:block th:insert="finance/finance :: travel_row" th:with="iterationIndex=${iteration.count}" />
                            </th:block>
                        </tbody>
                    </table>

                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:insert="question-type/types :: add_row(text='Add another travel cost', question=${question},rowcontainer='#travel-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}">Total travel &amp; subsistence costs</label>
                    <input class="form-control form-control-1-4 alignright"
                           readonly="readonly"
                           type="text"
                           data-calculation-fields="[id*=travelCostTotal]"
                           data-calculation-operations="+"
                           th:id="${'section-total-'+subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"
                           title="Total travel and subsistence costs" />
                </div>
            </div>
        </th:block>
    </th:block>
    <!-- ===========================repeating rows : travel cost =========================== -->

    <th:block th:fragment="travel_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
              <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'error' : ''">
                <label th:for="${'cost-travel-'+costIdentifier+'-item'}">
                      <span class="visuallyhidden">Purpose of journey or description of subsistence cost</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-item'})" />
                </label>
                <input type="text"
                       th:name="${'travel-item-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-item'}"
                       th:value="${cost.item}"
                       th:readonly="${viewmode == 'readonly'}"
                       required="required"
                       maxlength="255"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'field-error' : ''"/>
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'error' : ''">
                <label th:for="${'cost-travel-'+costIdentifier+'-quantity'}">
                      <span class="visuallyhidden">Number of times</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-quantity'})"  />
                </label>
                <input type="number"
                       th:name="${'travel-quantity-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-quantity'}"
                       ifs:nonZeroValue="${cost.quantity}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'field-error' : ''"  />
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''">
                <label th:for="${'cost-travel-'+costIdentifier+'-cost'}">
                      <span class="visuallyhidden">Cost each (&pound;)</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                </label>
                <input type="number"
                       th:name="${'travel-cost-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-cost'}"
                       ifs:nonZeroValue="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''" />
            </td>
            <td class="numeric">
                <label th:for="${'cost-travel-'+costIdentifier+'-travelCostTotal'}">
                    <span class="visuallyhidden">Total (&pound;)</span>
                </label>
                <input type="text"
                       th:name="${'travel-travelCostTotal-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       readonly="readonly"
                       th:id="${'cost-travel-'+costIdentifier+'-travelCostTotal'}"
                       th:attr="data-calculation-fields='#'+${'cost-travel-'+costIdentifier+'-cost'}+',#'+${'cost-travel-'+costIdentifier+'-quantity'},data-calculation-rawValue=${cost.getTotal()}"
                       data-calculation-operations="*"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
            </td>
            <td th:if="${viewmode == 'edit'}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </td>
        </tr>
        </th:block>
    </th:block>

    <!-- ===========================Form: other cost =========================== -->
    <th:block th:fragment="other_costs (viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))},type=${formInput.type.nameLower}">
        <p th:text="${question.description}" />
        <th:block th:if="${(viewmode == 'approved')}">
            <table id="other-costs-table">
                <thead>
                <tr>
                    <th id="other_costs-description" scope="col" >Description and justification of the cost</th>
                    <th id="other_costs-cost" scope="col" class="numeric">Estimated cost (£)</th>
                </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.description}"></td>
                        <td class="numeric" th:text="'£ ' + ${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row">Total other costs</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="other-costs-table">
                        <thead>
                            <tr>
                                <th id="other_costs-description" scope="col" >Description and justification of the cost</th>
                                <th id="other_costs-cost" scope="col" class="numeric">Estimated cost (£)</th>
                                <th scope="col" th:if="${viewmode == 'edit'}"><span class="visuallyhidden">Actions</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost : ${costCategory.costs}">
                                <th:block th:insert="finance/finance :: other_costs_row" />
                            </th:block>
                        </tbody>
                    </table>
                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:insert="question-type/types :: add_row(text='Add another cost', question=${question},rowcontainer='#other-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}"> Total other costs</label>
                    <input class="form-control form-control-1-4 alignright"
                           readonly="readonly" type="text"
                           th:id="${'section-total-'+subSection.id}"
                           data-calculation-fields="[id*=otherCost]"
                           data-calculation-operations="+"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"/>
                </div>
            </div>
        </th:block>
    </th:block>


    <th:block th:fragment="other_costs_row" th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-description]}')} ? 'error' : ''">
                <label th:for="${'cost-'+ type + '-'+costIdentifier+'-description'}">
                    <span class="visuallyhidden">Description and justification of the cost</span>
                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-description'})" />
                </label>
                <th:block th:insert="question-type/form-elements :: form-finance-textarea (type='other_costs', id=${costIdentifier}, name='description', value=${cost.description},readonly=${viewmode == 'readonly'},required=true)"  />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''"  >
                <label th:for="${'cost-other_costs-'+costIdentifier+'-otherCost'}">
                  <span class="visuallyhidden">Estimated cost (&pound;)</span>
                  <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})"  />
                </label>
                <input type="number"
                       th:name="${'other_costs-otherCost-' + question.id + '-' + costIdentifier}"
                       class="form-control"
                       th:id="${'cost-other_costs-'+costIdentifier+'-otherCost'}"
                       ifs:nonZeroValue="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''"  />
            </td>
            <td th:if="${viewmode == 'edit'}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        class="buttonlink js-remove-row"
                        name="remove_cost"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </td>
        </tr>
    </th:block>


    <!-- ===========================Form: Other funding=========================== -->
    <th:block th:fragment="other_funding"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <th:block th:with="readonly=${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <th:block th:if="${readonly}">
                <h2 class="heading-medium">Other funding for this project</h2>
                <th:block th:if="${costCategory.otherPublicFunding?.equals('No')}">
                    <p>No other funding</p>
                </th:block>
                <th:block th:if="${costCategory.otherPublicFunding?.equals('Yes')}">
                    <table>
                        <thead>
                        <tr>
                            <th id="other-funding-source">Source of funding</th>
                            <th id="other-funding-date" class="width-medium">Date secured</th>
                            <th id="other-funding-amount" class="width-medium">Funding amount</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr th:each="cost : ${costCategory.costs}" th:unless="${cost.fundingAmount == null}">
                                <th scope="row" th:text="${cost.fundingSource}">National rail</th>
                                <td th:text="${cost.securedDate}">17 April 2016</td>
                                <td class="numeric" th:text="'£ ' + ${cost.fundingAmount != null ? #numbers.formatInteger(cost.fundingAmount,0,'COMMA') : '0'}"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th scope="row" colspan="2">Total other funding</th>
                                <td class="numeric" th:text="'£ ' + ${#numbers.formatInteger(costCategory.getTotal(), 0, 'COMMA')}"></td>
                            </tr>
                        </tfoot>
                    </table>
                </th:block>
            </th:block>
            <th:block th:unless="${readonly}">
                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.otherFundingCostItem?.id +'-otherPublicFunding]}') or #fields.hasErrors('${form.formInput['+ question.id +']}')}? 'error'">
                    <h2 th:text="${question.getName()}" class="heading-medium"></h2>
                    <fieldset class="inline" id="otherFundingShowHideToggle">
                        <legend>
                            <span class="visuallyhidden" th:text="${question.getName()}"></span>
                            <th:block th:insert="question-type/form-elements :: form-hint (hint=${question.getDescription()})" />
                            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${question.id})" />
                            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding'})" />
                        </legend>
                        <th:block th:insert="question-type/form-elements :: form-guidance (guidable=${formInput})" />
                        <div class="form-block inline">
                            <label th:class="${'block-label selection-button-radio'  + (costCategory.otherPublicFunding?.equals('Yes') ? ' selected focused' : '')}"
                                   th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                                   data-target="other-funding-table">
                                <input type="radio"
                                       th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                                       th:name="${'other_funding-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                                       value="Yes"
                                       required="required"
                                       th:checked="${costCategory.otherPublicFunding?.equals('Yes')}" />
                                Yes
                            </label>
                            <label th:class="${'block-label selection-button-radio'  + (costCategory.otherPublicFunding?.equals('No') ? ' selected focused' : '')}"
                                   th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}">
                                <input type="radio"
                                       th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}"
                                       th:name="${'other_funding-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                                       value="No"
                                       required="required"
                                       th:checked="${costCategory.otherPublicFunding?.equals('No')}" />
                                No
                            </label>
                        </div>
                        <div id="other-funding-table">
                            <div class="form-group" th:attr="data-repeatable-container=${question.getId()}">
                                <table>
                                    <thead>
                                        <tr>
                                            <th scope="col" id="other-funding-source">Source of funding</th>
                                            <th scope="col" id="other-funding-date" class="width-medium">Date secured</th>
                                            <th scope="col" id="other-funding-amount" class="width-medium">Funding amount (£)</th>
                                            <th scope="col"><span class="visuallyhidden">Actions</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <th:block th:each="cost : ${costCategory.costs}">
                                            <th:block th:insert="finance/finance :: other_funding_row" />
                                        </th:block>
                                    </tbody>
                                </table>
                                <p class="alignright">
                                    <th:block th:insert="question-type/types :: add_row(text='Add another source of funding', question=${question},rowcontainer='#other-funding-table tbody')" />
                                </p>
                            </div>
                            <div class="form-group alignright inline">
                                <label for="other-funding-total">Total other funding</label>
                                <input class="form-control form-control-1-4 alignright"
                                       data-calculation-fields="[id*=fundingAmount]"
                                       data-calculation-operations="+"
                                       id="other-funding-total"
                                       th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                                       readonly="readonly"
                                       type="text"
                                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
                            </div>
                        </div>
                    </fieldset>
                </div>
            </th:block>
        </th:block>
    </th:block>

    <th:block th:fragment="other_funding_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingSource]}')} ? 'error' : ''">
                    <label th:for="${'cost-other_funding-'+costIdentifier+'-source'}">
                          <span class="visuallyhidden">Source of funding</span>
                          <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-fundingSource'})" />
                    </label>
                    <input type="text"
                           th:name="${'other_funding-fundingSource-' + question.id + '-' + costIdentifier}"
                           class="form-control width-full"
                           th:id="${'cost-other_funding-'+costIdentifier+'-source'}"
                           th:value="${cost.fundingSource}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingSource]}')} ? 'field-error' : ''"
                           required="required"
                           maxlength="255"
                           th:attr="data-required-errormessage=#{validation.finance.funding.source.blank}" />
                </td>
                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-securedDate]}')} ? 'error' : ''">
                    <label th:for="${'cost-other_funding-'+costIdentifier+'-date'}">
                      <span class="visuallyhidden">Date secured</span>
                      <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-securedDate'})" />
                    </label>
                    <input type="text"
                           th:name="${'other_funding-securedDate-' + question.id + '-' + costIdentifier}"
                           class="form-control width-medium"
                           th:id="${'cost-other_funding-'+costIdentifier+'-date'}"
                           placeholder="MM-YYYY"
                           pattern="(0[1-9]|1[012])-[0-9]{4}"
                           th:attr="data-pattern-errormessage=#{validation.finance.secured.date.invalid}"
                           maxlength="7"
                           th:value="${cost.securedDate}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-securedDate]}')} ? 'field-error' : ''"
                           required="required" />
                </td>

                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingAmount]}')} ? 'error' : ''">
                  <label th:for="${'cost-other_funding-'+costIdentifier+'-fundingAmount'}">
                    <span class="visuallyhidden">Funding amount (&pound;)</span>
                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-fundingAmount'})" />
                  </label>
                    <input class="form-control width-medium"
                           type="number"
                           th:name="${'other_funding-fundingAmount-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-other_funding-'+costIdentifier+'-fundingAmount'}"
                           ifs:nonZeroValue="${cost.fundingAmount != null ? #numbers.formatDecimal(cost.fundingAmount,0,0) : '0'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingAmount]}')} ? 'field-error' : ''"
                           required="required"
                           placeholder="0"
                           min="1"
                           max="9999999999999999999"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}" />
                </td>
                <td>
                    <button th:unless="${cost.id == null}"
                            type="submit"
                            name="remove_cost"
                            class="buttonlink js-remove-row"
                            th:value="${cost.id}"
                            th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                    </button>
                    <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </td>
            </tr>
        </th:block>
    </th:block>
</html>
