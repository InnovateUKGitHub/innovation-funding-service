<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:ifs="http://www.w3.org/1999/xhtml">
    <!-- ===========================Form: Add row button =========================== -->
    <div th:fragment="add_row(text, question, rowcontainer)">
        <button type="submit"
                name="add_cost"
                th:value="${question.id}"
                th:class="'buttonlink'"
                class="add-another-row buttonlink"
                th:attrappend="data-repeatable-rowcontainer=${rowcontainer}"
                th:text="${text}"
                >
        </button>
    </div>

    <!-- ===========================Form: Textinput =========================== -->

    <div th:fragment="textinput" class="form-group " th:classappend="${#fields.hasErrors(validationId)} ? adminclass : userclass">

        <label class="form-label form-label-bold" th:for="${formInput.getId()}">
          <span th:if="${question.getName()}" th:text="question.getName()" />
          <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
          <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        </label>

        <div th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-textinput (id=${formInput.getId()}, response=${responses?.get(formInput.getId())?.getValue()})" th:remove="tag" />
    </div>

    <!-- =========================== Form: Textarea =========================== -->
    <!-- === (defaults to the wrapped textarea with wordcount and statusses)=== -->

    <div th:fragment="textarea"  class="form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.getId()}__]')} ? error : ''">

      <label class="form-label form-label-bold" th:for="'form-textarea-'+${formInput.getId()}" th:id="'form-label-'+${formInput.getId()}">
        <span th:if="${readonly} and ${question.getName()}" th:text="${question.name}" />
        <span th:unless="${readonly}" th:if="${question.getName()}" th:text="${question.questionNumber!=null ? question.questionNumber + '. ' : '' } + ${question.name}" />
        <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag"  />
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
      </label>
      <div th:unless="${readonly}" th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag"  />
      <div th:include="question-type/form-elements :: form-textarea-wrapped" th:remove="tag" />
    </div>


    <!-- ===========================Form: Date input =========================== -->

    <div th:fragment="date" class="form-group">
        <label class="form-label form-label-bold" th:for="${formInput.getId()}">
          <span th:if="${question.getName()}" th:text="${question.name}" />
          <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
          <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        </label>
        <div th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-dateinput (id=${formInput.getId()}, day='', month='', year='')" th:remove="tag" />
    </div>

    <!-- ===========================Form: Fileupload =========================== -->
    <div th:fragment="fileupload" class="upload-section" th:classappend="${#fields.hasErrors('formInput[__${formInput.getId()}__]')} ? error : ''"
         th:with="currentUser=${#authentication.getDetails()},validationId='formInput['+${question.getId()}+']',
         noFileUploaded=${(#strings.isEmpty(responses?.get(formInput.getId())?.getFilename())) and (question.isMarkAsCompletedEnabled() and not markedAsComplete?.contains(question.id) and (questionAssignee?.assigneeUserId == currentUser?.getId() or (questionAssignee?.getAssignee() == null)))},
         downloadURL='/application/' + ${currentApplication.id} + '/form/question/' + ${question.id} + '/forminput/' + ${formInput.id} + '/download',
         compManagementDownloadURL=${currentApplication.id} + '/forminput/' + ${formInput.id} + '/download',
         filename=${responses?.get(formInput.getId())?.getFilename()},
         removeName=${removeName != null}? ${removeName} : 'remove_uploaded_file',
         readonly=${readonly} or
                ${question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)} or
                ${(currentUser.getId() != questionAssignee?.assigneeUserId and  questionAssignee?.assignee!=null) or
		 		(questionAssignee?.assignee==null and !userIsLeadApplicant)}">
        <h3 class="heading-small no-margin" th:text="${formInput.getDescription()}">Project management appendix</h3>

        <div th:unless="${readonly}" th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag"  />
        <input th:unless="${readonly}" th:if="${noFileUploaded}" type="file" th:id="${formInput.getId()}" th:name="${name != null} ? ${name} : 'formInput['+${formInput.getId()}+']'" class="inputfile"/>
        <label th:unless="${readonly}" th:if="${noFileUploaded}" th:for="${formInput.getId()}" class="button-secondary extra-margin">+ Upload</label>
        <button th:unless="${readonly}" th:if="${noFileUploaded}" name="upload_file" class="button-secondary" type="submit" th:attr='data-for-file-upload=${formInput.getId()}'>Save</button>
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:if="${!#strings.isEmpty(filename)}">
            <div>
                <a th:if="${isCompManagementDownload}" th:href="@{${compManagementDownloadURL}}" class="uploaded-file" th:text="${filename}">The-uploaded-file-example.pdf</a>
                <a th:unless="${isCompManagementDownload}" th:href="@{${downloadURL}}" class="uploaded-file" th:text="${filename}">The-uploaded-file-example.pdf</a>
            </div>
            <div th:unless="${readonly}" class="alignright" th:if="${(not question.isMarkAsCompletedEnabled() or (question.isMarkAsCompletedEnabled() and not markedAsComplete?.contains(question.id) and (questionAssignee?.assigneeUserId == currentUser?.getId() or (questionAssignee?.getAssignee() == null))))}">
                <button class="button-secondary no-margin-right" type="submit" th:name="${removeName}">Remove</button>
            </div>
        </div>
        <div th:unless="${!#strings.isEmpty(filename)}">
            <p class="uploaded-file">No file currently uploaded</p>
        </div>
    </div>

    <!-- ===========================Form: Percentage =========================== -->

    <div th:fragment="percentage" class="form-group">
        <label class="form-label" th:for="${formInput.getId()}">
          <span th:if="${question.getName()}" th:text="${question.name}" />
          <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
          <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        </label>
        <div th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-number-extra-small (id=${formInput.getId()}, field=${field})" th:remove="tag" />
        <span>%</span>
    </div>

    <!-- ===========================Form: application_details =========================== -->

    <div th:fragment="application_details" th:remove="tag">
        <div th:unless="${appIsClosed}" th:remove="tag">
            	<div th:with="readonly=${readonly} or ${markedAsComplete?.contains(question.id)
            							 or (currentUser.getId() != questionAssignee?.assigneeUserId and questionAssignee?.assignee!=null) or
        		 					    (questionAssignee?.assignee==null and !userIsLeadApplicant)}" th:remove="tag">
        	        <div class="form-group">
        	            <label class="form-label form-label-bold" th:for="application_details-title">
        	                  <span>Project title</span>
        	                  <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint='Enter the full title of your project')" th:remove="tag" />
        	                  <div th:include="question-type/form-elements :: form-validation-messages (id='application_details-title')" th:remove="tag" />
        	            </label>
                        <div th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />
                        <input class="form-control width-full"
                             th:readonly="${readonly}"
                             type="text"
                             id="application_details-title"
                             th:field="*{__application.name__}"
                             th:attr="data-required-errormessage='Please enter the full title of the project'"
                             required="required"
                              />
                    </div>

                        <fieldset>
                            <div class="form-group">
                                <legend>
                                    <span class="form-label form-label-bold">Is this application a resubmission of a previous application?</span>
                                    <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint='Let us know if this is an application you have previously submitted to Innovate UK in another competition.')" th:remove="tag" />
                                    <div th:include="question-type/form-elements :: form-validation-messages (id='application_details-resubmissione')" th:remove="tag" />
                                </legend>

                                <label th:class="${'block-label'  + (currentApplication.resubmission != null and currentApplication.resubmission ? ' selected focused' : '')}"
                                       th:for="resubmission-yes"
                                       data-target="resubmission-details">
                                    <input type="radio"
                                           th:id="resubmission-yes"
                                           th:field="*{__application.resubmission__}"
                                           value="true"
                                           required="required"
                                           th:disabled="${readonly}"
                                           th:checked="${currentApplication.resubmission != null and currentApplication.resubmission}"
                                    />
                                    Yes
                                </label>
                                <label th:class="${'block-label'  + (currentApplication.resubmission != null and !currentApplication.resubmission ? ' selected focused' : '')}"
                                       th:for="resubmission-no">
                                    <input type="radio"
                                           th:id="resubmission-no"
                                           th:field="*{__application.resubmission__}"
                                           th:disabled="${readonly}"
                                           value="false"
                                           required="required"
                                           th:checked="${currentApplication.resubmission != null and !currentApplication.resubmission}"
                                    />
                                    No
                                </label>
                            </div>
                        </fieldset>
                        <div id="resubmission-details">
                            <div class="form-group">
                                <h2 class="heading-medium no-margin">Please provide the details of this previous application</h2>
                            </div>
                            <div class="form-group">
                                <label class="form-label form-label-bold" th:for="application_details-previousapplicationnumber">
                                    <span>Previous application number</span>
                                    <div th:include="question-type/form-elements :: form-validation-messages (id='application_details-previousapplicationnumber')" th:remove="tag" />
                                </label>
                                <input class="form-control width-full"
                                       th:readonly="${readonly}"
                                       type="text"
                                       id="application_details-previousapplicationnumber"
                                       th:field="*{__application.previousApplicationNumber__}"
                                       required="required"
                                />
                            </div>
                            <div class="form-group">
                                <label class="form-label form-label-bold" th:for="application_details-previousapplicationtitle">
                                    <span>Previous application title</span>
                                    <div th:include="question-type/form-elements :: form-validation-messages (id='application_details-previousapplicationtitle')" th:remove="tag" />
                                </label>
                                <input class="form-control width-full"
                                       th:readonly="${readonly}"
                                       type="text"
                                       id="application_details-previousapplicationtitle"
                                       th:field="*{__application.previousApplicationTitle__}"
                                       required="required"
                                />
                            </div>
                        </div>
                            <fieldset>
                                <div class="form-group">
                                     <legend>
                                         <span class="form-label form-label-bold">Estimated timescales</span>
                                         <span>Project start date</span>
                                         <div th:include="question-type/form-elements :: form-validation-messages (id='details-application-timescale')" th:remove="tag" />
                                         <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint='For example: 31 12 2015')" th:remove="tag" />
                                     </legend>

                                  <div th:include="question-type/form-elements :: form-dateinput (id='application_details-startdate', field='application.startDate',readonly=${readonly})" th:remove="tag" /><br/>
                              </div>
                              <div class="form-group" th:with="id='application_details-duration', field='application.durationInMonths',readonly=${readonly}">
                                  <th:block th:include="question-type/form-elements :: form-label (name='Duration in months',id=${id},bold=false)" />
                                  <th:block th:include="question-type/form-elements :: form-validation-messages (id=${id})"  />
                                  <input class="form-control width-extra-small"
                                         th:classAppend="${readonly == true ? 'js-visited':''}"
                                         th:readonly="${readonly}"
                                         th:id="${id}"
                                         th:field="*{__${field}__}"
                                         type="number"
                                         min="1"
                                         max="36"
                                         required="required"
                                         data-required-errormessage="Please enter a valid value"
                                         data-min-errormessage="Your project should last between 1 and 36 months"
                                         data-max-errormessage="Your project should last between 1 and 36 months " />
                              </div>
                          </fieldset>
                      </div>
                        <div class="form-group">
                            <h2 class="heading-medium no-margin">Lead organisation</h2>
                            <div th:text="${leadOrganisation.name}" />
                        </div>
                        <div class="form-group">
                            <h2 class="heading-medium no-margin">Partners</h2>
                            <ul class="list-bullet">
                                <li th:each="organisation : ${applicationOrganisations}" th:unless="${organisation.equals(leadOrganisation)}">
                                    <span th:text="${organisation.getName()}"></span>
                                </li>
                                <li th:each="pendingOrganisationName : ${pendingOrganisationNames}">
                                    <span th:text="${pendingOrganisationName}"></span>
                                    <small>(pending)</small>
                                </li>
                            </ul>
                        </div>
                        <div th:unless="${(currentUser.getId() != questionAssignee?.assigneeUserId and questionAssignee?.assignee!=null) or
                                                 (questionAssignee?.assignee==null and !userIsLeadApplicant)}" th:remove="tag">
                            <p>
                                <div th:if="${readonly}" th:include="question-type/form-elements :: form-edit-question-button" th:remove="tag"/>
                                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
                            </p>
                        </div>
                        </div>
                        <div th:if="${appIsClosed}" th:remove="tag">
                            <div class="grid-row">
                              <div class="column-half">
                                <h3 class="heading-small">Project title</h3>
                                <p th:text="${currentApplication.name}" />
                                <h3 class="heading-small">Lead organisation</h3>
                                <p th:text="${leadOrganisation.name}" />
                                <h3 class="heading-small">Partners</h3>
                                <ul class="list-bullet">
                                    <li th:each="organisation : ${applicationOrganisations}" th:unless="${organisation.equals(leadOrganisation)}">
                                        <span th:text="${organisation.getName()}"></span>
                                    </li>
                                    <li th:each="pendingOrganisationName : ${pendingOrganisationNames}">
                                        <span th:text="${pendingOrganisationName}"></span>
                                        <small>(pending)</small>
                                    </li>
                                </ul>
                              </div>
                              <div class="column-half">
                                  <h3 class="heading-small">Project timescales</h3>
                                  <p>Project start date:<br/>
                                    <div th:if="${currentApplication.getStartDate() != null}" th:text="${#temporals.format(currentApplication.getStartDate(), 'd MMMM yyyy')}" th:remove="tag" />
                                  </p>
                                  <p>Duration:<br/><div th:remove="tag" th:text="${currentApplication.getDurationInMonths()}" /> months</p>
                              </div>
                            </div>

                        </div>
                    </div>
                    <!-- ===========================Form: empty / no question =========================== -->
    <div th:fragment="empty" th:remove="tag">
        <div ifs:utext="${question.getDescription()}" th:remove="tag" />
        <div th:unless="${readonly}" th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />
    </div>

</html>
