<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Application Dashboard'" th:remove="tag" />
    <link href="/css/prototype.css" media="screen" rel="stylesheet" type="text/css" />

</head>

<body>

<div th:include="prototypes/fragments/layout :: prototype-nav" th:remove="tag" />
<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />


<main id="content">
    <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
    <div th:include="prototypes/fragments/applicant-view :: prototype-subheader(${'Finance checks'}, ${'/prototypes/1199-project-finances'})" th:remove="tag" />

	<!-- HARDCODED PROTOTYPE HTML -->
	
	<div th:include="prototypes/fragments/comp-admin :: prototype-comp-admin-page-title-subheading(${'0102468: Technology inspired'}, ${'Aptrans Ltd'}, ${'Eligibility'})" th:with="partner=lead" th:remove="tag" />

	<!-- <div th:include="prototypes/fragments/comp-admin :: prototype-comp-navigation" th:with="page='project-setup', status='closed'" th:remove="tag" /> -->
	
	<hr />
	
	<th:block th:if="${param.status != null and param.status[0] == 'warning'}">
		<div class="warning-alert">
			<h2 class="heading-small no-margin-top">The funding sought has exceeded the amount approved due to increased project costs.</h2>

			<p>Agree a reduced project cost amount with the applicant.</p>

			<dl class="standard-definition-list">
				<dt class="standard-text-colour">Funding sought:</dt>
				<dd class="standard-text-colour">&pound;67,544</dd>

				<dt>Current funding:</dt>
				<dd>&pound;70,000</dd>
			</dl>
		</div>
	</th:block>


	<th:block th:if="${param.status != null and param.status[0] == 'approved'}">
		<div class="success-alert">
			The partner finance eligibility has been approved by Paul Davidson, 27 July 2016
		</div>
	</th:block>

	<h2 class="heading-medium">Finances overview</h2>

	<div class="table-overflow">
		<table>
			<thead>
				<tr>
					<th scope="col">Project duration</th>
					<th scope="col">Total costs</th>
					<th scope="col" class="numeric">% grant</th>
					<th scope="col" class="numeric">Funding sought</th>
					<th scope="col" class="numeric">Other public sector funding</th>
					<th scope="col" class="numeric">Contribution to project</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>36 months</td>
					<td>&pound;286,283</td>
					<td class="numeric">55%</td>
					<td class="numeric">&pound;180,399</td>
					<td class="numeric">20,000</td>
					<td class="numeric">&pound;85,885</td>
				</tr>
			</tbody>
		</table>
	</div>
	
	<th:block th:if="${param.status != null and param.status[0] == 'grantChanged' or param.action != null and param.action[0] == 'grantChanged'}">
		<div class="panel-indent">
			<h3 class="heading-medium no-margin-top">% Grant has been reduced from 55% to 40% </h3>
			<dl class="standard-definition-list">
				<dt>Funding sought</dt>
				<dd>&pound;180,399</dd>

				<dt>Funding granted</dt>
				<dd>&pound;160,000</dd>
			</dl>
		</div>
	</th:block>

	<form>

		<th:block th:unless="${param.status != null and param.status[0] == 'approved'}">

			<h3 class="heading-medium">Project finance overview</h3>

			<p>These finances were initially submitted at the application stage. All saved changes to finances will be viewable by the applicants.</p>

			<p>All potential changes must be discussed with the lead applicant. You can do this by raising queries through IFS.</p>

			<a href="/prototypes/1581-changes-finances">Review all changes to project finances</a>

		</th:block>


		<th:block th:if="${param.status != null and param.status[0] == 'approved'}">
			
			<h3 class="heading-medium">Detailed finances</h3>

			<p>These finances were submitted by the applicant during the application stage. They include all changes made during the eligibility checks.</p>

			<a href="/prototypes/1581-changes-finances">View changes to finances</a>

		</th:block>

		<div class="collapsible section-overview extra-margin">
	        
	       	<h2>Labour
		       <span data-mirror="#section-total-1">&pound; 126,207</span> <span class="section-percentage">50%</span>
	       	</h2>
				
			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-labour" th:remove="tag" />

	    	<h2>Administration support costs
	    		<span data-mirror="#section-total-2">&pound; 0</span> <span class="section-percentage">(40% of labour) 20%</span>
	       	</h2>

			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-admin-support" th:remove="tag" />

			<h2>Materials
		        <span data-mirror="#section-total-3">&pound; 8,600</span> <span class="section-percentage">10%</span>
	       	</h2>

			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-materials" th:remove="tag" />
	    	
	    	<h2>Capital usage
		        <span data-mirror="#section-total-4">&pound; 0</span> <span class="section-percentage">0%</span>
	       	</h2>

			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-capital" th:remove="tag" />
	    	
	    	<h2>Subcontracting costs
		        <span data-mirror="#section-total-5">&pound; 150,000</span> <span class="section-percentage">20%</span>
	       	</h2>

			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-subcontracting" th:remove="tag" />
	    
	    	<h2>Travel and subsistence
		        <span data-mirror="#section-total-6">&pound; 0</span> <span class="section-percentage">0%</span>
	       	</h2>
			
			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-travel" th:remove="tag" />

	    	<h2>Other costs
				<span data-mirror="#section-total-3">&pound; 0</span> <span class="section-percentage">0%</span>
	       	</h2>

			<div th:include="prototypes/fragments/finance-review-questions :: finance-question-other" th:remove="tag" />

	    </div>

		<div class="grid-row total-cost">
	        <div class="column-half">
	            <span class="heading-medium">Total project costs</span>
	        </div>
	        <div class="column-half alignright">
	            <input type="text" readonly="readonly" class="heading-medium width-full alignright" value="Â£ 286,283" />
	        </div>
	    </div>

	    <h3 class="heading-medium">Other funding</h3>

	    <div th:include="prototypes/fragments/finance-review-questions :: finance-question-other-funding" th:remove="tag" />

		<!-- <div class="extra-margin" th:unless="${param.status != null and param.status[0] == 'approved' or param.status != null and param.status[0] == 'changeGrant'}">
			<a th:href="@{'?status=changeGrant#change-grant'}">Change % grant</a>
		</div>

		<th:block th:if="${param.status != null and param.status[0] == 'changeGrant'}">
		
			<form>

				<fieldset class="panel-indent" id="change-grant">
					<legend class="visuallyhidden">Change % grant</legend>
					<div class="cf">
						<div class="form-group">
							<label for="change-grant-percent" class="form-label-bold">
								Change % grant
								<span class="form-hint">When changing the % grant, the revised funding level must be below the level originally applied for</span>
							</label>
							<input class="form-control width-small" id="change-grant-percent" name="change-grant-percent" type="number" th:value="${(param.action != null and param.action[0] == 'grantUpdated' ? '40' : '55')}" /> <strong><a th:href="@{'?status=changeGrant&#38;action=grantUpdated'}">Update</a></strong>
						</div>
					</div>

					<th:block th:if="${param.action != null and param.action[0] == 'grantUpdated'}">

						<hr />

						<dl class="standard-definition-list">
							<dt>Proposed funding</dt>
							<dd>&pound;160,000</dd>
						</dl>

					</th:block>

					<hr />

					<div class="grid-row">
						<div class="column-half">
							<a th:href="${#httpServletRequest.requestURI}">Cancel</a>
						</div>

						<div class="column-half alignright">
							<a href="#" data-js-modal="change-grant" class="button">Change % grant</a>
						</div>

						<div class="change-grant" role="dialog" aria-hidden="true" style="margin-top: -174px;">
					        <button class="js-close close" aria-label="Close Popup">X</button>
					        <div>

								<h2 class="heading-medium no-margin">Change % grant</h2>

								<p>This will approve the applicant's project costs.</p>

								<dl class="standard-definition-list">
									<dt>Grant requested</dt>
									<dd>55%</dd>

									<dt>Funding sought</dt>
									<dd>&pound;180,399</dd>

									<dt>Current funding</dt>
									<dd>&pound;160,000</dd>

								</dl>

								<hr />

					        	<div class="alignright-button">
									
									<a href="#" aria-label="Close Popup" class="button-link js-close">Cancel</a>

									<input type="hidden" id="status" name="status" value="grantChanged" />

					        		<button class="button" th:formaction="@{${#httpServletRequest.requestURI}}">Change % grant</button>
					        	</div>

					        </div>
					    </div>


					</div>


				</fieldset>

			</form>

		</th:block> -->


	    <div class="extra-margin">
	    	<a href="/prototypes/3807-finance-queries" class="button button-secondary">Queries</a>
	    	<a href="/prototypes/3990-finance-notes" class="button button-secondary">Notes</a>
	    </div>
		
		
		<th:block th:unless="${param.status != null and param.status[0] == 'approved'}">

		    <h3 class="heading-medium">Approve eligible costs</h3>
		    <p>After making any necessary changes, eligible costs should be approved.</p>
		    <p>If changes are made, make sure the applicant has reviewed and understand all changes before you approve.</p>

		    <div class="form-group">
		    	<label class="block-label" for="costs-reviewed">
			      <input id="costs-reviewed" value="costs-reviewed" type="checkbox" />
			     	These funding costs have been reviewed and are acceptable
			    </label>
		    </div>

		    <div class="form-group hidden" id="add-rag-rating">
                <label for="rag-rating" class="form-label">Please enter the RAG rating for this eligibility review</label>
                <select id="rag-rating" name="rag-rating" class="form-control" >
                	<option value="">--</option>
                	<option value="Green">Green</option>
                	<option value="Amber">Amber</option>
                	<option value="Red">Red</option>
                </select>
            </div>

	    	<button data-js-modal="approve-eligibility-modal" id="approve-eligibility" class="button" type="submit" disabled="disabled">Approve eligible costs</button>

		    <div class="approve-eligibility-modal" role="dialog" aria-hidden="true" style="margin-top: -174px;">
		        <button class="js-close close" aria-label="Close Popup">X</button>
		        <div>

					<h2 class="heading-medium no-margin">Approve eligible costs</h2>

					<p>This partner will now be marked as eligible for this project.</p>

					<form>

						<hr />

			        	<div class="alignright-button">
							
							<a href="#" aria-label="Close Popup" class="button-link js-close">Cancel</a>
							
							<input type="hidden" id="action" name="action" th:value="${(param.status != null and param.status[0] == 'grantChanged' ? 'grantChanged' : '')}" />
							<input type="hidden" id="status" name="status" value="approved" />

			        		<button class="button" th:formaction="@{${#httpServletRequest.requestURI}}">Approve eligible costs</button>
			        	</div>

			        </form>

		        </div>
		    </div>

		</th:block>
	
	</form>

	<hr />

	<div class="extra-margin">
		<a href="/prototypes/1199-project-finances" class="button button-secondary" th:text="${(param.status != null and param.status[0] == 'approved'? 'Return to finance checks' : 'Save and return to finance checks')}">RETURN BUTTON TEXT</a>
	</div>

	<!-- END OFHARDCODED PROTOTYPE HTML -->

    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>

<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />
<script src="/js/ifs_prototype/jquery.waypoints.min.js" type="text/javascript"></script>
<script src="/js/ifs_prototype/prototype.js" type="text/javascript"></script>
<script type="text/javascript">
	// <![CDATA[
	jQuery('input#admin-support-radio-1').on('click',function(e){ 
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").show();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-2').on('click',function(e){ 
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").show();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-3').on('click',function(e){ 
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").show();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-4').on('click',function(e){ 
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").show();
		}
	});

	jQuery('select#rag-rating').on('change',function(e){
		var rating = jQuery(this).val();

		if (rating != ''){
			jQuery("#approve-eligibility").removeAttr('disabled');
		}else{
			jQuery("#approve-eligibility").attr('disabled','disabled');
		}
	});


	jQuery('input#costs-reviewed').on('click',function(e){ 
		if ( jQuery(this).is(':checked') ) {
			jQuery("#add-rag-rating").removeClass('hidden');
		}else{
			jQuery("#add-rag-rating").addClass('hidden');
		}
	});

	// ]]>
</script>
</body>
</html>