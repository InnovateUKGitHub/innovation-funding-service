<!DOCTYPE html>
<html lang="en" class="govuk-template" xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application team',hasFormErrors=${#fields.hasErrors('${form.*}')}" />
    </head>

    <body class="govuk-template__body">
        <th:block th:insert="fragments/layout :: body-start" />
        <th:block th:insert="fragments/layout :: global-header" />

        <div class="govuk-width-container">
            <th:block th:insert="fragments/layout :: phase-banner" />
            <th:block th:insert="fragments/layout :: header-sub"
                      th:with="linkTitle='Application overview',linkUrl=@{/application/{applicationId}(applicationId=${model.applicationId})}" />
                <main class="govuk-main-wrapper" id="main-content" role="main">


                <div th:if="${#fields.hasErrors('${form.*}')}"
                     class="govuk-error-summary"
                     role="alert"
                     aria-labelledby="error-summary-title"
                     tabindex="-1"
                     data-module="error-summary">
                    <h2 class="govuk-error-summary__title"  id="error-summary-title">There is a problem on this page.</h2>
                    <th:block th:insert="fragments/elements :: error-summary-list(form)" />
                </div>

                <th:block th:with="applicationName=${#strings.isEmpty(model.applicationName)} ? #{ifs.application.no_title} : ${model.applicationName}">
                    <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Application team',subTitle=${applicationName},size='govuk-heading-xl'" />
                </th:block>

                <th:block th:fragment="page-body">

                    <!--/* Beginning - the content at the top of the page */-->
                    <div th:unless="${model.closed or model.summary}" class="textarea-header">

                        <th:block th:if="${model.complete}">
                            <div class="success-alert assignee govuk-!-margin-bottom-6">
                                <p class="govuk-body">Application team is marked as complete</p>
                            </div>
                        </th:block>
                        <th:block th:if="${!model.complete}">
                            <p class="govuk-body">View and manage your contributors or collaborators in the application.</p>

                            <p class="govuk-body">The lead applicant cannot submit the application until everyone has accepted their invites. Only the lead can remove team members.</p>

                            <p class="govuk-body">Read the guidance on <a href="https://www.gov.uk/guidance/innovate-uk-funding-general-guidance-for-applicants#applying-for-a-competition-on-the-innovation-funding-service" class="govuk-link" target="_blank">how collaboration in the Innovation Funding Service works</a> (this link will open in a new window).</p>

                            <div th:if="${model.applicationCanBegin}" class="message-alert">
                                <h2 class="govuk-heading-s">As the lead applicant you can:</h2>
                                <ul class="govuk-list govuk-list--bullet">
                                    <li>add collaborating and contributing organisations and individuals</li>
                                    <li>manage organisations and individuals</li>
                                    <li>assign questions to individuals</li>
                                </ul>
                            </div>
                        </th:block>
                    </div>

                    <!--/* Middle - show details for each organisation */-->
                    <div class="govuk-form-group"
                         th:each="organisation : ${model.organisations}"
                         th:id="|organisation.${organisation.inviteOrganisationId}|"
                         th:with="organisationErrorKey=${'${form.organisation.' + organisation.inviteOrganisationId + '*}'}"
                         th:classappend="${#fields.hasErrors(organisationErrorKey)} ? 'govuk-form-group--error'">
                        <h2 class="govuk-heading-m">
                            <th:block th:text="${organisation.name}">Organisation name</th:block>
                            <th:block th:if="${organisation.lead}"> (Lead)</th:block>
                            <th:block th:unless="${organisation.lead}"> (Collaborator)</th:block>
                        </h2>

                        <h3 class="govuk-heading-s">Organisation type</h3>
                        <p class="govuk-body" th:text="${organisation.type}">Research and technology organisations (RTOs)</p>

                        <th:block th:if="${#fields.hasErrors(organisationErrorKey)}">
                                <span class="govuk-error-message"
                                      th:each="err : ${#fields.errors(organisationErrorKey)}"
                                      th:text="${err}"></span>
                        </th:block>

                        <table class="govuk-table table-overflow">
                            <thead class="govuk-table__head">
                            <tr class="govuk-table__row">
                                <th class="govuk-table__header width-30-percent" scope="col">Applicant</th>
                                <th class="govuk-table__header width-50-percent" scope="col">Email</th>
                                <th class="govuk-table__header" scope="col"><span class="govuk-visually-hidden">Additional details</span></th>
                            </tr>
                            </thead>
                            <tbody class="govuk-table__body">
                            <tr th:each="applicant : ${organisation.applicants}"
                                class="govuk-table__row">
                                <td class="govuk-table__cell" th:text="${applicant.name}">Steve Smith</td>
                                <td class="govuk-table__cell" th:text="${applicant.email}">steve.smith@empire.com</td>
                                <td class="govuk-table__cell" th:text="${applicant.lead} ? 'Lead' : (${applicant.pending} ? 'Invite pending' : '')">Lead</td>
                            </tr>
                            </tbody>
                        </table>

                        <p class="govuk-body" th:if="${organisation.editable and !model.complete}">
                            <!--/* Prefer linking by the InviteOrganisation id over the Organisation id except where there is no InviteOrganisation. */-->
                            <a th:unless="${organisation.organisationExists}" th:href="@{/application/{applicationId}/team/update/invited/{organisationId}(applicationId=${model.applicationId}, organisationId=${organisation.inviteOrganisationId})}"
                               th:text="|Update and add contributors from ${organisation.name}|"
                               class="govuk-link">Update and add contributors from Empire Ltd</a>
                            <a th:if="${organisation.organisationExists}" th:href="@{/application/{applicationId}/team/update/existing/{organisationId}(applicationId=${model.applicationId},organisationId=${organisation.organisationId})}"
                               th:text="|Update and add contributors from ${organisation.name}|"
                               class="govuk-link">Update and add contributors from Empire Ltd</a>
                        </p>
                    </div>

                    <!--/* End - show the link to add another organisation (lead only) */-->
                    <th:block th:if="${model.userLeadApplicant and !model.complete}">
                        <p class="govuk-body govuk-!-margin-top-6">Add any organisations participating with you on this project. They are responsible for creating their own account and submitting their finances.</p>
                        <p class="govuk-body"><a th:href="@{/application/{applicationId}/team/addOrganisation(applicationId=${model.applicationId})}" class="govuk-link">Add a collaborator organisation</a></p>
                    </th:block>
                </th:block>

                <p class="govuk-body govuk-!-margin-top-6">
                    <a th:href="@{/application/{applicationId}(applicationId=${model.applicationId})}" class="button-secondary">
                        <th:block th:if="${model.applicationCanBegin}">
                            Begin application
                        </th:block>
                        <th:block th:unless="${model.applicationCanBegin}">
                            Return to application overview
                        </th:block>
                    </a>
                </p>

                <th:block th:insert="fragments/layout :: main-content-end" />
            </main>
        </div>

        <th:block th:insert="fragments/layout :: footer" />
        <th:block th:insert="fragments/layout :: body-end" />
        <th:block th:insert="fragments/service-layout :: body-end" />
    </body>
</html>
