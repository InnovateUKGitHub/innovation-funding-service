<!DOCTYPE html>
<html lang="en" class="govuk-template" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Manage assessment periods'"/>
</head>

<body class="govuk-template__body competition-management">
<th:block th:insert="fragments/layout :: body-start"/>
<th:block th:insert="fragments/layout :: global-header"/>

<div class="govuk-width-container">
    <th:block th:insert="fragments/layout :: phase-banner"/>
    <th:block th:insert="fragments/layout :: header-sub"
              th:with="linkTitle='Competition', linkUrl=@{/competition/{competitionId}(competitionId=${model.competitionId})}"/>

    <div th:if="${#fields.hasErrors('${form.*}')}" class="govuk-error-summary" role="alert"
         aria-labelledby="error-summary-title" tabindex="-1" data-module="govuk-error-summary">
        <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
        <th:block th:insert="fragments/elements :: error-summary-list(form)"/>
    </div>

    <main class="govuk-main-wrapper" id="main-content" role="main">
        <th:block th:insert="fragments/layout :: page-title"
                  th:with="pageTitle='Manage assessment period', size='govuk-heading-xl'"/>
        <form th:action="@{${#ifsUtil.formPostUri(#httpServletRequest)}}"
              th:object="${form}"
              method="post">
            <th:block th:each="assessmentPeriod, pStat: ${form.formList}">
                <input type="hidden"
                       required="required"
                       id="assessmentPeriodId"
                       th:field="${form.formList[__${pStat.index}__].assessmentPeriodId}"
                />
                <table class="govuk-table milestones-table">
                    <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header" scope="col" id="milestone">Assessment Period</th>
                        <th class="govuk-table__header" scope="col" id="time">Time</th>
                        <th class="govuk-table__header" scope="col" id="weekday">Weekday</th>
                        <th class="govuk-table__header" scope="col" id="day">Day</th>
                        <th class="govuk-table__header" scope="col" id="month">Month</th>
                        <th class="govuk-table__header" scope="col" id="year">Year</th>
                    </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                    <tr th:each="(milestoneEntry : ${assessmentPeriod.milestoneEntries})"
                        th:if="${milestoneEntry.value.milestoneType.presetDate}"
                        class="govuk-table__row date-group form-group-row"
                        data-future-date=""
                        th:attr="data-date-invalid-errormessage=${milestoneEntry.value.milestoneType.milestoneDescription + ': Please enter a valid date.'},
                               data-date-future-errormessage=${milestoneEntry.value.milestoneType.milestoneDescription  + ': Please enter a future date' + (milestoneEntry.value.firstMilestone ? '' : ' that is after the previous milestone') + '.'}">
                        <th class="govuk-table__header" scope="row">
                            <legend th:id="${'milestone-' + milestoneEntry.key}"
                                    th:text="${milestoneEntry.value.milestoneType.milestoneDescription}"/>
                        </th>
                        <td class="govuk-table__cell time">

                            <input type="hidden"
                                   required="required"
                                   th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].milestoneType'"
                                   th:field="${form.formList[__${pStat.index}__].milestoneEntries[__${milestoneEntry.key}__].milestoneType}"
                                   th:value="${milestoneEntry.key}"/>
                            <input type="hidden"
                                   th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].editable'"
                                   th:value="${milestoneEntry.value.editable}"/>
<!--                            <select th:if="${milestoneEntry.value.timeOption}"-->
<!--                                    th:id="'milestoneEntries[' + ${milestoneEntry.key} + '].time'"-->
<!--                                    aria-labelledby="time"-->
<!--                                    class="govuk-select"-->
<!--                                    required="required"-->
<!--                                    th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].time'">-->
<!--                                <option th:each="time : ${T(org.innovateuk.ifs.management.competition.setup.core.form.MilestoneTime).values()}"-->
<!--                                        th:text="${time.display}" th:value="${time}" th:attr="data-time=${time.hour}"-->
<!--                                        th:selected="${time == milestoneEntry.value.time}"></option>-->
<!--                            </select>-->
                            <th:block th:if="${milestoneEntry.value.middayTime}">
                                Midday
                                <input type="hidden"
                                       data-time="12"
                                       th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].time'"
                                       th:id="'milestoneEntries[' + ${milestoneEntry.key} + '].time'"
                                       th:value="${T(org.innovateuk.ifs.management.competition.setup.core.form.MilestoneTime).TWELVE_PM}">
                            </th:block>
                        </td>
                        <td class="govuk-table__cell js-addWeekDay"
                            th:id="'milestoneWeekdayEntry-' + ${milestoneEntry.key}"
                            th:text="${milestoneEntry.value.dayOfWeek}"></td>
                        <td class="govuk-table__cell day">
                            <input type="text"
                                   placeholder="DD"
                                   min="1"
                                   max="31"
                                   data-maxlength-errormessage=""
                                   required="required"
                                   pattern="^[0-9]{1,2}$"
                                   data-prevent-input-regex="[^0-9]"
                                   maxlength="2"
                                   minlength="1"
                                   class="govuk-input govuk-input--width-4"
                                   th:attr="aria-labelledby=|day milestone-${milestoneEntry.key}|,
                                 data-date=|${milestoneEntry.value.day}-${milestoneEntry.value.month}-${milestoneEntry.value.year}|"
                                   th:value="${milestoneEntry.value.day}"
                                   th:field="${form.formList[__${pStat.index}__].milestoneEntries[__${milestoneEntry.key}__].day}"
                                   th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].day'"
                                   th:readonly="${milestoneEntry.value.readonly}"
                            />
                        </td>
                        <td class="govuk-table__cell month">
                            <input type="text"
                                   placeholder="MM"
                                   min="1"
                                   max="12"
                                   required="required"
                                   pattern="^[0-9]{1,2}$"
                                   data-prevent-input-regex="[^0-9]"
                                   maxlength="2"
                                   minlength="1"
                                   class="govuk-input govuk-input--width-4"
                                   th:attr="aria-labelledby=|day milestone-${milestoneEntry.key}|,
                                data-date=|${milestoneEntry.value.day}-${milestoneEntry.value.month}-${milestoneEntry.value.year}|"
                                   th:value="${milestoneEntry.value.month}"
                                   th:field="${form.formList[__${pStat.index}__].milestoneEntries[__${milestoneEntry.key}__].month}"
                                   th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].month'"
                                   th:readonly="${milestoneEntry.value.readonly}"
                            />
                        </td>
                        <td class="govuk-table__cell year">
                            <input type="text"
                                   placeholder="YYYY"
                                   pattern="[0-9]{4,}"
                                   data-prevent-input-regex="[^0-9]"
                                   maxlength="4"
                                   minlength="4"
                                   th:attr="aria-labelledby=|year milestone-${milestoneEntry.key}|,
                                 data-date=|${milestoneEntry.value.day}-${milestoneEntry.value.month}-${milestoneEntry.value.year}|,
                                 min=${#dates.format(#dates.createNow(), 'yyyy')}"
                                   required="required"
                                   class="govuk-input govuk-input--width-4"
                                   th:value="${milestoneEntry.value.year}"
                                   th:field="${form.formList[__${pStat.index}__].milestoneEntries[__${milestoneEntry.key}__].year}"
                                   th:name="'milestoneEntries[' + ${milestoneEntry.key} + '].year'"
                                   th:readonly="${milestoneEntry.value.readonly}"
                            />
                        </td>
                    </tr>
                    </tbody>
                </table>

            </th:block>


            <button type="submit"
                    class="govuk-button govuk-!-margin-top-6">Save and return to manage assessments
            </button>
            <button type="submit"
                    class="govuk-button govuk-!-margin-top-6" name="add-assessment-period">Add
            </button>
        </form>


        <th:block th:insert="fragments/layout :: main-content-end"/>
    </main>
</div>
<th:block th:insert="fragments/layout :: footer"/>
<th:block th:insert="fragments/layout :: body-end"/>
<th:block th:insert="fragments/service-layout :: body-end"/>

</body>
</html>
