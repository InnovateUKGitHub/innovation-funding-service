<!-- =================Application question=========================== -->
<div th:fragment="application-question(question, editable)" xmlns:th="http://www.w3.org/1999/html">
    <th:block th:unless="${editable}">
        <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m govuk-!-margin-top-6">
                <h2 class="govuk-fieldset__heading">Application question</h2>
            </legend>

            <dl class="govuk-list application-question-list govuk-grid-row">
                <dt class="govuk-grid-column-one-third">Question heading</dt>
                <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.shortTitle)}">None</dd>
                <dd class="govuk-grid-column-two-thirds" th:unless="${#strings.isEmpty(question.shortTitle)}"
                    th:text="${question.shortTitle}"></dd>
                <dt class="govuk-grid-column-one-third">Question title</dt>
                <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.title)}">None</dd>
                <dd class="govuk-grid-column-two-thirds" th:unless="${#strings.isEmpty(question.title)}"
                    th:text="${question.title}"></dd>
                <dt class="govuk-grid-column-one-third">Question subtitle</dt>
                <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.subTitle)}">None</dd>
                <dd class="govuk-grid-column-two-thirds" th:unless="${#strings.isEmpty(question.subTitle)}"
                    ifs:utext="${question.subTitle}"></dd>
                <dt class="govuk-grid-column-one-third">Guidance title</dt>
                <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.guidanceTitle)}">None</dd>
                <dd class="govuk-grid-column-two-thirds" th:unless="${#strings.isEmpty(question.guidanceTitle)}"
                    th:text="${question.guidanceTitle}"></dd>
                <dt class="govuk-grid-column-one-third">Guidance</dt>
                <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.guidance)}">None</dd>
                <dd class="govuk-grid-column-two-thirds wysiwyg-styles" th:unless="${#strings.isEmpty(question.guidance)}"
                    ifs:utext="${question.guidance}"></dd>

                <th:block th:if="${question.textArea != null && question.multipleChoice != null}">
                    <dt class="govuk-grid-column-one-third">Answer type</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${competitionSetupForm.typeOfQuestion.name() == 'FREE_TEXT' ? 'Free text' : 'Multiple choice'}"></dd>
                </th:block>
                <th:block th:if="${question.textArea != null && question.textArea}">
                    <dt class="govuk-grid-column-one-third">Max word count</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${question.maxWords}"></dd>
                </th:block>
                <th:block th:if="${question.multipleChoice != null && question.multipleChoice}">
                    <dt class="govuk-grid-column-one-third">Answers</dt>
                    <dd class="govuk-grid-column-two-thirds">
                        <th:block th:each="choice : ${question.choices}">
                            <span th:text="${choice.text}"></span><br/>
                        </th:block>
                    </dd>
                </th:block>
                <th:block th:if="${question.appendix != null}">
                    <dt class="govuk-grid-column-one-third">Appendix</dt>
                    <dd class="govuk-grid-column-two-thirds" th:if="${question.appendix}">Yes</dd>
                    <dd class="govuk-grid-column-two-thirds" th:unless="${question.appendix}">No</dd>
                    <th:block th:if="${question.appendix}">
                        <dt class="govuk-grid-column-one-third">Accepted appendix file types</dt>
                        <dd class="govuk-grid-column-two-thirds">
                            <ul>
                                <li th:each="fileType : ${question.allowedAppendixResponseFileTypes}"
                                    th:text="${fileType.displayName}"></li>
                            </ul>
                        </dd>
                        <dt class="govuk-grid-column-one-third">Appendix guidance</dt>
                        <dd class="govuk-grid-column-two-thirds wysiwyg-styles" ifs:utext="${question.appendixGuidance}"></dd>
                    </th:block>
                </th:block>
                <th:block th:if="${question.templateDocument != null}">
                    <dt class="govuk-grid-column-one-third">Template document</dt>
                    <dd class="govuk-grid-column-two-thirds" th:if="${question.templateDocument}">Yes</dd>
                    <dd class="govuk-grid-column-two-thirds" th:unless="${question.templateDocument}">No</dd>
                    <th:block th:if="${question.templateDocument}">
                        <dt class="govuk-grid-column-one-third">Template title</dt>
                        <dd class="govuk-grid-column-two-thirds" th:text="${question.templateTitle}"></dd>
                        <dt class="govuk-grid-column-one-third">Template file</dt>
                        <dd class="govuk-grid-column-two-thirds">
                            <a th:href="@{/competition/setup/{competitionId}/section/application/question/{questionId}/download-template-file(competitionId=${model.general.competition.id},questionId=${question.questionId})}"
                               th:text="${model.templateFilename}"
                               class="govuk-link">File</a>
                        </dd>
                        <dt class="govuk-grid-column-one-third">Accepted upload file types</dt>
                        <dd class="govuk-grid-column-two-thirds">
                            <ul>
                                <li th:each="fileType : ${question.allowedTemplateResponseFileTypes}"
                                    th:text="${fileType.displayName}"></li>
                            </ul>
                        </dd>
                    </th:block>
                </th:block>
            </dl>
        </fieldset>
        <fieldset
            th:if="${question.scored != null or question.writtenFeedback != null or question.researchCategoryQuestion != null or question.scope != null}"
            class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m govuk-!-margin-top-6">
                <h2 class="govuk-fieldset__heading">Assessment of this question</h2>
            </legend>

            <dl class="govuk-list application-question-list govuk-grid-row">
                <th:block th:if="${question.scored != null}">
                    <dt class="govuk-grid-column-one-third">Scored</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${question.scored ? 'Yes' : 'No'}"></dd>
                    <th:block th:if="${question.scored}">
                        <dt class="govuk-grid-column-one-third">Out of</dt>
                        <dd class="govuk-grid-column-two-thirds" th:text="${question.scoreTotal}"></dd>
                    </th:block>
                </th:block>

                <th:block th:if="${question.writtenFeedback != null}">
                    <dt class="govuk-grid-column-one-third">Written feedback</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${question.writtenFeedback ? 'Yes' : 'No'}"></dd>
                    <th:block th:if="${question.writtenFeedback}">
                        <dt class="govuk-grid-column-one-third">Guidance title</dt>
                        <dd class="govuk-grid-column-two-thirds" th:if="${#strings.isEmpty(question.assessmentGuidanceTitle)}">
                            None
                        </dd>
                        <dd class="govuk-grid-column-two-thirds" th:unless="${#strings.isEmpty(question.assessmentGuidanceTitle)}"
                            th:text="${question.assessmentGuidanceTitle}"></dd>
                        <dt class="govuk-grid-column-one-third">Guidance</dt>
                        <dd class="govuk-grid-column-two-thirds">
                            <p class="govuk-body" th:text="${question.assessmentGuidance}">Your score should be based on the following:</p>
                            <dl class="govuk-grid-row govuk-!-margin-top-6">
                                <th:block th:each="score : ${question.guidanceRows}">
                                    <dt class="govuk-grid-column-one-quarter"
                                        th:text="${score.subject != null ? score.subject.replace(',', '-') : score.subject}"></dt>
                                    <dd class="govuk-grid-column-three-quarters" th:text="${score.justification}"></dd>
                                </th:block>
                            </dl>
                        </dd>
                        <dt class="govuk-grid-column-one-third">Max word count</dt>
                        <dd class="govuk-grid-column-two-thirds" th:text="${question.assessmentMaxWords}"></dd>
                    </th:block>
                </th:block>

                <th:block th:if="${question.researchCategoryQuestion != null}">
                    <dt class="govuk-grid-column-one-third">Research category question</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${question.researchCategoryQuestion ? 'Yes' : 'No'}"></dd>
                </th:block>
                <th:block th:if="${question.scope != null}">
                    <dt class="govuk-grid-column-one-third">Scope 'Y/N' question</dt>
                    <dd class="govuk-grid-column-two-thirds" th:text="${question.scope ? 'Yes' : 'No'}"></dd>
                </th:block>
            </dl>
        </fieldset>
    </th:block>
    <th:block th:if="${editable}">

        <h2 class="govuk-heading-m govuk-!-margin-top-6">Application question</h2>

        <input type="hidden"
               th:name="question.questionId"
               th:value="${question.questionId}"/>
        <input type="hidden"
               th:name="question.type"
               th:value="${question.type}"/>

        <div class="question">
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('question.shortTitle')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="question.shortTitle">
                    Question heading
                </label>
                <th:block th:if="${#fields.hasErrors('question.shortTitle')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.shortTitle')}"
                              th:text="${err}"></span>
                </th:block>
                <input class="govuk-input govuk-!-width-two-thirds"
                       th:classappend="${#fields.hasErrors('question.shortTitle')} ? 'govuk-input--error'"
                       type="text"
                       required="required"
                       id="question.shortTitle"
                       th:name="question.shortTitle"
                       th:value="${question.shortTitle}"
                       maxlength="255"/>
            </div>
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('question.title')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="question.title">
                    Question title
                </label>
                <th:block th:if="${#fields.hasErrors('question.title')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.title')}"
                              th:text="${err}"></span>
                </th:block>
                <input th:classappend="${#fields.hasErrors('question.title')} ? 'govuk-input--error'"
                       class="govuk-input govuk-!-width-two-thirds"
                       type="text"
                       required="required"
                       id="question.title"
                       th:name="question.title"
                       th:value="${question.title}"
                       maxlength="255"/>
            </div>
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('question.subTitle')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="question.subTitle">
                    Question subtitle
                </label>
                <th:block th:if="${#fields.hasErrors('question.subTitle')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.subTitle')}"
                              th:text="${err}"></span>
                </th:block>
                <div class="textarea-wrapped short">
                        <textarea data-max_words="500"
                                  data-editor="html"
                                  id="question.subTitle"
                                  class="govuk-textarea"
                                  th:classappend="${#fields.hasErrors('question.subTitle')} ? 'govuk-textarea--error'"
                                  th:name="question.subTitle"
                                  required="required"
                                  ifs:utext="${question.subTitle}">
                        </textarea>
                </div>
            </div>
            <div class="govuk-form-group"
                 th:classappend="${#fields.hasErrors('question.guidanceTitle')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="question.guidanceTitle">
                    Question guidance title
                </label>
                <th:block th:if="${#fields.hasErrors('question.guidanceTitle')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.guidanceTitle')}"
                              th:text="${err}"></span>
                </th:block>
                <input th:classappend="${#fields.hasErrors('question.guidanceTitle')} ? 'govuk-input--error'"
                       class="govuk-input govuk-!-width-two-thirds"
                       type="text"
                       id="question.guidanceTitle"
                       required="required"
                       th:name="question.guidanceTitle"
                       th:value="${question.guidanceTitle}"
                       maxlength="255"/>
            </div>
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('question.guidance')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="question.guidance">
                    Question guidance
                </label>
                <th:block th:if="${#fields.hasErrors('question.guidance')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.guidance')}"
                              th:text="${err}"></span>
                </th:block>
                <div class="textarea-wrapped">
                        <textarea data-max_words="500"
                                  data-editor="html"
                                  id="question.guidance"
                                  class="govuk-textarea"
                                  th:classappend="${#fields.hasErrors('question.guidance')} ? 'govuk-textarea--error'"
                                  th:name="question.guidance"
                                  required="required"
                                  ifs:utext="${question.guidance}">
                        </textarea>
                </div>
            </div>

            <input type="hidden" th:field="*{question.textArea}">
            <input type="hidden" th:field="*{question.multipleChoice}">

            <th:block th:if="${question.textArea != null && question.multipleChoice != null}">
                <div class="govuk-radios govuk-radios--inline">
                    <div class="govuk-radios__item" data-target="text-area-form-group"
                         data-target-clear-validation="true" data-target-clear-form="true">
                        <input class="govuk-radios__input"
                               id="text-area"
                               type="radio"
                               th:field="*{typeOfQuestion}"
                               value="FREE_TEXT"
                               required="required" />
                        <label class="govuk-label govuk-radios__label" for="text-area">
                            Free text box
                        </label>
                    </div>

                    <div class="govuk-radios__item" data-target="multiple-choice-form-group"
                         data-target-clear-validation="true" data-target-clear-form="true">
                        <input class="govuk-radios__input"
                               id="multiple-choice"
                               th:field="*{typeOfQuestion}"
                               type="radio"
                               value="MULTIPLE_CHOICE"
                               required="required">
                        <label class="govuk-label govuk-radios__label" for="multiple-choice">
                            Multiple choice
                        </label>
                    </div>
                </div>
            </th:block>

            <th:block th:if="${question.textArea != null}">
                <div id="text-area-form-group" class="govuk-form-group" th:classappend="${#fields.hasErrors('question.maxWords')} ? 'govuk-form-group--error'">
                    <label class="govuk-label govuk-label--s" for="question.maxWords">
                        Max word count
                    </label>
                    <th:block th:if="${#fields.hasErrors('question.maxWords')}">
                            <span class="govuk-error-message" th:each="err : ${#fields.errors('question.maxWords')}"
                                  th:text="${err}"></span>
                    </th:block>
                    <input class="govuk-input govuk-input--width-10"
                           th:classappend="${#fields.hasErrors('question.maxWords')} ? 'govuk-input--error'"
                           type="number"
                           id="question.maxWords"
                           min="1"
                           required="required"
                           th:name="question.maxWords"
                           th:value="${question.maxWords}"
                           th:attr="data-min-errormessage=#{validation.applicationquestionform.maxwords.min}"/>
                </div>
            </th:block>

            <th:block th:if="${question.multipleChoice != null}">
                <div id="multiple-choice-form-group">
                    <table id="multiple-choice-table" class="govuk-table">
                        <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th class="govuk-table__header" scope="col">Answers</th>
                            <th class="govuk-table__header" scope="col"><span class="govuk-visually-hidden">Action</span></th>
                        </tr>
                        </thead>
                        <tbody class="govuk-table__body">
                        <th:block th:each="(choice, iteration : ${question.choices})">
                            <tr th:id="${'multiple-choice-row-'+iteration.index}"
                                class="govuk-table__row form-group-row-validated"
                                th:classappend="${#fields.hasErrors('question.choices[__${iteration.index}__].text')} ? 'govuk-form-group--error'">
                                <td class="govuk-table__cell govuk-form-group"
                                    th:classappend="${#fields.hasErrors('question.choices[__${iteration.index}__].text')} ? 'govuk-form-group--error'">
                                    <label class="govuk-label govuk-visually-hidden"
                                           th:for="question.choices[__${iteration.index}__].text">
                                        Answer
                                    </label>
                                    <th:block
                                        th:if="${#fields.hasErrors('question.choices[__${iteration.index}__].text')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('question.choices[__${iteration.index}__].text')}"
                                                          th:text="${err}"></span>
                                    </th:block>
                                    <input required="required"
                                           type="text"
                                           class="govuk-input"
                                           th:errorclass="govuk-input--error"
                                           th:id="question.choices[__${iteration.index}__].text"
                                           th:field="${competitionSetupForm.question.choices[__${iteration.index}__].text}"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                    data-anychange-errormessage=#{validation.competition.setup.multiple.choice.duplicate}"/>
                                    <input type="hidden" th:field="*{question.choices[__${iteration.index}__].id}">
                                </td>
                                <td class="govuk-table__cell">
                                    <button th:if="${iteration.index > 1}"
                                            class="button-clear alignright" data-remove-row="multipleChoice"
                                            type="button" name="remove-multiple-choice-row"
                                            th:value="${iteration.index}"
                                            th:id="'remove-multiple-choice-row-' + ${iteration.index}">Remove
                                    </button>
                                </td>
                            </tr>
                        </th:block>
                        </tbody>
                    </table>
                    <div class="alignright govuk-!-margin-top-6">
                        <button class="button-clear" data-add-row="multipleChoice" type="button">+Add another answer
                        </button>
                    </div>
                </div>
            </th:block>

            <!--/* APPENDIX */-->
            <th:block th:if="${question.appendix != null or #fields.hasErrors('question.appendix')}">
                <div class="govuk-form-group"
                     th:classappend="${#fields.hasErrors('question.appendix')} ? 'govuk-form-group--error'">
                    <fieldset class="govuk-fieldset">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.appendix">
                            <h2 class="govuk-fieldset__heading">Appendix</h2>
                        </legend>
                        <th:block th:if="${#fields.hasErrors('question.appendix')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.appendix')}"
                              th:text="${err}"></span>
                        </th:block>
                        <div class="govuk-radios govuk-radios--inline">
                            <div class="govuk-radios__item" data-target="allowedAppendixFileTypesDiv" data-target-clear-form="true">
                                <input id="appendix-yes"
                                       class="govuk-radios__input"
                                       th:name="question.appendix"
                                       th:checked="${question.appendix != null and question.appendix}"
                                       value="1"
                                       required="required"
                                       th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                       type="radio"/>
                                <label for="appendix-yes"
                                       class="govuk-label govuk-radios__label">Yes</label>
                            </div>
                            <div class="govuk-radios__item">
                                <input id="appendix-no"
                                       class="govuk-radios__input"
                                       th:name="question.appendix"
                                       th:checked="${question.appendix != null and !question.appendix}"
                                       value="0"
                                       required="required"
                                       th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                       type="radio"/>
                                <label for="appendix-no"
                                       class="govuk-label govuk-radios__label">No</label>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div id="allowedAppendixFileTypesDiv" class="panel">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.allowedAppendixResponseFileTypes')} ? 'govuk-form-group--error'">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.allowedAppendixResponseFileTypes">
                                <h2 class="govuk-fieldset__heading">Accepted appendix file types</h2>
                            </legend>
                            <th:block th:if="${#fields.hasErrors('question.allowedAppendixResponseFileTypes')}">
                                <span class="govuk-error-message"
                                      th:each="err : ${#fields.errors('question.allowedAppendixResponseFileTypes')}"
                                      th:text="${err}"></span>
                            </th:block>
                            <div class="govuk-checkboxes">
                                <div class="govuk-checkboxes__item"
                                     th:each="fileTypeCategory : ${question.getAppendixTypeCategories()}">
                                    <input type="checkbox"
                                           class="govuk-checkboxes__input"
                                           th:field="*{question.allowedAppendixResponseFileTypes}"
                                           th:value="${fileTypeCategory}"
                                           required="required"/>
                                    <label th:for="${#ids.prev('question.allowedAppendixResponseFileTypes')}"
                                           th:text="${fileTypeCategory.displayName}"
                                           class="govuk-label govuk-checkboxes__label">PDF</label>
                                </div>
                            </div>

                        </fieldset>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.appendixGuidance')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-label--s"
                               for="question.appendixGuidance">
                            Appendix guidance
                        </label>
                        <th:block th:if="${#fields.hasErrors('question.appendixGuidance')}">
                            <span class="govuk-error-message" th:each="err : ${#fields.errors('question.appendixGuidance')}"
                                  th:text="${err}"></span>
                        </th:block>
                        <div class="textarea-wrapped">
                        <textarea data-max_words="500"
                                  data-editor="html"
                                  class="govuk-textarea"
                                  id="question.appendixGuidance"
                                  th:classappend="${#fields.hasErrors('question.appendixGuidance')} ? 'govuk-textarea--error'"
                                  th:name="question.appendixGuidance"
                                  required="required"
                                  ifs:utext="${question.appendixGuidance}">
                        </textarea>
                        </div>
                    </div>
                </div>
            </th:block>

            <!--/* TEMPLATE DOCUMENT */-->
            <th:block th:if="${question.templateDocument != null or #fields.hasErrors('question.templateDocument')}">
                <div class="govuk-form-group"
                     th:classappend="${#fields.hasErrors('question.templateDocument')} ? 'govuk-form-group--error'">
                    <fieldset class="govuk-fieldset">
                        <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.templateDocument">
                            <h2 class="govuk-fieldset__heading">Template document</h2>
                        </legend>
                        <th:block th:if="${#fields.hasErrors('question.templateDocument')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('question.templateDocument')}"
                              th:text="${err}"></span>
                        </th:block>
                        <div class="govuk-radios govuk-radios--inline"
                             th:with="checked=${question.templateDocument != null and question.templateDocument}">
                            <div class="govuk-radios__item" data-target="allowedTemplateFileTypesDiv" data-target-clear-form="true">
                                <input id="template-document-yes"
                                       class="govuk-radios__input"
                                       th:name="question.templateDocument"
                                       th:checked="${checked}"
                                       value="1"
                                       required="required"
                                       th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                       type="radio"/>
                                <label for="template-document-yes"
                                       class="govuk-label govuk-radios__label">Yes</label>
                            </div>
                            <div class="govuk-radios__item">
                                <input id="template-document-no"
                                       class="govuk-radios__input"
                                       th:name="question.templateDocument"
                                       th:checked="${!checked}"
                                       value="0"
                                       required="required"
                                       th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                       type="radio"/>
                                <label for="template-document-no"
                                       class="govuk-label govuk-radios__label">No</label>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div id="allowedTemplateFileTypesDiv" class="panel">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.templateTitle')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-label--s"
                               for="question.templateTitle">
                            Template title
                            <span class="govuk-hint">
                            Give a title for example 'methodology'. This would appear to the applicant as 'Download methodology template.'
                            </span>
                        </label>
                        <th:block th:if="${#fields.hasErrors('question.templateTitle')}">
                            <span class="govuk-error-message" th:each="err : ${#fields.errors('question.templateTitle')}"
                                  th:text="${err}"></span>
                        </th:block>
                        <input class="govuk-input govuk-!-width-two-thirds"
                               th:classappend="${#fields.hasErrors('question.templateTitle')} ? 'govuk-input--error'"
                               type="text"
                               required="required"
                               id="question.templateTitle"
                               th:name="question.templateTitle"
                               th:value="${question.templateTitle}"
                               maxlength="255"
                               th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"/>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('templateDocumentFile')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-label--s">
                            Upload template
                            <span class="govuk-hint">
                            Accepted file types (.ods, odt)
                            </span>
                        </label>
                        <div class="upload-section" id="templateDocument">
                            <th:block th:insert="question-type/types :: fileupload-fragment(edit,
                                @{/competition/setup/{competitionId}/section/application/question/{questionId}/download-template-file(competitionId=${model.general.competition.id},questionId=${question.questionId})},
                                ${model.templateFilename},
                                templateDocumentFile,
                                templateDocumentFile,
                                true,
                                removeTemplateDocumentFile,
                                uploadTemplateDocumentFile)"/>
                        </div>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.allowedTemplateResponseFileTypes')} ? 'govuk-form-group--error'">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.allowedTemplateResponseFileTypes">
                                <h2 class="govuk-fieldset__heading">Accepted upload file types</h2>
                            </legend>
                            <th:block th:if="${#fields.hasErrors('question.allowedTemplateResponseFileTypes')}">
                                <span class="govuk-error-message"
                                      th:each="err : ${#fields.errors('question.allowedTemplateResponseFileTypes')}"
                                      th:text="${err}"></span>
                            </th:block>
                            <div class="govuk-checkboxes">
                                <div class="govuk-checkboxes__item"
                                     th:each="fileTypeCategory : ${question.getTemplateDocumentTypeCategories()}">
                                    <input type="checkbox"
                                           class="govuk-checkboxes__input"
                                           th:field="*{question.allowedTemplateResponseFileTypes}"
                                           th:value="${fileTypeCategory}"
                                           required="required"/>
                                    <label th:for="${#ids.prev('question.allowedTemplateResponseFileTypes')}"
                                           th:text="|${fileTypeCategory.displayName} (${fileTypeCategory.getDisplayMediaTypes()})|"
                                           class="govuk-label govuk-checkboxes__label">PDF</label>
                                </div>
                            </div>

                        </fieldset>
                    </div>
                </div>
            </th:block>

            <!--/* ASSESSMENT */-->
            <th:block
                th:if="${competitionSetupForm.question.type == T(org.innovateuk.ifs.question.resource.QuestionSetupType).ASSESSED_QUESTION or competitionSetupForm.question.type == T(org.innovateuk.ifs.question.resource.QuestionSetupType).SCOPE}">

                <input type="hidden" name="competitionSetupForm.question.type"
                       th:value="${T(org.innovateuk.ifs.question.resource.QuestionSetupType).ASSESSED_QUESTION}"/>

                <h2 class="govuk-heading-m govuk-!-margin-top-6">Assessment of this question</h2>

                <th:block th:if="${question.researchCategoryQuestion != null}">

                    <div class="govuk-form-group" th:classappend="${#fields.hasErrors('question.researchCategoryQuestion')} ? 'govuk-form-group--error'">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.researchCategoryQuestion">
                                <h2 class="govuk-fieldset__heading">Research category question</h2>
                            </legend>
                            <th:block th:if="${#fields.hasErrors('question.researchCategoryQuestion')}">
                                <span class="govuk-error-message" th:each="err : ${#fields.errors('question.researchCategoryQuestion')}"
                                th:text="${err}"></span>
                            </th:block>
                            <div class="govuk-radios govuk-radios--inline">
                                <div class="govuk-radios__item">
                                    <input id="research-category-yes"
                                           class="govuk-radios__input"
                                           th:name="question.researchCategoryQuestion"
                                           th:checked="${question.researchCategoryQuestion != null and question.researchCategoryQuestion}"
                                           value="1"
                                           required="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="research-category-yes"
                                           class="govuk-label govuk-radios__label">Yes</label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input id="research-category-no"
                                           class="govuk-radios__input"
                                           th:name="question.researchCategoryQuestion"
                                           th:checked="${question.researchCategoryQuestion != null and !question.researchCategoryQuestion}"
                                           value="0"
                                           required="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="research-category-no"
                                           class="govuk-label govuk-radios__label">No</label>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                </th:block>
                <th:block th:if="${question.scored != null or #fields.hasErrors('question.scored')}">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.scored')} ? 'govuk-form-group--error'">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.scored">
                                <h2 class="govuk-fieldset__heading">Scored</h2>
                            </legend>
                            <th:block th:if="${#fields.hasErrors('question.scored')}">
                            <span class="govuk-error-message" th:each="err : ${#fields.errors('question.scored')}"
                                  th:text="${err}"></span>
                            </th:block>
                            <div class="govuk-radios govuk-radios--inline">
                                <div class="govuk-radios__item" data-target="score-total">
                                    <input id="scored-yes"
                                           class="govuk-radios__input"
                                           th:name="question.scored"
                                           th:checked="${question.scored != null and question.scored}"
                                           value="1"
                                           require
                                           d="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="scored-yes"
                                           class="govuk-label govuk-radios__label">Yes</label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input id="scored-no"
                                           class="govuk-radios__input"
                                           th:name="question.scored"
                                           th:checked="${question.scored != null and !question.scored}"
                                           value="0"
                                           required="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="scored-no"
                                           class="govuk-label govuk-radios__label">No</label>
                                </div>
                            </div>

                        </fieldset>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.scoreTotal')} ? 'govuk-form-group--error'"
                         id="score-total">
                        <label class="govuk-label govuk-label--s" for="question.scoreTotal">
                            Out of
                        </label>
                        <th:block th:if="${#fields.hasErrors('question.scoreTotal')}">
                                <span class="govuk-error-message" th:each="err : ${#fields.errors('question.scoreTotal')}"
                                      th:text="${err}"></span>
                        </th:block>
                        <input class="govuk-input govuk-input--width-10"
                               th:classappend="${#fields.hasErrors('question.scoreTotal')} ? 'govuk-input--error'"
                               type="number"
                               id="question.scoreTotal"
                               min="1"
                               required="required"
                               th:name="question.scoreTotal"
                               th:value="${question.scoreTotal}"/>
                    </div>
                </th:block>

                <th:block th:if="${question.scope != null}">

                    <div class="govuk-form-group">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                                <h2 class="govuk-fieldset__heading">Scope 'Y/N' question</h2>
                            </legend>
                            <div class="govuk-radios govuk-radios--inline">
                                <div class="govuk-radios__item">
                                    <input id="scoped-yes"
                                           class="govuk-radios__input"
                                           th:name="question.scope"
                                           th:checked="${question.scope == true}"
                                           value="1"
                                           type="radio"/>
                                    <label for="scoped-yes"
                                           class="govuk-label govuk-radios__label">Yes</label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input id="scoped-no"
                                           class="govuk-radios__input"
                                           th:name="question.scope"
                                           th:checked="${question.scope == false}"
                                           value="0"
                                           type="radio"/>
                                    <label for="scoped-no"
                                           class="govuk-label govuk-radios__label">No</label>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                </th:block>

                <th:block th:if="${question.writtenFeedback != null or #fields.hasErrors('question.writtenFeedback')}">

                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('question.writtenFeedback')} ? 'govuk-form-group--error'">
                        <fieldset class="govuk-fieldset">
                            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="question.writtenFeedback">
                                <h2 class="">Written feedback</h2>
                            </legend>
                            <th:block th:if="${#fields.hasErrors('question.writtenFeedback')}">
                            <span class="govuk-error-message" th:each="err : ${#fields.errors('question.writtenFeedback')}"
                                  th:text="${err}"></span>
                            </th:block>
                            <div class="govuk-radios govuk-radios--inline">
                                <div class="govuk-radios__item" data-target="scored-options" data-target-clear-validation="true">
                                    <input id="writtenFeedback-yes"
                                           class="govuk-radios__input"
                                           th:name="question.writtenFeedback"
                                           th:checked="${question.writtenFeedback != null and question.writtenFeedback}"
                                           value="1"
                                           required="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="writtenFeedback-yes"
                                           class="govuk-label govuk-radios__label">Yes</label>
                                </div>
                                <div class="govuk-radios__item">
                                    <input id="writtenFeedback-no"
                                           class="govuk-radios__input"
                                           th:name="question.writtenFeedback"
                                           th:checked="${question.writtenFeedback != null and !question.writtenFeedback}"
                                           value="0"
                                           required="required"
                                           th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"
                                           type="radio"/>
                                    <label for="writtenFeedback-no"
                                           class="govuk-label govuk-radios__label">No</label>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="js-hidden" id="scored-options">
                        <div class="govuk-form-group"
                             th:classappend="${#fields.hasErrors('question.assessmentGuidanceTitle')} ? 'govuk-form-group--error'">
                            <label class="govuk-label govuk-label--s" for="question.assessmentGuidanceTitle">
                                Guidance title
                            </label>
                            <th:block th:if="${#fields.hasErrors('question.assessmentGuidanceTitle')}">
                                    <span class="govuk-error-message"
                                          th:each="err : ${#fields.errors('question.assessmentGuidanceTitle')}"
                                          th:text="${err}"></span>
                            </th:block>
                            <input class="govuk-input govuk-!-width-two-thirds"
                                   th:classappend="${#fields.hasErrors('question.assessmentGuidanceTitle')} ? 'govuk-input--error'"
                                   type="text"
                                   id="question.assessmentGuidanceTitle"
                                   th:name="question.assessmentGuidanceTitle"
                                   th:value="${question.assessmentGuidanceTitle}"
                                   required="required"/>
                        </div>

                        <div class="govuk-form-group"
                             th:classappend="${#fields.hasErrors('question.assessmentGuidance')} ? 'govuk-form-group--error'">
                            <label class="govuk-label govuk-label--s" for="question.assessmentGuidance">
                                Guidance
                            </label>
                            <th:block th:if="${#fields.hasErrors('question.assessmentGuidance')}">
                                    <span class="govuk-error-message"
                                          th:each="err : ${#fields.errors('question.assessmentGuidance')}"
                                          th:text="${err}"></span>
                            </th:block>
                            <input class="govuk-input govuk-!-width-two-thirds"
                                   th:classappend="${#fields.hasErrors('question.assessmentGuidance')} ? 'govuk-input--error'"
                                   type="text"
                                   id="question.assessmentGuidance"
                                   th:name="question.assessmentGuidance"
                                   th:value="${question.assessmentGuidance}"
                                   maxlength="255"
                                   required="required"/>
                        </div>

                        <div class="govuk-form-group">

                            <input type="hidden" name="removeGuidanceRow"/>

                            <h3 class="govuk-heading-s">Guidance table</h3>
                            <table id="guidance-table" class="govuk-table assessed-guidance"
                                   th:if="${competitionSetupForm.question.type == T(org.innovateuk.ifs.question.resource.QuestionSetupType).ASSESSED_QUESTION}">
                                <thead class="govuk-table__head">
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header" scope="col">Score <span class="govuk-visually-hidden"> from</span></th>
                                    <th class="govuk-table__header" scope="col"><span class="govuk-visually-hidden">Score to</span></th>
                                    <th class="govuk-table__header" scope="col">Justification</th>
                                    <th class="govuk-table__header" scope="col"><span class="govuk-visually-hidden">Action</span></th>
                                </tr>
                                </thead>
                                <tbody class="govuk-table__body">
                                    <th:block th:each="(score, iteration : ${competitionSetupForm.guidanceRows})">

                                    <tr th:id="${'guidance-'+iteration.index}"
                                        class="govuk-table__row form-group-row-validated"
                                        th:classappend="((${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreFrom')}) or (${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreTo')}) or (${#fields.hasErrors('guidanceRows[__${iteration.index}__].justification')})) ? 'govuk-form-group--error'">
                                        <td class="govuk-table__cell govuk-form-group"
                                            th:classappend="${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreFrom')} ? 'govuk-form-group--error'">
                                            <label class="govuk-label govuk-visually-hidden"
                                                   th:for="guidanceRows[__${iteration.index}__].scoreFrom">
                                                Score from
                                            </label>
                                            <th:block
                                                th:if="${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreFrom')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('guidanceRows[__${iteration.index}__].scoreFrom')}"
                                                          th:text="${err}"></span>
                                            </th:block>
                                            <input required="required"
                                                   type="number"
                                                   min="0"
                                                   class="govuk-input govuk-input--width-4"
                                                   th:errorclass="govuk-input--error"
                                                   th:id="guidanceRows[__${iteration.index}__].scoreFrom"
                                                   th:field="${competitionSetupForm.guidanceRows[__${iteration.index}__].scoreFrom}"
                                                   th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                                data-min-errormessage=#{validation.applicationquestionform.scorefrom.min}"/>
                                        </td>
                                        <td class="govuk-table__cell govuk-form-group"
                                            th:classappend="${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreTo')} ? 'govuk-form-group--error'">
                                            <label class="govuk-label govuk-visually-hidden"
                                                   th:for="guidanceRows[__${iteration.index}__].scoreTo">
                                                Score to
                                            </label>
                                            <th:block
                                                th:if="${#fields.hasErrors('guidanceRows[__${iteration.index}__].scoreTo')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('guidanceRows[__${iteration.index}__].scoreTo')}"
                                                          th:text="${err}"></span>
                                            </th:block>
                                            <input required="required" type="number" min="0"
                                                   class="govuk-input govuk-input--width-4"
                                                   th:errorclass="govuk-input--error"
                                                   th:id="guidanceRows[__${iteration.index}__].scoreTo"
                                                   th:field="${competitionSetupForm.guidanceRows[__${iteration.index}__].scoreTo}"
                                                   value=""
                                                   th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                                data-min-errormessage=#{validation.applicationquestionform.scoreto.min}"/>
                                        </td>
                                        <td class="govuk-table__cell govuk-form-group"
                                            th:classappend="${#fields.hasErrors('guidanceRows[__${iteration.index}__].justification')} ? 'govuk-form-group--error'">
                                            <label class="govuk-label govuk-visually-hidden"
                                                   th:for="guidanceRows[__${iteration.index}__].justification">
                                                Justification
                                            </label>
                                            <th:block
                                                th:if="${#fields.hasErrors('guidanceRows[__${iteration.index}__].justification')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('guidanceRows[__${iteration.index}__].justification')}"
                                                          th:text="${err}"></span>
                                            </th:block>
                                            <textarea required="required"
                                                      class="govuk-textarea"
                                                      th:errorclass="govuk-textarea--error"
                                                      th:id="guidanceRows[__${iteration.index}__].justification"
                                                      th:field="${competitionSetupForm.guidanceRows[__${iteration.index}__].justification}"
                                                      maxlength="5000"
                                                      th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                                data-maxlength-errormessage=#{validation.applicationquestionform.justification.maxlength}"
                                                      rows="3"/>
                                        </td>
                                        <td class="govuk-table__cell">
                                            <button class="button-clear alignright" data-remove-row="guidance"
                                                    type="button" name="remove-guidance-row"
                                                    th:value="${iteration.index}"
                                                    th:id="'remove-guidance-row-' + ${iteration.index}">Remove
                                            </button>
                                        </td>
                                    </tr>
                                </th:block>
                                </tbody>
                            </table>

                            <table class="govuk-table" id="guidance-table"
                                   th:if="${competitionSetupForm.question.type == T(org.innovateuk.ifs.question.resource.QuestionSetupType).SCOPE}">
                                <thead class="govuk-table__head">
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header" scope="col">Subject</th>
                                    <th class="govuk-table__header" scope="col">Justification</th>
                                    <th class="govuk-table__header" scope="col"><span class="govuk-visually-hidden">Action</span></th>
                                </tr>
                                </thead>
                                <tbody class="govuk-table__body">
                                <th:block th:each="(score, iteration : ${competitionSetupForm.question.guidanceRows})">
                                    <tr th:id="${'guidance-'+iteration.index}"
                                        class="govuk-table__row form-group-row-validated"
                                        th:classappend="((${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].subject')}) or (${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].justification')})) ? 'govuk-form-group--error'">
                                        <td class="govuk-table__cell govuk-form-group"
                                            th:classappend="${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].subject')} ? 'govuk-form-group--error'">
                                            <label class="govuk-label govuk-visually-hidden"
                                                   th:for="${'guidanceRow-'+iteration.index+'-subject'}">
                                                Subject
                                            </label>
                                            <th:block
                                                th:if="${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].subject')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('question.guidanceRows[__${iteration.index}__].subject')}"
                                                          th:text="${err}"></span>
                                            </th:block>
                                            <input required="required"
                                                   class="govuk-input govuk-input--width-4"
                                                   th:errorclass="govuk-input--error"
                                                   th:id="${'guidanceRow-'+iteration.index+'-subject'}"
                                                   th:field="${competitionSetupForm.question.guidanceRows[__${iteration.index}__].subject}"
                                                   maxlength="255"
                                                   th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                                data-maxlength-errormessage=#{validation.applicationquestionform.subject.maxlength}"/>
                                        </td>
                                        <td class="govuk-table__cell govuk-form-group"
                                            th:classappend="${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].justification')} ? 'govuk-form-group--error'">
                                            <label class="govuk-label govuk-visually-hidden"
                                                   th:for="${'guidanceRow-'+iteration.index+'-justification'}">
                                                Justification
                                            </label>
                                            <th:block
                                                th:if="${#fields.hasErrors('question.guidanceRows[__${iteration.index}__].justification')}">
                                                    <span class="govuk-error-message"
                                                          th:each="err : ${#fields.errors('question.guidanceRows[__${iteration.index}__].justification')}"
                                                          th:text="${err}"></span>
                                            </th:block>
                                            <textarea required="required"
                                                      class="govuk-textarea"
                                                      rows="3"
                                                      th:errorclass="govuk-textarea--error"
                                                      th:id="${'guidanceRow-'+iteration.index+'-justification'}"
                                                      th:field="${competitionSetupForm.question.guidanceRows[__${iteration.index}__].justification}"
                                                      maxlength="5000"
                                                      th:attr="data-required-errormessage=#{validation.field.must.not.be.blank},
                                                                data-maxlength-errormessage=#{validation.applicationquestionform.justification.maxlength}"/>
                                        </td>
                                        <td class="govuk-table__cell govuk-table__cell">
                                            <button class="button-clear alignright" data-remove-row="guidance"
                                                    type="button" name="remove-guidance-row"
                                                    th:value="${iteration.index}"
                                                    th:id="'remove-guidance-row-' + ${iteration.index}">Remove
                                            </button>
                                        </td>
                                    </tr>
                                </th:block>
                                </tbody>
                            </table>
                            <div class="alignright govuk-!-margin-top-6">
                                <button class="button-clear" data-add-row="guidance" type="button">+Add guidance row
                                </button>
                            </div>

                            <div class="govuk-form-group"
                                 th:classappend="${#fields.hasErrors('question.assessmentMaxWords')} ? 'govuk-form-group--error'">
                                <label class="govuk-label" for="question.assessmentMaxWords">
                                    Max word count
                                </label>
                                <th:block th:if="${#fields.hasErrors('question.assessmentMaxWords')}">
                                        <span class="govuk-error-message"
                                              th:each="err : ${#fields.errors('question.assessmentMaxWords')}"
                                              th:text="${err}"></span>
                                </th:block>
                                <input class="govuk-input govuk-input--width-10"
                                       th:classappend="${#fields.hasErrors('question.assessmentMaxWords')} ? 'govuk-input--error'"
                                       type="number"
                                       id="question.assessmentMaxWords"
                                       min="0"
                                       required="required"
                                       th:name="question.assessmentMaxWords"
                                       th:value="${question.assessmentMaxWords}"
                                       th:attr="data-min-errormessage=#{validation.applicationquestionform.maxwords.min}"/>
                            </div>
                        </div>
                    </div>
                </th:block>
            </th:block>

        </div>
    </th:block>
</div>
