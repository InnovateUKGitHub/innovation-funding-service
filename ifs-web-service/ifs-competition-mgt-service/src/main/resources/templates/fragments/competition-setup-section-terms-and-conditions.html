
<!-- =================Section: Terms and Conditions (3) =========================== -->
<th:block th:fragment="section-content" xmlns:th="http://www.thymeleaf.org">
    <div th:if="${#fields.hasErrors('${competitionSetupForm.*}')}" class="govuk-error-summary" role="alert" aria-labelledby="error-summary-title" tabindex="-1" data-module="govuk-error-summary">
        <h2 class="govuk-error-summary__title" id="error-summary-title">There is a problem</h2>
        <th:block th:insert="fragments/elements :: error-summary-list(competitionSetupForm)" />
    </div>

    <th:block th:unless="${model.includeStateAid}" th:insert="fragments/layout :: page-title" th:with="pageTitle='Competition terms and conditions',size='govuk-heading-xl'" />

    <th:block th:if="${model.includeStateAid AND model.general.editable}">
        <th:block th:unless="${model.stateAidPage}">
            <p class="govuk-body"><span class="hint">Terms and conditions</span></p>
            <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Subsidy Control',size='govuk-heading-xl'" />
        </th:block>
        <th:block th:if="${model.stateAidPage}">
            <p class="govuk-body"><span class="hint">Terms and conditions</span></p>
            <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='State Aid',size='govuk-heading-xl'" />
        </th:block>
    </th:block>

    <th:block th:if="${model.includeStateAid AND !model.general.editable}" th:insert="fragments/layout :: page-title" th:with="pageTitle='Terms and conditions',size='govuk-heading-xl'" />

    <th:block th:if="${model.general.editable}">
        <th:block th:if="${model.stateAidPage AND model.currentStateAidTermsAndConditions != null}">
            <p class="govuk-body">These are the terms and conditions applicants must accept for this competition.</p>

            <p class="govuk-body"><a th:text="|${model.currentStateAidTermsAndConditions.name} (opens in a new window)|"
                                     th:href="@{~/competition/{competitionId}/info/state-aid-terms-and-conditions(competitionId=${model.general.competition.id})}"
                                     target="_blank"
                                     class="govuk-link">
                Terms and conditions</a>
            </p>
        </th:block>
        <th:block th:if="${!model.stateAidPage AND model.currentTermsAndConditions != null}">
            <p class="govuk-body">These are the terms and conditions applicants must accept for this competition.</p>

            <p class="govuk-body"><a th:text="|${model.currentTermsAndConditions.name} (opens in a new window)|"
                                     th:href="@{~/competition/{competitionId}/info/terms-and-conditions(competitionId=${model.general.competition.id})}"
                                     target="_blank"
                                     class="govuk-link">
                Terms and conditions</a>
            </p>
        </th:block>
    </th:block>

    <th:block th:unless="${model.general.editable}">
        <dl class="standard-definition-list column-definition-list" th:if="${model.includeStateAid}">
            <dt>Subsidy control terms and conditions</dt>
            <dd><th:block th:if="${model.currentTermsAndConditions != null}" th:text="${model.currentTermsAndConditions.name}"></th:block></dd>
            <dt>State aid terms and conditions</dt>
            <dd><th:block th:if="${model.currentStateAidTermsAndConditions != null}" th:text="${model.currentStateAidTermsAndConditions.name}"></th:block></dd>
        </dl>
        <th:block th:if="${!model.includeStateAid AND model.currentTermsAndConditions != null}">
            <p class="govuk-body">These are the terms and conditions applicants must accept for this competition.</p>

            <p class="govuk-body"><a th:text="|${model.currentTermsAndConditions.name} (opens in a new window)|"
                                     th:href="@{~/competition/{competitionId}/info/terms-and-conditions(competitionId=${model.general.competition.id})}"
                                     target="_blank"
                                     class="govuk-link">
                Terms and conditions</a>
            </p>
        </th:block>
    </th:block>

    <form th:action="@{(${model.general.editable} ? '' : 'terms-and-conditions/edit')}"
          th:object="${competitionSetupForm}"
          data-section="terms-and-conditions"
          method="post" novalidate="novalidate"
          enctype="multipart/form-data">
        <div th:if="${model.general.editable}" id="section-3-edit">

            <div class="govuk-radios">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-visually-hidden">Select the terms and conditions applicants must accept for this competition.</legend>
                    <div class="govuk-radios__item" th:each="item : ${model.termsAndConditionsList}"
                         th:attr="data-target=${item.thirdPartyProcurement ? 'procurement-thirdparty' :
                              (item.procurement ?  'procurement-upload' : null) }">
                       <input type="radio"
                               class="govuk-radios__input"
                               th:field="*{termsAndConditionsId}"
                               required="required"
                               th:value="${item.id}"
                               th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"/>
                        <label th:for="${#ids.prev('termsAndConditionsId')}" class="govuk-label govuk-radios__label">
                            [[${item.name}]]
                        </label>
                    </div>
                </fieldset>
            </div>

            <div id="procurement-thirdparty"  class="govuk-form-group" >
                   <div id="agreement-title" class="govuk-form-group govuk-!-margin-top-6"
                 th:classappend="${#fields.hasErrors('thirdPartyAgreementTitle')} ? 'govuk-form-group--error'">
                 <label class="govuk-label govuk-label--s" for="thirdPartyAgreementTitle">
                     Label to replace Terms and Conditions
                 </label>
                 <span class="govuk-hint">Appears against the applicant terms and conditions.</span>
                  <th:block th:if="${#fields.hasErrors('thirdPartyAgreementTitle')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('thirdPartyAgreementTitle')}" th:text="${err}" />
                   </th:block>
                    <input class="govuk-input"
                           id="thirdPartyAgreementTitle"
                           type="text"
                           th:errorclass="govuk-input--error"
                           th:field="${competitionSetupForm.thirdPartyAgreementTitle}"
                           required="required"
                           maxlength="255"
                           th:attr="data-required-errormessage=#{validation.thirdParty.agreementTitle.required}" />
            </div>

            <div id="agreement-content" div class="govuk-form-group" th:classappend="${#fields.hasErrors('thirdPartyAgreementContent')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="thirdPartyAgreementContent">
                    Description text for T&C page
                </label>
                <span class="govuk-hint"> Appears against the applicant terms and conditions.</span>
                <th:block th:if="${#fields.hasErrors('thirdPartyAgreementContent')}">
                    <span class="govuk-error-message" th:each="err : ${#fields.errors('thirdPartyAgreementContent')}" th:text="${err}" />
                </th:block>
                <div class="textarea-wrapped">
                <textarea data-editor="html"
                          class="govuk-textarea"
                          id="thirdPartyAgreementContent"
                          ifs:utext="${competitionSetupForm.thirdPartyAgreementContent}"
                          th:field="${competitionSetupForm.thirdPartyAgreementContent}"
                          required="required"
                          th:attr="data-required-errormessage=#{validation.thirdParty.agreementContent.required}"></textarea>
                </div>
            </div>

            <div id="project-cost-guidance-url" class="govuk-form-group" th:classappend="${#fields.hasErrors('projectCostGuidanceURL')} ? 'govuk-form-group--error'">
                <label class="govuk-label govuk-label--s" for="projectCostGuidanceURL">
                    Project Costs Guidance link
                </label>
                <span class="govuk-hint">Appears against the acceptance of an applicant project costs.</span>
                <th:block th:if="${#fields.hasErrors('thirdPartyAgreementTitle')}">
                    <span class="govuk-error-message" th:each="err : ${#fields.errors('projectCostGuidanceURL')}" th:text="${err}" />
                </th:block>
                <input class="govuk-input"
                       id="projectCostGuidanceURL"
                       type="text"
                       th:errorclass="govuk-input--error"
                       th:field="${competitionSetupForm.projectCostGuidanceURL}"
                       required="required"
                       maxlength="255"
                       th:attr="data-required-errormessage=#{validation.thirdParty.projectCostGuidanceURL.required}" />
            </div>
            <div id="procurement-thirdparty-upload" class="upload-section" >
                    <th:block th:insert="question-type/types :: fileupload-fragment(edit,
                                @{~/competition/{competitionId}/info/terms-and-conditions/full(competitionId=${model.general.competition.id})},
                                ${model.general.competition.competitionTerms?.name},
                                termsAndConditionsDoc,
                                termsAndConditionsDoc,
                                true,
                                deleteTermsAndConditionsDoc,
                                uploadTermsAndConditionsDoc)"/>
            </div>

            </div>

            <div id="procurement-upload" class="upload-section" th:unless="${model.includeStateAid}">
                <th:block th:insert="question-type/types :: fileupload-fragment(edit,
                                @{~/competition/{competitionId}/info/terms-and-conditions/full(competitionId=${model.general.competition.id})},
                                ${model.general.competition.competitionTerms?.name},
                                termsAndConditionsDoc,
                                termsAndConditionsDoc,
                                true,
                                deleteTermsAndConditionsDoc,
                                uploadTermsAndConditionsDoc)"/>
            </div>

            <button class="govuk-button govuk-!-margin-top-5">Done</button>
        </div>

        <th:block th:unless="${model.general.editable}">
            <button th:unless="${model.general.state.preventEdit}" type="submit" class="govuk-button">Edit</button>
        </th:block>

    </form>

    <ul class="govuk-list pagination">
        <li class="prev">
            <a rel="prev" title="Navigate to previous part"
               th:href="@{/competition/setup/{sectionPath}/{competitionId}(competitionId=${model.general.competition.id},sectionPath='public-content')}">
                <span class="pagination-label">Previous</span>
                <span class="pagination-part-title">Public content</span>
            </a>
        </li>
        <li class="next">
            <a rel="next" title="Navigate to next part"
               th:href="@{/competition/setup/{competitionId}/section/{sectionPath}(competitionId=${model.general.competition.id},sectionPath='additional')}">
                <span class="pagination-label">Next</span>
                <span class="pagination-part-title">Funding information</span>
            </a>
        </li>
    </ul>
</th:block>
