
<!-- =================== Comp setup section - Additional info (2) ============================== -->
<th:block th:fragment="section-content">

    <div th:if="${#fields.hasErrors('${competitionSetupForm.*}')}" class="govuk-error-summary" role="alert" aria-labelledby="error-summary-title" tabindex="-1" data-module="error-summary">
        <h2 class="govuk-error-summary__title" id="error-summary-title">Unable to save section.</h2>
        <th:block th:insert="fragments/elements :: error-summary-list(competitionSetupForm)" />
    </div>

    <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Funding information',size='govuk-heading-xl'" />

    <form th:attr="data-competition=${model.general.competition.id},data-autosave=${!model.general.state.setupComplete}?compSetup" data-section="additional"
          th:action="@{(${model.general.editable} ? '' : 'additional/edit')}"
          method="post" th:object="${competitionSetupForm}" novalidate="novalidate">

        <fieldset th:if="${model.general.editable}"
                  class="govuk-fieldset">
            <legend class="govuk-visually-hidden">Funding information</legend>
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half">
                    <div class="govuk-form-group">
                        <span class="govuk-label">Funder</span>
                    </div>
                </div>

                <div class="govuk-grid-column-one-half">
                    <div class="govuk-form-group">
                        <span class="govuk-label">Budget</span>
                    </div>
                </div>
            </div>

            <div th:each="(funder, iteration : ${competitionSetupForm.funders})" class="govuk-grid-row funder-row" th:id="'funder-row-'+${iteration.index}">
                <div class="govuk-grid-column-one-half">
                    <div class="govuk-form-group" th:classappend="${#fields.hasErrors('funders[__${iteration.index}__].funder')} ? 'govuk-form-group--error'">
                        <label class="govuk-label" th:for="funders[__${iteration.index}__].funder">
                        </label>
                        <th:block th:if="${#fields.hasErrors('funders[__${iteration.index}__].funder')}">
                            <span class="error-message"  th:each="err : ${#fields.errors('funders[__${iteration.index}__].funder')}" th:text="${err}"></span>
                        </th:block>
                        <input required="required" class="form-control width-x-large"
                               th:errorclass="form-control-error"
                               th:id="funders[__${iteration.index}__].funder"
                               th:field="${competitionSetupForm.funders[__${iteration.index}__].funder}"
                               th:attr="data-required-errormessage=#{validation.additionalinfoform.fundername.required},
                                        data-maxlength-errormessage=#{validation.additionalinfoform.funder.size(null,null,'255')}" />
                    </div>
                </div>

                <div class="govuk-grid-column-one-half">
                    <div class="govuk-form-group" th:classappend="${#fields.hasErrors('funders[__${iteration.index}__].funderBudget')} ? 'govuk-form-group--error'">
                        <label class="govuk-label" th:for="funders[__${iteration.index}__].funderBudget">
                        </label>
                        <th:block th:if="${#fields.hasErrors('funders[__${iteration.index}__].funderBudget')}">
                            <span class="error-message"  th:each="err : ${#fields.errors('funders[__${iteration.index}__].funderBudget')}" th:text="${err}"></span>
                        </th:block>
                        <input required="required" type="number" min="0"
                               class="form-control width-x-large"
                               th:errorclass="form-control-error"
                               th:id="funders[__${iteration.index}__].funderBudget"
                               th:field="${competitionSetupForm.funders[__${iteration.index}__].funderBudget}"
                               value=""
                               th:attr="data-required-errormessage=#{validation.additionalinfoform.funderbudget.required},
                                        data-min-errormessage=#{validation.additionalinfoform.funderbudget.min}" />
                        <input type="hidden"
                               th:field="${competitionSetupForm.funders[__${iteration.index}__].coFunder}"
                               th:value="${iteration.index != 0}" />

                        <button th:unless="${isSetupAndAfterNotifications}" th:if="${iteration.index != 0}" class="button-clear" data-remove-row="cofunder" name="remove-funder" th:value="${iteration.index}"
                                th:id="'remove-funder-' + ${iteration.index}">Remove</button>
                    </div>
                </div>
            </div>


            <div class="govuk-grid-row" id="dynamic-row-pointer">
                <div class="govuk-grid-column-one-half">
                    &nbsp;
                </div>
                <div class="govuk-grid-column-one-half">
                    <p class="govuk-heading-s govuk-!-margin-0">Total: <span data-calculation-operations="+" data-calculation-fields="input[id*=funderBudget]" th:text="${competitionSetupForm.totalFunding == 0 ? '' : '&pound;' + #numbers.formatInteger(competitionSetupForm.totalFunding, 0, 'DEFAULT')}">Â£0</span></p>

                    <div class="alignright">
                        <input type="hidden" name="removeFunder" />
                        <button class="button-clear" name="add-cofunder" data-add-row="cofunder" type="button">+Add co-funder</button>
                    </div>
                </div>
            </div>

            <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                    <h2 class="govuk-fieldset__heading">Reporting fields</h2>
                </legend>

                <div class="govuk-form-group" th:classappend="${#fields.hasErrors('pafNumber')} ? 'govuk-form-group--error'">
                    <label class="govuk-label" for="pafNumber">
                        PAF number
                    </label>
                    <th:block th:if="${#fields.hasErrors('pafNumber')}">
                        <span class="error-message"  th:each="err : ${#fields.errors('pafNumber')}" th:text="${err}"></span>
                    </th:block>
                    <input class="form-control width-large"
                           th:errorclass="form-control-error"
                           type="text"
                           id="pafNumber"
                           th:field="${competitionSetupForm.pafNumber}" />
                </div>

                <div class="govuk-form-group" th:classappend="${#fields.hasErrors('budgetCode')} ? 'govuk-form-group--error'">
                    <label class="govuk-label" for="budgetCode">
                        Budget code
                    </label>
                    <th:block th:if="${#fields.hasErrors('budgetCode')}">
                        <span class="error-message"  th:each="err : ${#fields.errors('budgetCode')}" th:text="${err}"></span>
                    </th:block>
                    <input class="form-control width-large"
                           id="budgetCode"
                           th:errorclass="form-control-error"
                           type="text"
                           th:field="${competitionSetupForm.budgetCode}" />
                </div>


                <div class="govuk-form-group" th:classappend="${#fields.hasErrors('activityCode')} ? 'govuk-form-group--error'">
                    <label class="govuk-label" for="activityCode">
                        Activity code
                    </label>
                    <th:block th:if="${#fields.hasErrors('activityCode')}">
                        <span class="error-message"  th:each="err : ${#fields.errors('activityCode')}" th:text="${err}"></span>
                    </th:block>
                    <input class="form-control width-large"
                           th:errorclass="form-control-error"
                           type="text"
                           id="activityCode"
                           th:field="${competitionSetupForm.activityCode}"
                           maxlength="255"
                           th:attr="data-maxlength-errormessage=#{validation.additionalinfoform.activitycode.size}" />

                </div>

                <div class="govuk-form-group" th:classappend="${#fields.hasErrors('competitionCode')} ? 'govuk-form-group--error'">
                    <label class="govuk-label" for="competitionCode">
                        Competition code
                    </label>
                    <th:block th:if="${#fields.hasErrors('competitionCode')}">
                        <span class="error-message"  th:each="err : ${#fields.errors('competitionCode')}" th:text="${err}"></span>
                    </th:block>
                    <input readonly="readonly"
                           class="form-control width-large readonly-boxed"
                           th:classappend="${#fields.hasErrors('competitionCode')} ? 'form-control-error'"
                           type="text"
                           id="competitionCode"
                           name="competitionCode"
                           th:value="${competitionSetupForm.competitionCode}"
                           required="required"
                           th:attr="data-required-errormessage=#{validation.additionalinfoform.competitioncode.required}"
                           data-autosave-disabled="data-autosave-disabled"/>
                    <button class="button-secondary" th:disabled="${model.general.state.setupAndLive}" th:if="${#strings.isEmpty(competitionSetupForm.competitionCode)}" type="submit" name="generate-code" id="generate-code" th:value="${model.general.competition.id}">Generate code</button>
                </div>
            </fieldset>

            <button class="govuk-button">Done</button>
        </fieldset>

        <fieldset th:if="${!model.general.editable}" id="section-2-" class="govuk-fieldset">
            <table>
                <thead>
                <tr>
                    <th scope="col">Funder</th>
                    <th scope="col" class="numeric">Budget</th>
                </tr>
                </thead>
                <tfoot>
                <tr>
                    <th>Total</th>
                    <td class="numeric" th:text="${competitionSetupForm.totalFunding == 0 ? '' : '&pound;' + #numbers.formatInteger(competitionSetupForm.totalFunding, 0, 'DEFAULT')}">Total</td>
                </tr>
                </tfoot>
                <tbody>
                <tr  th:each="(funder, iteration : ${competitionSetupForm.funders})">
                    <th:block th:if="iteration == 0">
                        <td th:text="${funder.funder}">Funder Name</td>
                        <td class="numeric" th:text="${funder?.funderBudget != null} ? ${'&pound;' + #numbers.formatInteger(funder?.funderBudget, 0, 'DEFAULT')}">Funder Budget</td>
                    </th:block>
                    <th:block th:unless="iteration == 0">
                        <td th:text="${funder.funder}">Co-Funder Name</td>
                        <td class="numeric" th:text="${funder?.funderBudget != null} ? ${'&pound;' + #numbers.formatInteger(funder?.funderBudget, 0, 'DEFAULT')}">Co-Funder Budget</td>
                    </th:block>
                </tr>
                </tbody>
            </table>

            <dl class="standard-definition-list govuk-!-margin-top-6">
                <dt>PAF number</dt>
                <dd th:text="${competitionSetupForm.pafNumber}">PAF Number</dd>
                <dt>Budget code</dt>
                <dd th:text="${competitionSetupForm.budgetCode}">Budget Code</dd>
                <dt>Activity code</dt>
                <dd th:text="${competitionSetupForm.activityCode}">Activity Code</dd>
                <dt>Competition code</dt>
                <dd th:text="${competitionSetupForm.competitionCode}">Competition Code</dd>
            </dl>

            <button th:unless="${model.general.state.preventEdit}" type="submit" class="govuk-button">Edit</button>
        </fieldset>

    </form>
    <ul class="pagination">
        <li class="prev">
            <a rel="prev" title="Navigate to next part" th:href="@{/competition/setup/{competitionId}/section/{sectionPath}(competitionId=${model.general.competition.id},sectionPath='terms-and-conditions')}">
                <span class="pagination-label">Previous</span>
                <span class="pagination-part-title">Terms and conditions</span>
            </a>
        </li>
        <li class="next">
            <a rel="next" title="Navigate to next part" th:href="@{/competition/setup/{competitionId}/section/{sectionPath}(competitionId=${model.general.competition.id},sectionPath='eligibility')}">
                <span class="pagination-label">Next</span>
                <span class="pagination-part-title">Eligibility</span>
            </a>
        </li>
    </ul>
</th:block>
