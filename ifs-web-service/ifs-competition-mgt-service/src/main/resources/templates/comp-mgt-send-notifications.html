<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Funding decision notification'" />
</head>

<body th:with="context='comp-management'" class="competition-management">
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<main id="content" th:object="${form}">
    <th:block th:insert="fragments/layout :: header-sub" th:with="linkTitle='Manage funding notifications',linkClass='link-back',linkUrl=@{/competition/{competitionId}/manage-funding-applications(competitionId=${model.competitionId})}" />
    <h1 class="heading-xlarge">
                <span class="heading-secondary"><th:block th:text="${#numbers.formatInteger(model.competitionId,8)}"/>: <th:block
                    th:text="${model.competitionName}"/></span>
        <span>Funding decision notification</span>
    </h1>

    <p>This email can be edited. It will be received by all applicants associated with each of the applications you selected.</p>

    <div class="error-summary" th:if="${#fields.hasErrors('*')}">
        <h2 class="heading-medium error-summary-heading">There is a problem on this page</h2>
        <ul class="error-summary-list">
            <th:block th:each="err : ${#fields.errors('*')}">
                <li th:classappend="list-header" th:text="${err}"></li>
            </th:block>
        </ul>
    </div>

    <h2 class="heading-medium">Key statistics</h2>

    <ul class="grid-row">
        <li th:if="${model.keyStatistics.statTwo != null}" class="column-third">
            <div class="highlight-panel highlight-panel-padded">
                <span class="heading-large" th:text="${model.keyStatistics.statTwo}">2</span><br/>
                <small>successful</small>
            </div>
        </li>

        <li th:if="${model.keyStatistics.statThree != null}" class="column-third">
            <div class="highlight-panel highlight-panel-padded">
                <span class="heading-large" th:text="${model.keyStatistics.statThree}">3</span><br/>
                <small>unsuccessful</small>
            </div>
        </li>

        <li th:if="${model.keyStatistics.statFour != null}" class="column-third">
            <div class="highlight-panel highlight-panel-padded">
                <span class="heading-large" th:text="${model.keyStatistics.statFour}">4</span><br/>
                <small>on hold</small>
            </div>
        </li>
    </ul>

    <h2 class="heading-small">Recipients</h2>
    <details>
        <summary><span class="summary">Review list of recipients</span></summary>
        <div class="panel table-overflow">
        <table id="application-list">
            <thead>
            <tr>
                <th scope="col">Application number</th>
                <th scope="col">Project title</th>
                <th scope="col">Lead</th>
                <th scope="col">Funding decision</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="applicationSummary, stat : ${model.applications}">
                <td th:text="${#numbers.formatInteger(applicationSummary.id,8)}">Application number</td>
                <td th:text="${applicationSummary.name}">Project title</td>
                <td th:text="${applicationSummary.lead}">Lead</td>
                <th:block th:switch="${applicationSummary.fundingDecision}">
                    <td th:case="${T(org.innovateuk.ifs.application.resource.FundingDecision).FUNDED}">Successful</td>
                    <td th:case="${T(org.innovateuk.ifs.application.resource.FundingDecision).UNFUNDED}">Unsuccessful</td>
                    <td th:case="${T(org.innovateuk.ifs.application.resource.FundingDecision).UNDECIDED}">Undecided</td>
                    <td th:case="${T(org.innovateuk.ifs.application.resource.FundingDecision).ON_HOLD}">On hold</td>
                    <td th:case="*">-</td>
                </th:block>
            </tr>
            </tbody>
        </table>
        </div>
    </details>

    <form th:action="@{${#ifsUtil.uriWithQueryString(#httpServletRequest)}}"
          th:object="${form}"
          method="POST">
        <div class="form-group extra-margin">
            <label class="form-label-bold" for="subject">
                Subject
            </label>

            <input class="form-control"
                   id="subject"
                   type="text"
                   th:field="${form.subject}"
                   required="required"
                   th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}" />
        </div>

        <div class="form-group">
            <label class="form-label-bold" for="message">
                Message
            </label>
            <div class="textarea-wrapped">
                    <textarea id="message"
                              th:field="${form.message}"
                              th:errorclass="field-error"
                              ifs:utext="${form.message}"
                              class="form-control width-full"
                              data-editor="html"
                              maxlength="5000"
                              rows="4"
                              required="required"
                              th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}">
                    </textarea>
            </div>
        </div>

        <th:block th:each="entry : ${model.fundingDecisions}" >
            <input type="hidden"  th:name="'fundingDecisions[' + ${entry.key} + ']'" th:value="${entry.value}"/>
        </th:block>
        <button name="send-emails" class="button">Send email to all applicants</button>

        <a th:href="@{/competition/{competitionId}/manage-funding-applications(competitionId=${model.competitionId})}">
            Cancel
        </a>
    </form>

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
</body>
</html>
