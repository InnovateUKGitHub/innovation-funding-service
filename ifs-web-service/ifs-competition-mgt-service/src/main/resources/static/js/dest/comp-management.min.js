if("undefined"==typeof IFS)var IFS={};IFS.competitionManagement={},IFS.competitionManagement.loadOrder={common:{init:function(){IFS.competitionManagement.stickyMenu.init(),IFS.competitionManagement.various.init()}},"competition-setup":{init:function(){IFS.competitionManagement.setup.init(),IFS.core.finance.init()}}},IFS.competitionManagement.stickyMenu=function(){"use strict";var e,n,t={};return{settings:{menu:jQuery(".info-area"),container:".competition-data form",breakpoint:1200},init:function(){n=this.settings,IFS.competitionManagement.stickyMenu.getWindowWidth(),IFS.competitionManagement.stickyMenu.getMenuHeight(),IFS.competitionManagement.stickyMenu.getContainerHeight(),IFS.competitionManagement.stickyMenu.stickyEnabled()&&(IFS.competitionManagement.stickyMenu.getMenuWidth(),IFS.competitionManagement.stickyMenu.getMenuOffset(),IFS.competitionManagement.stickyMenu.getContainerOffset(),IFS.competitionManagement.stickyMenu.menuPxToPercentage()),jQuery(window).resize(function(){clearTimeout(e),e=setTimeout(function(){IFS.competitionManagement.stickyMenu.getMenuHeight(),IFS.competitionManagement.stickyMenu.getMenuWidth(),IFS.competitionManagement.stickyMenu.getContainerHeight(),IFS.competitionManagement.stickyMenu.getWindowWidth(),IFS.competitionManagement.stickyMenu.menuPxToPercentage(),IFS.competitionManagement.stickyMenu.stickyScroll()},250)}),jQuery(document).scroll(function(){IFS.competitionManagement.stickyMenu.stickyScroll()})},getWindowWidth:function(){t.windowWidth=jQuery(window).width()},getMenuOffset:function(){t.menuOffsetTop=n.menu.offset().top},getMenuWidth:function(){t.menuWidth=n.menu.width()},getMenuHeight:function(){t.menuHeight=n.menu.outerHeight()},getContainerHeight:function(){t.containerHeight=jQuery(n.container).outerHeight(!0)},getContainerOffset:function(){t.containerOffsetTop=jQuery(n.container).offset().top},stickyEnabled:function(){return n.breakpoint<t.windowWidth&&t.menuHeight<t.containerHeight},menuPxToPercentage:function(){t.menuPercentage=parseFloat(t.menuWidth/t.windowWidth*100).toFixed(2)},stickyScroll:function(){if(IFS.competitionManagement.stickyMenu.stickyEnabled()){var e=jQuery(document).scrollTop();if(t.menuHeight+e>t.containerHeight+t.containerOffsetTop){var i=t.containerHeight+t.containerOffsetTop-t.menuHeight;n.menu.addClass("bottom").removeClass("sticky").css({top:i+"px",width:t.menuPercentage+"%"})}else t.menuOffsetTop<e?n.menu.addClass("sticky").css({top:"0",width:t.menuPercentage+"%"}).removeClass("bottom"):n.menu.removeClass("sticky bottom").removeAttr("style")}else n.menu.removeClass("sticky bottom").removeAttr("style")}}}(),IFS.competitionManagement.various=function(){"use strict";var e;return{settings:{fundingDecisionSelects:".funding-decision",assessorFeedbackButton:"#publish-assessor-feedback",noJsAssessorFeedbackButton:"#publish-assessor-feedback-no-js",submitFundingDecisionButton:"#publish-funding-decision",noJsSubmitFundingDecisionButton:"#no-js-notify-applicants",noJsSaveFundingDecisionButton:"#no-js-save-funding-decision",fundingDecisionForm:"#submit-funding-decision-form"},init:function(){e=this.settings,jQuery(document).on("change",e.fundingDecisionSelects,IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable),IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable(),IFS.competitionManagement.various.alterSubmitDecisionFormAction()},disableFundingDecisonButton:function(){var n=jQuery(e.submitFundingDecisionButton),t=n.attr("data-js-modal");n.on("click",function(e){e.preventDefault()}),n.removeAttr("data-js-modal").attr({"data-js-modal-disabled":t,"aria-disabled":"true"}).addClass("disabled")},enableFundingDecisionButton:function(){var n=jQuery(e.submitFundingDecisionButton),t=n.attr("data-js-modal-disabled");n.off("click").removeAttr("data-js-modal-disabled aria-disabled").attr("data-js-modal",t).removeClass("disabled")},alterSubmitDecisionFormAction:function(){var n=jQuery(e.fundingDecisionForm),t=n.attr("action");n.attr("action",t+"submit")},allSelectsDecided:function(){var n=jQuery(e.fundingDecisionSelects);if(null===n||void 0===n||0===n.length)return!1;var t=!0;return n.each(function(){var e=jQuery(this).val(),n="Y"===e||"N"===e;n||(t=!1)}),t},handleFundingDecisionEnableOrDisable:function(){IFS.competitionManagement.various.allSelectsDecided()?IFS.competitionManagement.various.enableFundingDecisionButton():IFS.competitionManagement.various.disableFundingDecisonButton()}}}(),IFS.competitionManagement.setup=function(){"use strict";var e;return{settings:{milestonesForm:'[data-section="milestones"]'},init:function(){e=this.settings,IFS.competitionManagement.setup.handleCompetitionCode(),IFS.competitionManagement.setup.handleAddCoFunder(),IFS.competitionManagement.setup.handleRemoveCoFunder(),jQuery("body.competition-management.competition-setup").on("change","#competitionTypeId",function(){IFS.competitionManagement.setup.handleStateAid()}),jQuery("body.competition-management.competition-setup").on("change",'[name="innovationSectorCategoryId"]',function(){IFS.competitionManagement.setup.handleInnovationSector(!1)}),IFS.competitionManagement.setup.innovationSectorOnPageLoad(),jQuery(e.milestonesForm).on("change","input[data-date]",function(){IFS.competitionManagement.setup.milestonesExtraValidation(),IFS.competitionManagement.setup.milestonesSetFutureDate(jQuery(this))}),IFS.competitionManagement.setup.mileStoneValidateOnPageLoad()},handleCompetitionCode:function(){jQuery(document).on("click","#generate-code",function(){var e=jQuery(this),n=e.val(),t=e.closest(".form-group").find("input"),i=window.location.protocol+"//"+window.location.host+"/management/competition/setup/"+n+"/generateCompetitionCode";return jQuery.ajaxProtected({type:"GET",url:i,success:function(e){"undefined"!=typeof e&&("true"===e.success?(IFS.core.formValidation.setValid(t,IFS.core.formValidation.getErrorMessage(t,"required")),t.val(e.message),jQuery("body").trigger("updateSerializedFormState")):IFS.core.formValidation.setInvalid(t,e.message))}}),!1})},handleInnovationSector:function(e){var n=jQuery('[name="innovationSectorCategoryId"]').val(),t=jQuery('[name="innovationAreaCategoryId"]').val();if("undefined"!=typeof n){var i=window.location.protocol+"//"+window.location.host+"/management/competition/setup/getInnovationArea/"+n;jQuery.ajaxProtected({type:"GET",url:i,success:function(n){var i=jQuery('[name="innovationAreaCategoryId"]');i.children().remove(),jQuery.each(n,function(){this.id==t?i.append('<option selected="selected" value="'+this.id+'">'+this.name+"</option>"):i.append('<option value="'+this.id+'">'+this.name+"</option>")}),e||(jQuery(i).trigger("ifsValidate"),IFS.core.autoSave.fieldChanged('[name="innovationSectorCategoryId"]'),IFS.core.autoSave.fieldChanged('[name="innovationAreaCategoryId"]'))}})}},innovationSectorOnPageLoad:function(){var e=jQuery('[name="innovationSectorCategoryId"]'),n=e.val();if(e.length)if(n)IFS.competitionManagement.setup.handleInnovationSector(!0);else{var t=jQuery('[name="innovationAreaCategoryId"]');t.children().remove(),t.append('<option value="innovation sector" disabled="disabled" selected="selected">Please select an innovation sector first &hellip;</option>')}},handleStateAid:function(){var e=jQuery("#competitionTypeId").find('[value="'+jQuery("#competitionTypeId").val()+'"]').attr("data-stateaid");e="true"==e?"yes":"no",jQuery("#stateAid").attr("aria-hidden","false").find("p").html('<span class="'+e+'">'+e+"</span>")},handleAddCoFunder:function(){jQuery(document).on("click","#add-cofunder",function(){var e=parseInt(jQuery("#co-funder-count").val(),10);return jQuery('<div class="grid-row funder-row" id="funder-row-'+e+'"><div class="column-half"><div class="form-group"><input type="text" maxlength="255" data-maxlength-errormessage="Funders has a maximum length of 255 characters" class="form-control width-x-large" id="'+e+'-funder" name="funders['+e+'].funder" value=""></div></div><div class="column-half"><div class="form-group"><input type="number" min="0" class="form-control width-x-large" id="'+e+'-funderBudget" name="funders['+e+'].funderBudget" value=""><input required="required" type="hidden" id="'+e+'-coFunder" name="funders['+e+'].coFunder" value="true"><button class="buttonlink remove-funder" name="remove-funder" value="'+e+'" id="remove-funder-'+e+'">Remove</button></div></div></div>').insertBefore("#dynamic-row-pointer"),jQuery("#co-funder-count").val(e+1),!1})},handleRemoveCoFunder:function(){jQuery(document).on("click",".remove-funder",function(){var e=jQuery(this),n=e.val(),t=e.closest(".funder-row"),i=parseInt(jQuery("#co-funder-count").val(),10);return jQuery('[name="removeFunder"]').val(n),IFS.core.autoSave.fieldChanged('[name="removeFunder"]'),t.remove(),jQuery("#co-funder-count").val(i-1),IFS.competitionManagement.setup.reindexFunderRows(),jQuery("body").trigger("recalculateAllFinances"),!1})},reindexFunderRows:function(){jQuery('[name*="funders"]').each(function(){var e=jQuery(this),n=e.closest(".funder-row").index(".funder-row"),t=e.attr("name"),i=t.replace(/funders\[\d\]/,"funders["+n+"]");e.attr("name",i)}),jQuery("button.remove-funder").each(function(){var e=jQuery(this),n=e.closest(".funder-row").index(".funder-row");e.val(n)})},milestonesExtraValidation:function(){var n=jQuery(e.milestonesForm+" .field-error"),t=jQuery(e.milestonesForm+" input").filter(function(){return!this.value});0===n.length&&0===t.length&&jQuery(e.milestonesForm+" .error-summary").attr("aria-hidden","true")},mileStoneValidateOnPageLoad:function(){jQuery(e.milestonesForm+" .day input").each(function(e,n){var t=jQuery(n);0===e&&IFS.core.formValidation.checkDate(t,!0),IFS.competitionManagement.setup.milestonesSetFutureDate(t)})},milestonesSetFutureDate:function(e){setTimeout(function(){var n=e.closest("tr").next("tr"),t=e.attr("data-date");if(n.length&&(n.attr({"data-future-date":t}),0!==jQuery.trim(t.length))){var i=n.find(".day input");IFS.core.formValidation.checkDate(i,!0)}},0)}}}();