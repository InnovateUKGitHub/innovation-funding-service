<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<!--/*@thymesVar id="form" type="org.innovateuk.ifs.application.forms.sections.procurement.milestones.form.ProcurementMilestonesForm"*/-->

<th:block th:fragment="milestones-form(form)">
    <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-finances">
        <div class="govuk-accordion__section"
            th:each="entry : ${form.milestones}">
            <th:block th:insert="this :: milestones-row(${entry.key}, ${entry.value}, ${form.getTotalCosts()})"></th:block>
        </div>
    </div>

    <p class="govuk-body">Total payment requested <span class="govuk-!-margin-left-3" th:text="${form.totalPercentages}"></span><span class="govuk-!-margin-left-3" th:text="${form.totalCosts}"></span></p>
</th:block>

<th:block  th:fragment="milestones-row(id, milestone, totalCosts)">
    <!--/*@thymesVar id="id" type="java.lang.String"*/-->
    <!--/*@thymesVar id="milestone" type="org.innovateuk.ifs.application.forms.sections.procurement.milestones.form.ProcurementMilestoneForm"*/-->
    <th:block th:with="path=|milestones[${id}]|">
        <!--/*@thymesVar id="path" type="java.lang.String"*/-->
        <div class="govuk-accordion__section-header">
            <h3 class="govuk-accordion__section-heading">
                    <span class="govuk-accordion__section-button" th:id="|accordion-finances-heading-${id}|"
                          th:text="${milestone.description}">
                    </span>
                <span class="finance-total" th:attr="data-mirror=|[id='${path}.payment']|"></span>
                <span class="finance-total"
                      th:text="${milestone.getPercentageOfCost(totalCosts)}"></span>
                <!--/*<div th:if="${#ifsUtil.hasErrorsStartingWith('form', 'labour')}"
                     class="section-status section-incomplete icon-
                     only error-marker"></div>*/-->
            </h3>

        </div>
        <div  th:id="|accordion-finances-content-${id}|" class="govuk-accordion__section-content"
              th:attr="aria-labelledby=|accordion-finances-heading-${id}|">

            <div class="width-15-percent">
                <p class="govuk-body" th:text="${milestone.month}"></p>
            </div>
            <div class="width-70-percent">
                <p class="govuk-body" th:text="${milestone.description}"></p>
                <p class="govuk-body" th:text="${milestone.deliverable}"></p>
                <p class="govuk-body" th:text="${milestone.successCriteria}"></p>
                <p class="govuk-body" th:text="${milestone.taskOrActivity}"></p>
            </div>
            <div class="width-15-percent">
                <div class="govuk-form-group">
                    <label th:for="__${path}__.payment" class="govuk-label govuk-label--s">
                        Payment requested (Â£)
                    </label>
                    <th:block
                        th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=__${path}__.payment)"/>
                    <input th:id="__${path}__.payment"
                           th:field="*{__${path}__.payment}"
                           th:errorclass="govuk-input--error"
                           type="number"
                           class="govuk-input"
                           placeholder="0"
                           min="1"
                           max="999999999"
                           step="1"
                           required="required"
                    />
                </div>
            </div>
        </div>
    </th:block>
</th:block>
</html>
