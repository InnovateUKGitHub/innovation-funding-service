<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!-- ==============General Readonly Label and paragraph pairs ============= -->

    <div th:fragment="label-and-paragraph (label, text, id, bold)">
        <div class="form-group">
            <h2 th:text="${label}" class="heading-medium no-margin"></h2>
            <p th:id="${id}" th:text="${text}"></p>
        </div>
    </div>

    <div th:fragment="question-label-and-paragraph (question, responses, bold)">

        <div th:include="question-type/types-readonly :: label-and-paragraph (label=${question.getName()}, text=${responses.get(question.getId()) != null ? responses.get(question.getId()).getValue() : ''}, id=${question.getId()}, bold=true)" th:remove="tag"></div>

        <div th:with="response=${responses.get(questionId)}, questionId=${question.getId()}" th:remove="tag">

            <div th:if="${question.needingAssessorScore}" th:remove="tag">
                <h2>Question Score</h2>

                <select th:name="'assessor-question-score-' + ${question.getId()}" th:id="'assessor-question-score-' + ${question.getId()}">
                    <option value=""></option>
                    <option th:each="i : ${#numbers.sequence(0, 10)}" th:value="${i}" th:text="${i}">1</option>
                </select> / 10
            </div>

            <div th:if="${not #strings.isEmpty(question.assessorConfirmationQuestion)}" th:remove="tag">

                <h2 th:text="${question.assessorConfirmationQuestion}">A Confirmation Question</h2>

                <select th:name="'assessor-question-confirmation-' + ${questionId}" th:id="'assessor-question-confirmation-' + ${questionId}">
                    <option value=""></option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>

            <div th:if="${question.needingAssessorFeedback}" th:remove="tag">
                <h2>Your feedback</h2>

                <span class="form-hint">Please justify your score by writing two or three sentences which will be returned to the applicant as feedback</span>

                <div th:include="question-type/form-elements :: form-textarea (name=${'assessor-question-feedback-' + questionId}, id=${'assessor-question-feedback-' + questionId}, value='', wordCount=5000, readonly=false)" th:with="textareaRows=3, textareaCols=60" th:remove="tag"></div>
            </div>

        </div>

    </div>

    <!-- ===========================Form: Textinput =========================== -->

    <div th:fragment="textinput" class="form-group">
        <div th:include="question-type/types-readonly :: question-label-and-paragraph (question=${question}, responses=${responses}, bold=true)" th:remove="tag"></div>
    </div>

    <!-- =========================== Form: Textarea =========================== -->
    <!-- === (defaults to the wrapped textarea with wordcount and statusses)=== -->

    <div th:fragment="textarea" class="form-group">
        <div th:include="question-type/types-readonly :: question-label-and-paragraph (question=${question}, responses=${responses}, bold=true)" th:remove="tag"></div>
    </div>


    <!-- ===========================Form: Date input =========================== -->

    <div th:fragment="date" class="form-group">
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${question.getId()}, bold=true)" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-dateinput (id=${question.getId()}, day='', month='', year='')" th:remove="tag" />
    </div>

    <!-- ===========================Form: Fileupload =========================== -->
    <div th:fragment="fileupload" class="form-group">
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
            <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" />
            <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${question.getId()}, bold=true)" th:remove="tag" />
            <input type="file"/>
    </div>

    <!-- ===========================Form: application_details =========================== -->

    <div th:fragment="application_details" th:remove="tag">

        <div th:include="question-type/types-readonly :: label-and-paragraph (label='Project title', text=${currentApplication.getName()}, id='application_details-title', bold=true)" th:remove="tag"></div>

        <!-- <div th:include="question-type/form-elements :: form-label (name='Project timescalesTEST', id='details-application-timescale',bold=true)" th:remove="tag" /> -->

        <h2 th:text="${'Project timescales'}" class="heading-medium"></h2>

        <dl class="dl-pad">
            <dt th:text="${'Project start date'}">Title</dt>
            <dd th:text="${#temporals.format(currentApplication.getStartDate(), 'd/M/yyyy')}">Date</dd>

            <dt th:text="${'Duration'}">Duration</dt>
            <dd th:text="${currentApplication.getDurationInMonths() + ' months'}">Months</dd>
        </dl>

        <!-- <div th:include="question-type/types-readonly :: label-and-paragraph (label='Project start date', id='application_details-startdate', text=${#temporals.format(currentApplication.getStartDate(), 'd/M/yyyy')}, bold=false)" th:remove="tag" /><br/>
        <div th:include="question-type/types-readonly :: label-and-paragraph (label='Duration', id='application_details-duration', text=${currentApplication.getDurationInMonths() + ' months'}, bold=false)" th:remove="tag" /><br/> -->
    
        <div class="form-group">
            <h2 th:text="${'Lead organisation'}" class="heading-medium"></h2>
            <div th:text="${leadOrganisation.getName()}"></div>
        </div>

        <div class="form-group">
            <h2 th:text="${'Partners'}" class="heading-medium"></h2>
            <ul class="list-bullet">
                <li th:each="organisation : ${applicationOrganisations}" th:unless="${organisation.equals(leadOrganisation)}">
                    <span th:text="${organisation.getName()}"></span>
                </li>
            </ul>
        </div>
    </div>

    <!-- ===========================Form: empty / no question =========================== -->
    <div th:fragment="empty">
        <div th:utext="${question.getDescription()}"></div>
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" ></div>
    </div>

    <!-- ===========================Form: finance =========================== -->


    <div th:fragment="finance">
        <div th:replace="question-type/types :: empty" th:with="$question=(${question})" th:remove="tag" />
        <div class="grid-row">
            <div class="column-half">
                <p>Enter the detailed breakdown of your organisation's project costs.</p>
                <a class="button button-large button-block" th:href="@{/application-form/{id}/section/7/(id=${currentApplication.getId()})}" >Your project costs</a>
                <p class="form-hint icon-info-small-blue">Only you can see this level of detail</p>
            </div>
            <div class="column-half">
                <p>View the summary finances of every partner in your project consortium</p>
                <a class="button button-large button-block" th:href="@{/application-form/{id}/section/8/(id=${currentApplication.getId()})}">Project financial summary</a>
                <p class="form-hint icon-info-small-blue">All partners can view the financial overview</p>
            </div>
        </div>
    </div>

    <!-- ===========================Form: your_finance =========================== -->
    <div th:fragment="your_finance" th:remove="tag">
        <div class="collapsible">
            <div th:each="subSection : ${currentSection.getChildSections()}" th:if="${currentSection.getChildSections()}!=null"  th:remove="tag" >
                <h2  th:attr="data-subsection-header=${subSection.id}" th:text="${subSection.getName()}" th:class="((${completedSections.contains(subSection.id)}) ? 'section-status-finance complete':'')"></h2>
                <div th:remove="tag" th:each="question : ${subSection.getQuestions()}">
                    <div th:replace="question-type/types :: ${question.getQuestionType().getTitle()} (complete=${!readonly ? ${(question.isMarkAsCompletedEnabled() and question.isMarkedAsComplete(userOrganisation.id))} ? 'complete' : '')} : ''"
                         th:with="$question=(${question}), $responses=(${responses}), $currentApplication=(${currentApplication}), $currentSection=(${subSection})" />
                </div>
            </div>
        </div>
        <hr/>
        <div class="grid-row total-cost">
            <div class="column-half">
                <p class="heading-medium">Total project costs</p>
            </div>
            <div class="column-half alignright">
                <input type="text" readOnly="readonly" class="heading-medium width-medium"
                   data-calculation-fields="[id*=total]"
                   data-calculation-operations="+"
                   th:value="'£ ' + ${#numbers.formatDecimal(organisationFinanceTotal, 0, 'COMMA', 0, 'POINT')}"/>
            </div>
        </div>
        <p>These costs should be justified in the <a href="#">Funding section</a> of the application form.</p>
    </div>

    <!-- ===========================Form: labour =========================== -->
    <div th:fragment="labour (complete)">
        <div th:attr="finance-subsection-table-container=${question.getId()}"
             th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))},type=${question.questionType.title}">
            <div class="form-group" th:if="${costCategory!=null}">
                <table>
                    <tbody>
                    <tr>
                        <th class="width-large">
                            <div th:include="question-type/form-elements :: form-label (name='Working Days per Year', id='working_days', bold=false)" th:remove="tag" />
                        </th>
                        <td>
                            <input type="number"
                                   th:class="${'width-small'}"
                                   th:id="${'cost-labour-'+costCategory.workingDaysPerYearCostItem.id+'-workingDays'}"
                                   th:name="${type + '-workingDays-' + costCategory.workingDaysPerYearCostItem.id}"
                                   th:value="${costCategory.workingDaysPerYear}"
                            />
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="form-group">
                    <table id="labour-costs-table">
                        <thead>
                        <tr>
                            <th class="width-medium">Role within project</th>
                            <th class="numeric">Gross Annual Salary</th>
                            <th class="numeric">Rate (£/day)</th>
                            <th class="numeric width-medium">Days to be spent by all staff at this grade</th>
                        </tr>
                        </thead>
                        <tbody>
                        <div th:each="labourCost : ${costCategory.costs}" th:remove="tag">
                            <tr th:attr="data-cost-row=${labourCost.id}">
                                <td>
                                    <input type="text" th:name="${type +'-role-' + labourCost.id}"  th:id="${'cost-labour-'+labourCost.id+'-labourRole'}" th:value="${labourCost.getRole()}"/>
                                </td>
                                <td class="numeric">
                                    <input type="number"
                                           th:name="${type +'-grossAnnualSalary-' + labourCost.id}"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourGrossSalary'}"
                                           th:value="${#numbers.formatDecimal(labourCost.grossAnnualSalary,0,0)}" />
                                </td>
                                <td class="numeric">
                                    <input type="text"
                                           th:attr="data-calculation-fields=${'#cost-labour-'+labourCost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem.id+'-workingDays'},data-calculation-rawValue=${labourCost.getRate(costCategory.workingDaysPerYear)}"
                                           data-calculation-operations="/"
                                           readonly="readonly"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourRate'}"
                                           th:name="${type + '-labourRate-' + labourCost.id}"
                                           th:value="'£ ' + ${#numbers.formatDecimal(labourCost.getRate(costCategory.workingDaysPerYear),0,0)}" />
                                </td>
                                <td class="numeric">
                                    <input type="number" class="width-small"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourDays'}"
                                           th:name="${type + '-labourDays-' + labourCost.id}"
                                           th:value="${labourCost.labourDays}" />
                                </td>
                            </tr>
                            <tr th:attr="data-cost-row=${labourCost.id}">
                                <td colspan="4" class="numeric">
                                    Total costs
                                    <input type="text"
                                       th:attr="data-calculation-fields=${'#cost-labour-'+labourCost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem.id+'-workingDays,#cost-labour-'+labourCost.id+'-labourDays'},data-calculation-rawvalue=${labourCost.getTotal(costCategory.workingDaysPerYear)}"
                                       data-calculation-operations="/,*"
                                       th:name="${type +'-total-' + labourCost.id}"
                                       readonly="readonly"
                                       th:class="${'width-small-medium'}"
                                       th:id="${'cost-labour-'+labourCost.id+'-labourTotalCost'}"
                                       th:value="'£ ' + ${#numbers.formatDecimal(labourCost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}"/>
                                        <a class="delete-row control" th:attr="data-cost-row=${labourCost.id}" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{labourCostId}(labourCostId=${labourCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                                </td>
                            </tr>
                        </div>
                        </tbody>
                    </table>

                    <p class="alignright">
                        <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}?expand=true&amp;panel=collapsible-0(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0-1">Add another role</a>
                    </p>
                </div>

                <div class="form-group form-group--align-right alignright">
                    <label>
                        Total labour costs
                        <input class="form-control form-control-1-4 alignright"
                               data-calculation-fields="[id*=labourTotalCost]"
                               data-calculation-operations="+"
                               th:attr="data-binding-input=${'subsection-total-' + subSection.id},data-calculation-rawvalue=${costCategory.getTotal()}"
                               readonly="" type="text" id="cost-labour-total-field"
                               th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
                        <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                            <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                    th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                            </span>
                        </span>
                    </label>
                </div>
            </div>
            <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
        </div>
    </div>

    <!-- ===========================Form: overheads =========================== -->
    <div th:fragment="overheads">
        <p th:text="${question.getDescription()}"></p>
        <div th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}">
            <div class="grid-row">
                <strong class="column-half">
                    20% of labour costs
                </strong>
                <strong class="column-half">
                    Calculated rate: <span id="calculated-rate" data-calculation-field="[data-calculation-input=overhead-calculated]"
                                            data-calculation-operations=""></span>
                </strong>
            </div>
            <br/>
            <fieldset>
                <legend>Do you choose to accept this rate?</legend>
                <ul id="id_overheads-acceptRate">
                    <li>
                        <label for="id_overheads-acceptRate_0">
                            <input class="block-label" id="id_overheads-acceptRate_0" type="radio" name="overheads-acceptRate" value="yes"/>
                            <span> </span><span>20% of labour costs</span>
                        </label>
                    </li>
                    <li>
                        <label for="id_overheads-acceptRate_1">
                            <input class="block-label" id="id_overheads-acceptRate_1" type="radio" name="overheads-acceptRate" value="no"/>
                            <span> </span>
                            <span >Bespoke rate (I confirm that I will justify this rate if Innovate UK funds my project)</span>
                        </label>
                    </li>
                </ul>
            </fieldset>
            <br/>
            <div id="custom-rate" th:if="${costCategory.costs!=null and costCategory.costs.size() > 0}" th:with="overheadCosts=${costCategory.costs[0]}">
                <div class="form-group">
                    <label class="form-label" for="id_overheads-customRate">Overhead rate</label>
                    <input type="number"
                           name="overheads-customRate"
                           data-calculation-input="overhead-rate"
                           class="form-control form-control-1-8"
                           id="id_overheads-customRate"
                           th:value="'£ ' + ${#numbers.formatDecimal(overheadCosts.getCustomRate(),0,0)}" /> %
                </div>

                <div class="form-group">
                    <label class="form-label" for="id_overheads-calculatedRate">Overhead calculation</label>
                    <input type="number" name="overheads-calculatedRate" class="form-control" readonly="" id="id_overheads-calculatedRate"
                           data-calculation-field="[data-calculation-input=total-labour],100,[data-calculation-input=overhead-rate]"
                           data-calculation-operations="/,*"
                           data-calculation-input="overhead-calculated"
                            th:value="'£ ' + ${#numbers.formatDecimal(overheadCosts.total, 0, 'COMMA', 0, 'POINT')}"/>
                </div>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total overhead costs
                    <input type="number" name="overheads-totalCosts" class="form-control form-control-1-4 alignright" readonly="" id="id_overheads-totalCosts"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           data-calculation-field="[data-calculation-input=overhead-calculated]"
                           data-calculation-operations="+"
                           th:value="'£ 0'"
                           />
                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                              th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>

        </div>
    </div>

    <!-- ===========================Form: materials =========================== -->
    <div th:fragment="materials">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="finance-subsection-table-container=${question.getId()}" th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}">
            <div class="form-group">
                <table id="material-costs-table">
                    <thead>
                    <tr>
                        <th>Item</th>
                        <th class="numeric">Quantity</th>
                        <th class="numeric">Cost Per Item</th>
                        <th class="numeric">Total</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="materialCost : ${costCategory.costs}" th:with="type=${question.questionType.title}">
                        <tr th:attr="data-cost-row=${materialCost.id}">
                            <td>
                                <input type="text" th:name="${type +'-item-' + materialCost.id}"  th:id="${'cost-materials-'+materialCost.id+'-item'}" th:value="${materialCost.getItem()}"/>
                            </td>
                            <td>
                                <input type="number" th:name="${type +'-quantity-' + materialCost.id}"
                                       th:id="${'cost-materials-'+materialCost.id+'-quantity'}" th:value="${materialCost.getQuantity()}"/>
                            </td>
                            <td>
                                <input type="number" th:name="${type +'-cost-' + materialCost.id}"
                                       th:id="${'cost-materials-'+materialCost.id+'-cost'}"
                                       th:value="${#numbers.formatDecimal(materialCost.getCost(),0,0)}"
                                />
                            </td>
                            <td>
                                <input type="text" class="alignright" th:name="${type +'-total-' + materialCost.id}"
                                       th:attr="data-calculation-fields='#'+${'cost-materials-'+materialCost.id+'-quantity'}+',#'+${'cost-materials-'+materialCost.id+'-cost'},data-calculation-rawvalue=${materialCost.total}"
                                       th:id="${'cost-materials-'+materialCost.id+'-materialTotal'}"
                                       data-calculation-operations="*"
                                       readonly=""
                                       th:value="'£ ' + ${#numbers.formatDecimal(materialCost.total, 0, 0)}"/>
                            </td>
                            <td class="alignright remove"> 
                                <a class="delete-row" th:attr="data-cost-row=${materialCost.id}" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{materialCost}(materialCost=${materialCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another materials cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total materials costs
                    <input class="form-control alignright form-control-1-4 calculation-total-materials-row-js calculation-result-js"
                           readonly="" type="text" id="material-costs-total-field"
                           data-calculation-fields="[id*=materialTotal]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: capital usage =========================== -->
    <div th:fragment="capital_usage">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="finance-subsection-table-container=${question.getId()}" th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}" >
            <div th:each="capitalUsage : ${costCategory.costs}">
                <div class="form-row" th:attr="data-cost-row=${capitalUsage.id}">
                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageItem">Item description</label>
                        <input type="textarea" id="" class="form-control form-finances-capital-usage-item"
                                  name="capitalusage-0-capitalUsageItem" cols="40" rows="3" th:value="${capitalUsage.getDescription()}" />
                        <a class="delete-row" th:attr="data-cost-row=${capitalUsage.id}" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{capitalUsage}(capitalUsage=${capitalUsage.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>


                    </div>

                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageNewOrExisting" class="form-label">New or existing item</label>
                        <select id="id_capitalusage-0-capitalUsageNewOrExisting" class="form-control form-finances-capital-usage-existing" name="capitalusage-0-capitalUsageNewOrExisting">
                            <option selected="${capitalUsage.getExisting() == ''}" value=""></option>
                            <option value="New" selected="${capitalUsage.getExisting() == 'New'}">New</option>
                            <option value="Existing" selected="${capitalUsage.getExisting() == 'Existing'}">Existing</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageDeprecationPeriod" class="form-label">Deprecation period (months)</label>
                        <input type="number" id="id_capitalusage-0-capitalUsageDeprecationPeriod" class="form-control form-finances-capital-usage-depreciation" name="capitalusage-0-capitalUsageDeprecationPeriod"
                                th:value="${capitalUsage.deprecation}"/>
                    </div>

                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageNPV" class="form-label">Net Present Value at the start of your project start or the price you bought it for (£)</label>
                        <input type="number" value="10000" id="id_capitalusage-0-capitalUsageNPV" class="form-control form-finances-capital-usage-npv" name="capitalusage-0-capitalUsageNPV"
                               th:value="${#numbers.formatDecimal(capitalUsage.npv,0,0)}"/>
                    </div>

                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageResidualValue" class="form-label">Residual value at end of project (£)</label>
                        <input type="number" value="200" id="id_capitalusage-0-capitalUsageResidualValue" class="form-control form-finances-capital-usage-residual-value" name="capitalusage-0-capitalUsageResidualValue"
                               th:value="${#numbers.formatDecimal(capitalUsage.residualValue,0,0)}"/>
                    </div>

                    <div class="form-group">
                        <label for="id_capitalusage-0-capitalUsageUtilisation" class="form-label">Utilisation (%)</label>
                        <input type="number" value="20" id="id_capitalusage-0-capitalUsageUtilisation" class="form-control form-finances-capital-usage-utilisation" name="capitalusage-0-capitalUsageUtilisation"
                               th:value="${capitalUsage.utilisation}"/>
                    </div>
                </div>
            </div>
            <p class="alignright">
                <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another asset</a>
            </p>
            <hr/>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total capital usage costs
                    <input class="form-control form-control-1-4 alignright" readonly="" type="text" id="capital-usage-costs-total-field"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: subcontracting cost =========================== -->
    <div th:fragment="subcontracting_costs">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="finance-subsection-table-container=${question.getId()}" th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}">
            <div class="form-row">
                <div th:each="subContractingCost : ${costCategory.costs}" th:with="type=${question.questionType.title}">
                        <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                            <label class="form-label" th:for="${'cost-subcontracting-'+subContractingCost.id+'-companyName'}">Subcontractor name</label>
                            <input type="text" th:name="${type +'-name-' + subContractingCost.id}" class="form-control form-finances-subcontracting-company" th:id="${'cost-subcontracting-'+subContractingCost.id+'-companyName'}" th:value="${subContractingCost.name}" />
                            <a class="delete-row" th:attr="data-cost-row=${subContractingCost.id}" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{subContractingCost}(subContractingCost=${subContractingCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                        </div>

                        <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                            <label class="form-label" th:for="${'cost-subcontracting-'+subContractingCost.id+'-country'}">Country where the subcontractor will work</label>
                            <input type="text" th:name="${type +'-country-' + subContractingCost.id}" class="form-control form-finances-subcontracting-country"
                                   th:id="${'cost-subcontracting-'+subContractingCost.id+'-country'}" th:value="${subContractingCost.country}" />
                        </div>

                        <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                            <label class="form-label" th:for="${'cost-subcontracting-'+subContractingCost.id+'-role'}">Role of the subcontractor in the project and description of the work they’ll do</label>
                            <!--<textarea rows="3" cols="40" name="subcontracting-0-subcontractingRole" class="form-control form-finances-subcontracting-role" id="" th:inline="text">[[]]</textarea>-->
                            <div th:include="question-type/form-elements :: form-textarea (
		 					id=${'cost-subcontracting-'+subContractingCost.id+'-role'},
		 					value=${subContractingCost.role},
		 					readonly=false,
		 					name=${type + '-role-' + subContractingCost.id}
		 					)" th:remove="tag" />

                        </div>

                        <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                            <label class="form-label" for="${'cost-subcontracting-'+subContractingCost.id+'-cost'}">Cost</label>
                            <input type="number"
                                   th:name="${type +'-cost-' + subContractingCost.id}"
                                   class="form-control form-finances-subcontracting-cost"
                                   th:id="${'cost-subcontracting-'+subContractingCost.id+'-subcontractingCost'}"
                                   data-calculation-input="subcontracting-cost-row"
                                   th:value="${#numbers.formatDecimal(subContractingCost.cost,0,0)}" />
                        </div>
                </div>
            </div>
            <p class="alignright">
                <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another subcontractor</a>
            </p>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total subcontracting costs
                    <input class="form-control form-control-1-4 alignright"
                           readonly=""
                           type="text"
                           id="cost-subcontracting-total"
                           data-calculation-fields="[id*=subcontractingCost]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>
    <!-- ===========================Form: travel cost =========================== -->
    <div th:fragment="travel">
        <p th:text="${question.description}"></p>
        <div th:attr="finance-subsection-table-container=${question.getId()}" th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}">
            <div class="form-group">
                <table id="travel-costs-table">
                    <thead>
                    <tr>
                        <th>Purpose of journey or description of subsistence cost</th>
                        <th class="numeric">Number of times</th>
                        <th class="numeric">Cost each (£)</th>
                        <th class="numeric">Total (£)</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="travelCost : ${costCategory.costs}" >
                        <tr th:attr="data-cost-row=${travelCost.id}">
                            <td>
                                <input type="text" name="travel-0-travelPurpose" class="form-control form-control-1-1 form-finances-travel-purpose" id="id_travel-0-travelPurpose" th:value="${travelCost.getItem()}" />
                            </td>
                            <td class="numeric">
                                <input type="number" name="travel-0-travelNumTimes" class="form-control form-control-1-1 form-finances-travel-number" id="id_travel-0-travelNumTimes" th:value="${travelCost.getQuantity()}" />
                            </td>
                            <td class="numeric">
                                <input type="number" name="travel-0-travelCostEach" class="form-control form-control-1-1 form-finances-travel-cost" id="id_travel-0-travelCostEach" th:value="${#numbers.formatDecimal(travelCost.getCostPerItem(),0,0)}" />
                            </td>
                            <td class="numeric">
                                <input type="number" name="travel-0-travelCostTotal" class="form-control form-control-1-1 form-finances-travel-total" readonly="" id="id_travel-0-travelCostTotal" th:value="${#numbers.formatDecimal(travelCost.getTotal(),0,0)}" />
                            </td>
                            <td>
                                <a class="delete-row" th:attr="data-cost-row=${travelCost.id}" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{travelCost}(travelCost=${travelCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another travel cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total travel &amp; subsistence costs
                    <input class="form-control form-control-1-4 alignright" readonly="" type="text" id="travel-costs-total-field"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: other cost =========================== -->
    <div th:fragment="other_costs">
        <p th:text="${question.description}"></p>
        <div th:attr="finance-subsection-table-container=${question.getId()}" th:with="costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}">
            <div class="form-group">
                <table id="other-costs-table">
                    <thead>
                    <tr>
                        <th>Description and justification of the cost</th>
                        <th class="numeric">Estimated cost (£)</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="otherCost : ${costCategory.costs}" >
                        <tr th:attr="data-cost-row=${otherCost.id}">
                            <td>
                                <div th:include="question-type/form-elements :: form-textarea-simple(id='other-cost-'+${otherCost.getId()}, name='other-0-otherDescription['+${otherCost.getId()}+']', value=${otherCost.getDescription()})" th:remove="tag" />
                            </td>
                            <td class="numeric">
                                <input type="number" name="other-0-otherCost" class="form-control form-control-1-1 form-finances-other-cost" id="id_other-0-otherCost" th:value="${#numbers.formatDecimal(otherCost.getCost(),0,0)}"/>
                            </td>
                            <td>
                                <a class="delete-row" th:href="@{/application-form/deletecost/{applicationId}/{sectionId}/{otherCost}(otherCost=${otherCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application-form/addcost/{applicationId}/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total other costs
                    <input class="form-control form-control-1-4 alignright" readonly="" type="text" id="other-costs-total-field"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"/>

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>

                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div> 
    </div>

    <!-- ===========================Form: Other funding=========================== -->
    <div th:fragment="other_funding">
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${question.getId()}, bold=true)" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" />
        <select id="otherCostsShowHideToggle" class="form-control form-control-1-8">
            <option>No</option>
            <option th:if="${userIsLeadApplicant}" selected="selected">Yes</option>
            <option th:unless="${userIsLeadApplicant}">Yes</option>
        </select>
        <div id="otherCostsForm" class="form-group">
            <table id="other-funding">
                <thead>
                <tr>
                    <th scope="col">Source of Funding</th>
                    <th scope="col">Date Applied for</th>
                    <th scope="col" class="numeric">Amount Sought (£)</th>
                    <th scope="col">Successful?</th>
                    <th scope="col" class="numeric">Amount Secured or Still Sought</th>
                    <th scope="col">Date of Decision</th>
                    <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <input type="text" value="Public Sector Grant" />
                    </td>
                    <td>
                        <input type="text" value="10-06-2015" />
                    </td>
                    <td class="numeric">
                        <input type="text" value="10,000" />
                    </td>
                    <td>
                        <input type="text" value="Yes" />
                    </td>
                    <td class="numeric">
                        <input type="text" value="10,000" />
                    </td>
                    <td>
                        <input type="text" value="06-10-2015" />
                    </td>
                    <td>
                        <a href="#">Remove</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <p style="text-align: right;">
                <a class="add-another-row" href="#" data-clone-rows="0">Add another funding source</a>
            </p>
        </div>
    </div>
    <!-- ===========================Form: financial summary (question type) =========================== -->
    <div th:fragment="financial_summary" th:if="${financeTotalPerType}">
        <h2>Project cost breakdown</h2>
        <div th:include="question-type/types :: financial_summary_table" th:remove="tag"/>
            <p><a href="">View table in full screen (opens new window)</a></p>
    </div>
    <!-- ===========================Form: financial summary/breakdown table =========================== -->
    <div th:fragment="financial_summary_table" th:if="${financeTotalPerType}">
        <div class="form-group">
            <div style="overflow: auto;">
                <table>
                    <thead>
                    <tr>
                        <th scope="col">&nbsp;</th>
                        <th scope="col" class="numeric">Total</th>
                        <th scope="col" class="numeric" th:each="applicationOrganisation : ${applicationOrganisations}">
                            <div th:text="${applicationOrganisation.name}"></div>
                            <div th:if="${applicationOrganisation.equals(leadOrganisation)}"><small>Lead organisation</small></div>
                            <div th:unless="${applicationOrganisation.equals(leadOrganisation)}"><small>Partner</small></div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="financeSubSection : ${financeSection.ChildSections}" th:with="question=${financeSubSection.questions.get(0)}">
                        <th th:text="${financeSubSection.name}"></th>
                        <td class="numeric" th:each="financeTotal: ${financeTotalPerType.get(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}"
                            th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}">
                        </td>
                        <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                            <td class="numeric" th:each="organisationFinance : ${organisationFinances}"
                                th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                                th:with="category = ${organisationFinance.getCostCategory(T(com.worth.ifs.application.finance.CostType).fromString(question.questionType.title))}"
                                th:text="'£'+${#numbers.formatDecimal(category.total, 0, 'COMMA', 0, 'POINT')}">
                            </td>
                        </div>
                    </tr>
                    <tr>
                        <th>Total</th>
                        <td class="numeric" style="font-weight: 700;" th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}">
                        </td>
                        <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                            <td class="numeric" th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                                th:text="'£'+${#numbers.formatDecimal(organisationFinance.total, 0, 'COMMA', 0, 'POINT')}"></td>
                        </div>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ===========================Form: funding breakdown =========================== -->
    <div th:fragment="application_finances_summary" th:if="${financeTotalPerType}">

        <p>This is the overview of the finances provided by all partners in this project.</p>
        <p>To make changes to your organisations' finances, go back to the <a th:href='${"/application-form/"+currentApplication.id+"/section/7/"}'>your finances</a> section.</p>
        <div class="form-group">

            <table>
                <thead>
                <tr>
                    <th scope="col">&nbsp;</th>
                    <th scope="col" class="numeric">Total</th>
                    <th scope="col" class="numeric" th:each="applicationOrganisation : ${applicationOrganisations}">
                        <div th:text="${applicationOrganisation.name}"></div>
                        <div th:if="${applicationOrganisation.equals(leadOrganisation)}"><small>Lead organisation</small></div>
                        <div th:unless="${applicationOrganisation.equals(leadOrganisation)}"><small>Partner</small></div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>Total costs</th>
                    <td class="numeric">£208,000</td>
                    <td class="numeric">-</td>
                    <td class="numeric">£5,000</td>
                    <td class="numeric">£5,000</td>
                </tr>
                <tr>
                    <th>% Grant</th>
                    <td class="numeric">-</td>
                    <td class="numeric">40%</td>
                    <td class="numeric">20%</td>
                    <td class="numeric">-</td>
                </tr>
                <tr>
                    <th>Funding sought</th>
                    <td class="numeric">£105,000</td>
                    <td class="numeric">-</td>
                    <td class="numeric">£25,000</td>
                    <td class="numeric">£5,000</td>
                </tr>
                <tr>
                    <th>Other public sector funding</th>
                    <td class="numeric">£10,000</td>
                    <td class="numeric">£10,000</td>
                    <td class="numeric">-</td>
                    <td class="numeric">-</td>
                </tr>
                <tr>
                    <th>Contribution to project</th>
                    <td class="numeric">£93,000</td>
                    <td class="numeric">-</td>
                    <td class="numeric">£32,000</td>
                    <td class="numeric">£11,000</td>
                </tr>
                </tbody>
            </table>
        </div>
        <h2>Funding breakdown</h2>
        <div th:include="question-type/types :: financial_summary_table" th:remove="tag"/>

    </div>
</html>