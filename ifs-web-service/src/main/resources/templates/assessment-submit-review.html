<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle=${model.application.name}" th:remove="tag" />
</head>

<body class="app-dashboard">

<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />



<main id="content">
    <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
    <div th:include="fragments/layout :: header-sub-generic" th:with="daysPercentage = ${model.competition.getAssessmentDaysLeftPercentage()},
            daysLeft=${model.competition.getAssessmentDaysLeft()},
            title = ${model.application.name},
            deadlineText= 'Days left to accept'" th:remove="tag" />

    <div>
        <br/>
        <small><a th:href="@{/assessor/competitions/{cid}/applications/{aid}(cid=${model.competition.id},aid=${model.application.id})}">&lt; Back to application</a></small>
    </div>


    <div class="grid-row">
        <header class="page-header group no-pad">
            <h1 class="heading-xlarge">Assessment summary</h1>
        </header>

        <div class="collapsible">

            <div th:each="section:${model.assessmentSummarySections}" th:remove="tag">

                <h2 th:attr="data-subsection-header=${section.id}" class="section-status-finance complete">
                    <span th:text="${section.name}">Scope (Gateway question)</span>
                </h2>

                <span th:attr="data-subsection-id=${section.id}" class="section-status complete place-in-header"><span th:if="${section.assessmentComplete}">Complete</span></span>

                <div class="grid-row" th:each="question:${section.questionsRequiringFeedback}">
                    <div class="column-three-quarters">
                        <h4 class="heading-medium" th:text="${question.name}">How does this application align with the specific competition scope?</h4>
                        <p th:text="${question.feedback.feedbackText}" th:if="${question.feedback != null}">
                            Pre -Industry - The application is considered in scope as it both investigate a better user interface and also improved sensors
                        </p>
                        <p th:if="${question.feedback == null}">
                            No feedback has yet been provided.
                        </p>
                        <p><a th:href="@{/assessor/competitions/{competitionId}/applications/{applicationId}/section/{sectionId}(competitionId=${model.competition.id},applicationId=${model.application.id},sectionId=${section.id})} + ${'#question-' + question.id}">Return to this question in the application</a></p>
                    </div>
                    <div class="column-quarter">
                        <p class="assessor-score">
                            <span class="score" th:text="${question.feedback.feedbackValue}" th:if="${question.feedback != null}">Yes</span>
                            <span class="score" th:if="${question.feedback == null}"></span>
                        </p>
                    </div>
                </div>

            </div>

        </div>

        <hr style="border-top: 1px solid #ccc;"/>
        <h3 class="heading-large no-margin">Overall Scores</h3>
        <br/>
        <table>
            <tbody>
            <tr>
                <th>Question</th>
                <td th:each="question:${model.scorableQuestions}" th:text="${question.questionNumber}">Q1</td>
            </tr>
            <tr>
                <th>Score</th>
                <td th:each="question:${model.scorableQuestions}" th:with="feedback=${model.getFeedbackForQuestion(question)}" th:text="${feedback?.assessmentValue}">Q1</td>
            </tr>
            </tbody>
        </table>
        <br/>
        <p style="text-align: right; font-weight: 700;">
            Total: <span th:text="${model.totalScore}" th:remove="tag">60</span>/<span th:text="${model.possibleScore}" th:remove="tag">100</span><br/>
            <span th:text="${model.scorePercentage}" th:remove="tag">60</span>%
        </p>

        <hr style="border-top: 1px solid #ccc;"/>

        <br/>

    <form id="submission_questions" th:action="@{/assessor/competitions/{cid}/applications/{aid}/complete(cid=${model.competition.id},aid=${model.application.id})}" method="POST">

        <input type="hidden" name="overall-score" th:value="${model.totalScore}" />

        <h4 class="heading-medium">Do you believe that this application is suitable for funding?</h4>
        <div class="form-group">
            <select name="is-suitable-for-funding" class="form-control" id="suitable-for-funding" >

                <option value="" th:selected="${model.assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).EMPTY }"></option>
                <option value="yes" th:selected="${model.assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).YES }">Yes</option>
                <option value="no" th:selected="${model.assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).NO }">No</option>
            </select>
        </div>

        <!-- .form-group -->

        <div class="form-group word-count" id="recommendation-feedback-group">
            <h4 class="heading-medium">Your feedback</h4>
            <p class="form-hint">Please justify your decision by writing two or three sentences which will be returned to the applicant as feedback.</p>
            <span class="error-message" id="feedback-empty-error">

            </span>
            <div class="form-control-wrap">
                <textarea rows="7" cols="70" name="suitable-for-funding-feedback" class="form-control form-control-large form-control-1-1 form-control-with-character-counter count-area"
                          id="not-suitable-feedback" th:text="${model.assessment.getSuitableFeedback()}"
                          th:attrappend="data-max_words=350" ></textarea>
            </div>

            <div class="form-group_footer">
                <div class="grid-row">
                    <div class="column-half column-half--first">
                        &nbsp;
                    </div>
                    <div class="column-half column-half--second">
                        <div th:include="question-type/form-elements :: form-word-count (maxWords=350, currentWordsLeft=350)" th:remove="tag"/>
                    </div>
                </div>
            </div><!-- .form-group_footer -->
        </div><!-- .form-group -->

        <div class="form-group word-count">
            <h4 class="heading-medium">Do you have any comments about this application that you would like to share with Innovate UK? (Optional)</h4>
            <div class="form-control-wrap">
                <textarea rows="7" cols="70" name="comments-to-share" class="form-control form-control-large form-control-1-1 form-control-with-character-counter count-area"
                          id="summary-comments" th:text="${model.assessment.getComments()}"
                          th:attrappend="data-max_words=350"></textarea>
            </div>

            <div class="form-group_footer">
                <div class="grid-row">
                    <div class="column-half column-half--first">
                    &nbsp;
                    </div>
                    <div class="column-half column-half--second">
                        <div th:include="question-type/form-elements :: form-word-count (maxWords=350, currentWordsLeft=350)" th:remove="tag"/>
                    </div>
                </div>
            </div><!-- .form-group_footer -->
        </div><!-- .form-group -->


        <p class="icon-info">
            You'll still be able to make changes after this point.<br/>All assessments need to be submitted through the dashboard.
        </p>

        <p style="text-align: right;">
            <button class="button button-large" name="confirm-submission" id="assessment-summary-submit" type="submit">Save assessment</button>
        </p>

    </form>
    </div>

    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>

<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />

</body>
</html>