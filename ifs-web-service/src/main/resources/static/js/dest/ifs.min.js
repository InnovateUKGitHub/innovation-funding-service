var IFS={};IFS.autoSave=function(){"use strict";var e,t=[];return{settings:{inputs:'.form-serialize-js input:not([type="button"],[readonly="readonly"])',textareas:'.form-serialize-js textarea:not([readonly="readonly"])',typeTimeout:500,minimumUpdateTime:1e3},init:function(){e=this.settings;var t=e.inputs+","+e.textareas;jQuery("body").on("change keyup",t,function(t){"keyup"==t.type?(clearTimeout(window.IFS.autoSave_timer),window.IFS.autoSave_timer=setTimeout(function(){IFS.autoSave.fieldChanged(t.target)},e.typeTimeout)):IFS.autoSave.fieldChanged(t.target)})},fieldChanged:function(e){var a=jQuery(e),n=a.attr("id"),i={value:a.val(),formInputId:n,fieldName:a.attr("name"),applicationId:jQuery(".form-serialize-js #application_id").val()},r=a.closest(".form-group"),o=r.find(".textarea-save-info"),s=(new Date).getTime(),l=jQuery("#application_id").val();0===o.length&&(r.find(".textarea-footer").append('<span class="textarea-save-info" />'),o=r.find(".textarea-save-info")),"undefined"!=typeof l&&jQuery.ajax({type:"POST",url:"/application/"+l+"/form/saveFormElement",data:i,dataType:"json",beforeSend:function(){o.html("Saving...")}}).done(function(e){var n=(new Date).getTime(),i=IFS.autoSave.settings.minimumUpdateTime-(n-s);jQuery("body").trigger("updateSerializedFormState"),"true"==e.success?setTimeout(function(){IFS.autoSave.clearServerSideValidationErrors(a),o.html("Saved!")},i):setTimeout(function(){IFS.autoSave.clearServerSideValidationErrors(a),o.html("Invalid input, but saved anyway."),jQuery.each(e.validation_errors,function(e,n){IFS.formValidation.setInvalid(a,n),t.push(n)})},i)}).fail(function(e){var n=(new Date).getTime(),i=IFS.autoSave.settings.minimumUpdateTime-(n-s);setTimeout(function(){var n=e.responseJSON.errorMessage;if(r.length)if(o.length)o.html(n);else{var i=r.find("label").first();i.length&&(t.push(n),IFS.formValidation.setInvalid(a,n))}else a.addClass("error")},i)}).error(function(e){if("undefined"!=typeof e.responseText){var n=JSON.parse(e.responseText),i=n.error+" : "+n.message;t.push(i),IFS.formValidation.setInvalid(a,i),o.html("")}})},clearServerSideValidationErrors:function(e){for(var a=0;a<t.length;a++)IFS.formValidation.setValid(e,t[a])}}}(),IFS.closeCss=function(){"use strict";var e;return{settings:{isOpenCssClass:"is-open",timeOpen:3e3},init:function(){e=this.settings,IFS.closeCss.removeCssClass(e.isOpenCssClass,e.timeOpen)},removeCssClass:function(e,t){var a=jQuery("."+e);a.length&&setTimeout(function(){a.removeClass(e)},t)}}}(),IFS.collapsible=function(){"use strict";var e;return{settings:{collapsibleEl:".collapsible > h2, .collapsible > h3, .assign-container .assign-button"},init:function(){e=this.settings,IFS.collapsible.collapsibleWithinScope(jQuery(document))},collapsibleWithinScope:function(t){var a=t.find("[data-collapsible-id]"),n=0;a.each(function(e,t){var a=t.attr("data-collapsible-id");n=Math.max(n,parseInt(a))}),t.find(e.collapsibleEl).each(function(e,t){var a=jQuery(t);IFS.collapsible.addCollapsibleBehaviourToElement(a,e,n+1)})},addCollapsibleBehaviourToElement:function(e,t,a){var n="collapsible-"+(t+a),i=e.hasClass("open"),r=!1;e.closest(".collapsible").hasClass("js-close-others")&&(r=!0),e.nextUntil("h2").wrapAll('<div id="'+n+'" aria-hidden="'+!i+'">');var o=e.next();e.wrapInner('<button aria-expanded="'+i+'" aria-controls="'+n+'" type="button">');var s=e.children("button");s.off("click").on("click",function(){var e="false"===jQuery(this).attr("aria-expanded")?!0:!1;r&&(jQuery(".collapsible [aria-expanded]").attr("aria-expanded","false"),jQuery(".collapsible [aria-hidden]").attr("aria-hidden","true")),jQuery(this).attr("aria-expanded",e),o.attr("aria-hidden",!e)})}}}(),IFS.conditionalForms=function(){"use strict";return{init:function(){jQuery("label[data-target]").each(function(){var e=jQuery(this),t=e.attr("data-target"),a=e.find('input[type="radio"],input[type="checkbox"]'),n=!1;if(e.attr("data-target-inverted")&&(n=!0),a&&t){var i=a.attr("name");a.attr("aria-controls",t),IFS.conditionalForms.toggleVisibility(a,"#"+t,n),jQuery('input[name="'+i+'"]').on("click",function(){IFS.conditionalForms.toggleVisibility(a,"#"+t,n)})}})},toggleVisibility:function(e,t,a){t=jQuery(t);var n=e.is(":checked");a&&(n=!n),n?(e.attr("aria-expanded","true"),t.attr("aria-hidden","false").removeClass("js-hidden")):(e.attr("aria-expanded","false"),t.attr("aria-hidden","true"))}}}(),IFS.editor=function(){"use strict";var e,t;return{settings:{textareas:".textarea-wrapped textarea",htmlOptions:{format:!1,allowedTags:["p","em","strong","ol","ul","li","br","b","div"]}},init:function(){e=this.settings,t=new showdown.Converter;var a=jQuery(e.textareas);jQuery.each(a,function(){IFS.editor.prepareEditor(this)}),IFS.editor.initEditors(),IFS.editor.bindEditors()},prepareEditor:function(e){var t=jQuery(e);t.attr("readonly")?t.before('<div class="readonly"></div>'):t.before('<div class="editor" spellcheck="true"></div>'),t.attr("aria-hidden","true"),IFS.editor.processMarkdownToHtml(t,t.prev())},initEditors:function(){jQuery(".editor").hallo({plugins:{halloformat:{},hallolists:{},hallocleanhtml:e.htmlOptions},toolbar:"halloToolbarFixed"})},bindEditors:function(){jQuery(".editor").bind("hallomodified",function(e,t){var a=jQuery(this).next();IFS.editor.processHtmlToMarkdown(t.content,a),jQuery(a).trigger("keyup")})},processMarkdownToHtml:function(e,t){var a=e.val();if(IFS.editor.htmlToMarkdown(jQuery(t).html())!=a){var n=IFS.editor.markdownToHtml(a);jQuery(t).html(n)}},processHtmlToMarkdown:function(e,t){var a=IFS.editor.htmlToMarkdown(e);jQuery(t).get(0).value!=a&&(jQuery(t).get(0).value=a)},htmlToMarkdown:function(t){var a=jQuery.trim(t.replace(/(\r\n|\n|\r)/gm,""));return a=jQuery.htmlClean(a,e.htmlOptions),md(a)},markdownToHtml:function(e){var a;return a=0===e.length?"<p>&nbsp;</p>":t.makeHtml(e)}}}(),IFS.finance=function(){"use strict";return{MathOperation:{"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return 0===t?0:e/t}},init:function(){IFS.finance.bindCalculationActionToFields(),IFS.finance.sectionInfoInHeader(),IFS.finance.mirrorInputs(),jQuery("body").append(jQuery('<input type="hidden" id="hundred-field" value="100" />'))},bindCalculationActionToFields:function(){var e=function(e,t){var a=e.attr("data-calculation-fields").split(","),n=a.map(function(e){return jQuery(e)}),i=n.reduce(function(e,t){return jQuery.merge(e,t)}),r=function(e){return e instanceof jQuery?e.attr("id"):jQuery(e).attr("id")};-1!==i.toArray().map(r).indexOf(r(t))&&IFS.finance.doMath(e,i)};jQuery("body").on("change","input",function(){var t=jQuery(this),a=jQuery("[data-calculation-fields]");a.each(function(a,n){var i=jQuery(n);e(i,t)})})},doMath:function(e,t){for(var a=e.attr("data-calculation-operations").split(","),n=[],i=0;i<t.length;i++){var r=jQuery(t[i]),o=r.attr("data-calculation-rawvalue");if("undefined"!=typeof o)n.push(parseFloat(o));else{var s=r.val();if("undefined"!=typeof s&&s.length>0){var l=0===s.indexOf("£ ")?s.substring(2):s;n.push(parseFloat(l))}else n.push(parseFloat(0))}}var d;if(d=1===n.length?n[0]:IFS.finance.MathOperation[a[0]](n[0],n[1]),1==a.length&&n.length>2)for(i=2;i<n.length;i++)d=IFS.finance.MathOperation[a[0]](d,n[i]);else if(a.length>1&&n.length>2)for(i=1;i<a.length;i++)d=IFS.finance.MathOperation[a[i]](d,n[i+1]);e.attr("data-calculation-rawvalue",d);var u=IFS.finance.formatCurrency(Math.round(d));e.is("span")?e.text(u):e.val(u),e.trigger("change")},formatCurrency:function(e){return e=parseFloat(e,10),e=e.toFixed(),e=e.replace(/(\d)(?=(\d{3})+\b)/g,"$1,"),"£ "+e.toString()},mirrorInputs:function(){jQuery("body").on("change","[data-binding-input]",function(){var e=jQuery(this),t=e.attr("data-binding-input"),a=jQuery('[data-binding-output="'+t+'"]');a.each(function(){var t=jQuery(this);t.is("span")?t.text(e.val()):t.val(e.val())})})},sectionInfoInHeader:function(){jQuery(".place-in-header").each(function(){var e=jQuery(this),t=e.attr("data-subsection-id"),a=jQuery("[data-subsection-header="+t+"]");e.detach(),a.append(e),e.show()})}}}(),IFS.formValidation=function(){"use strict";var e;return{settings:{number:{fields:'[type="number"]',messageInvalid:"This field should be a number"},min:{fields:"[min]",messageInvalid:"This field should be %min%% or higher"},max:{fields:"[max]",messageInvalid:"This field should be %max%% or lower"},password:{field1:'[name="password"]',field2:'[name="retypedPassword"]',messageInvalid:"Passwords must match"},email:{fields:'[type="email"]',messageInvalid:"Please enter a valid emailaddress"},typeTimeout:800},init:function(){e=this.settings,IFS.formValidation.initPasswordCheck(),IFS.formValidation.initNumberCheck(),IFS.formValidation.initEmailCheck(),IFS.formValidation.initMinCheck(),IFS.formValidation.initMaxCheck()},initPasswordCheck:function(){jQuery("body").on("change keyup",e.password.field1+","+e.password.field2,function(t){"keyup"==t.type?(clearTimeout(window.IFS.formValidation_timer),window.IFS.formValidation_timer=setTimeout(function(){IFS.formValidation.checkPasswords()},e.typeTimeout)):IFS.formValidation.checkPasswords()})},checkPasswords:function(){var t=jQuery(e.password.field1),a=jQuery(e.password.field2);t.length&&a.length&&t.val().length&&a.val().length&&(t.val()==a.val()?(IFS.formValidation.setValid(t,e.password.messageInvalid),IFS.formValidation.setValid(a,e.password.messageInvalid)):(IFS.formValidation.setInvalid(t,e.password.messageInvalid),IFS.formValidation.setInvalid(a,e.password.messageInvalid)))},initEmailCheck:function(){jQuery("body").on("change keyup",e.email.fields,function(t){var a=jQuery(t.target);"keyup"==t.type?(clearTimeout(window.IFS.formValidation_timer),window.IFS.formValidation_timer=setTimeout(function(){IFS.formValidation.checkEmail(a)},e.typeTimeout)):IFS.formValidation.checkEmail(a)})},checkEmail:function(t){var a=t.val(),n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i,i=n.test(a);i?IFS.formValidation.setValid(t,e.email.messageInvalid):IFS.formValidation.setInvalid(t,e.email.messageInvalid)},initNumberCheck:function(){jQuery("body").on("change",e.number.fields,function(){IFS.formValidation.checkNumber(jQuery(this))})},checkNumber:function(t){return jQuery.isNumeric(t.val())?(IFS.formValidation.setValid(t,e.number.messageInvalid),!0):(IFS.formValidation.setInvalid(t,e.number.messageInvalid),!1)},initMaxCheck:function(){jQuery("body").on("change",e.max.fields,function(){IFS.formValidation.checkMax(jQuery(this))})},checkMax:function(t){var a=parseInt(t.attr("max"));if(IFS.formValidation.checkNumber(t)){var n=parseInt(t.val());n>a?IFS.formValidation.setInvalid(t,e.max.messageInvalid.replace("%max%",a)):IFS.formValidation.setValid(t,e.max.messageInvalid.replace("%max%",a))}},initMinCheck:function(){jQuery("body").on("change",e.min.fields,function(){IFS.formValidation.checkMin(jQuery(this))})},checkMin:function(t){var a=parseInt(t.attr("min"));if(IFS.formValidation.checkNumber(t)){var n=parseInt(t.val());a>n?IFS.formValidation.setInvalid(t,e.min.messageInvalid.replace("%min%",a)):IFS.formValidation.setValid(t,e.min.messageInvalid.replace("%min%",a))}},setInvalid:function(e,t){var a=e.closest(".form-group");if(a){e.addClass("field-error");var n=a.find('.error-message:contains("'+t+'")');if(0===n.length){a.addClass("error");var i='<span class="error-message">'+t+"</span>";a.find("label").first().append(i)}}},setValid:function(e,t){var a=e.closest(".form-group.error");a&&(e.removeClass("field-error"),a.find('.error-message:contains("'+t+'")').remove(),0===a.find(".error-message").length&&a.removeClass("error"))}}}(),IFS.modal=function(){"use strict";var e;return{settings:{element:"[data-js-modal]"},init:function(){e=this.settings,jQuery(e.element).length&&(IFS.modal.initModals(),IFS.modal.modalCloseLink())},initModals:function(){jQuery("body").on("click",e.element,function(e){e.preventDefault();var t=jQuery(this).attr("data-js-modal");t=jQuery("."+t),t.length&&(e.preventDefault(),IFS.modal.disableTabPage(),t.add(".modal-overlay").attr("aria-hidden","false"),setTimeout(function(){var e=t.outerHeight();t.css({"margin-top":"-"+e/2+"px"})},50))})},disableTabPage:function(){jQuery(":tabbable").each(function(){var e=jQuery(this);if(0===e.closest('[role="dialog"]').length){var t=0;e.prop("tabindex")&&(t=e.prop("tabindex")),e.prop("tabindex","-1").attr("data-original-tabindex",t)}})},enableTabPage:function(){jQuery("[data-original-tabindex]").each(function(){var e=jQuery(this),t=e.attr("data-original-tabindex");e.prop("tabindex",t).removeAttr("data-original-tabindex")})},modalCloseLink:function(){jQuery("body").on("click",".js-close",function(){IFS.modal.enableTabPage(),jQuery('[role="dialog"],.modal-overlay').attr("aria-hidden","true")})}}}(),IFS.pieChart=function(){"use strict";var e;return{settings:{pieElement:".pie"},init:function(){e=this.settings,Modernizr.svg&&Modernizr.inlinesvg&&jQuery(e.pieElement).each(function(){IFS.pieChart.pieSVG(this)})},pieSVG:function(e){var t=parseFloat(e.textContent),a="http://www.w3.org/2000/svg",n=document.createElementNS(a,"svg"),i=document.createElementNS(a,"circle"),r=document.createElementNS(a,"title");i.setAttribute("r",16),i.setAttribute("cx",16),i.setAttribute("cy",16),i.setAttribute("stroke-dasharray",t+" 100"),n.setAttribute("viewBox","0 0 32 32"),r.textContent=e.textContent,e.textContent="",n.appendChild(r),n.appendChild(i),e.appendChild(n)}}}(),IFS.repeatableRows=function(){"use strict";return{init:function(){jQuery("body").on("click","[data-repeatable-container] .add-another-row",IFS.repeatableRows.addCostsRowHandler),jQuery("body").on("click","[data-repeatable-container] .delete-row",IFS.repeatableRows.removeCostsRowHandler)},generateFragmentUrl:function(e){var t,a=e.attr("href"),n=a.split("?"),i=n[0],r=2==n.length?"&"+n[1]:"",o=e.closest(".question");-1!==o.attr("id").indexOf("form-input-")&&(t=o.attr("id").replace("form-input-",""));var s=i+"/"+t+"?singleFragment=true"+r;return s},addCostsRowHandler:function(e){var t=jQuery(this),a=IFS.repeatableRows.generateFragmentUrl(t),n=t.closest("[data-repeatable-container]"),i=n.attr("data-repeatable-container");return jQuery.ajax({url:a,beforeSend:function(){t.before('<span class="form-hint">Adding a new row</span>')}}).done(function(e){var t=jQuery("<div>"+e+"</div>"),a=t.find("[data-repeatable-container="+i+"]");n.replaceWith(a),jQuery("body").trigger("updateSerializedFormState")}),e.preventDefault(),!1},removeCostsRowHandler:function(e){var t=jQuery(this),a=IFS.repeatableRows.generateFragmentUrl(t);return jQuery.get(a,function(){var e=t.attr("data-cost-row"),a=jQuery("[data-cost-row="+e+"]"),n=t.closest("[data-repeatable-container]");a.remove(),n.find("[data-calculation-fields]").each(function(){var e=jQuery(this);e.attr({"data-calculation-rawvalue":0,value:"£ 0"}).val("£ 0");var t=e.attr("data-calculation-fields");jQuery(t).trigger("change")}),jQuery("body").trigger("updateSerializedFormState")}),e.preventDefault(),!1}}}(),IFS.unsavedChanges=function(){"use strict";var e;return{settings:{formelement:jQuery(".form-serialize-js")},init:function(){e=this.settings,IFS.unsavedChanges.initUnsavedChangesWarning(),IFS.unsavedChanges.updateSerializedFormState(),jQuery("body").on("updateSerializedFormState",function(){IFS.unsavedChanges.updateSerializedFormState()})},updateSerializedFormState:function(){e.formelement.data("serializedFormState",jQuery(".form-serialize-js").serialize())},initUnsavedChangesWarning:function(){var t=!1;e.formelement.on("submit",function(){t=!0}),jQuery(window).bind("beforeunload",function(e){return t===!1&&jQuery(".form-serialize-js").serialize()!=jQuery(".form-serialize-js").data("serializedFormState")?"Are you sure you want to leave this page? There are some unsaved changes...":void(e=null)})}}}(),IFS.wordCount=function(){"use strict";var e;return{settings:{wordcountEl:".word-count textarea",typeTimeout:500},init:function(){e=this.settings,jQuery("body").on("change keyup",e.wordcountEl,function(t){"keyup"==t.type?(clearTimeout(window.IFS.wordcount_timer),window.IFS.wordcount_timer=setTimeout(function(){IFS.wordCount.updateWordCount(t.target)},e.typeTimeout)):IFS.wordCount.updateWordCount(t.target)})},updateWordCount:function(e){var t=jQuery(e),a=t.val();a=a.replace(/(\r\n|\n|\r)/gm," "),a=a.replace(/([[0-9]+\.\ |\*\ |\*\*|_)/gm,"");for(var n=jQuery.trim(a).split(" "),i=0,r=0;r<n.length;r++)n[r].length>0&&i++;var o=t.attr("data-max_words")-i,s=t.parents(".word-count").find(".count-down");s.html(o),0>o?s.removeClass("positive").addClass("negative"):s.removeClass("negative").addClass("positive")}}}(),IFS.application_page=function(){"use strict";return{init:function(){jQuery(document).on("click",'form.application-overview [name="assign_question"]',IFS.application_page.handleAssignQuestionFragmentReload)},handleAssignQuestionFragmentReload:function(e){var t,a=jQuery(this),n=a.closest("form.application-overview"),i=a.closest("li.section");-1!==i.closest("section").prop("id").indexOf("section-")&&(t=i.closest("section").attr("id").replace("section-",""));var r=function(e){var t=jQuery("<div>"+e+"</div>"),a=i.attr("id"),n=t.find("#"+a);i.replaceWith(n),IFS.collapsible.collapsibleWithinScope(n)};return i.length&&t&&jQuery.ajax({type:"POST",url:"?singleFragment=true&sectionId="+t,data:n.serialize()+"&"+a.attr("name")+"="+a.attr("value"),success:function(e){r(e)}}),e.preventDefault(),!1}}}(),IFS.assesment_feedback_page=function(){"use strict";return{init:function(){jQuery("body").on("change",'[id ^= "assessor-question-feedback-text-"],[data-feedback-value]',IFS.assesment_feedback_page.handleAssessorFeedbackUpdate),jQuery("body").on("keyup",'[id ^= "assessor-question-feedback-"]',IFS.assesment_feedback_page.registerKeyupCallback(IFS.assesment_feedback_page.handleAssessorFeedbackFieldChangeOnField,500))},registerKeyupCallback:function(e,t){return function(a){var n=jQuery(this),i=n.data("keyupListener");"undefined"!=typeof i&&window.clearTimeout(i),n.data("keyupListener",window.setTimeout(function(){e(n,a),n.data("keyupListener",null)},t))}},handleAssessorFeedbackFieldChangeOnField:function(e){var t=e.closest("form").attr("action"),a=e.closest("[data-response-id]"),n=a.attr("data-response-id"),i=a.find('[id ^= "assessor-question-feedback-text-"]').val(),r=a.find("[data-feedback-value]").val(),o=e.closest(".form-group"),s=o.find(".textarea-save-info"),l=(new Date).getTime();0===s.length&&(o.find(".textarea-footer").append('<span class="textarea-save-info" />'),s=o.find(".textarea-save-info")),jQuery.ajax({type:"PUT",url:t+"/response/"+n+"?feedbackText="+i+"&feedbackValue="+r,beforeSend:function(){s.html("Saving...")}}).done(function(e){var t=(new Date).getTime();"ok"==e.message?1500>t-l?setTimeout(function(){s.html("Saved!")},1500):s.html("Saved!"):s.html(e.message).css({color:"red"})})},handleAssessorFeedbackUpdate:function(){var e=jQuery(this);return IFS.assesment_feedback_page.handleAssessorFeedbackFieldChangeOnField(e)}}}(),IFS.assesment_submit_review_page=function(){"use strict";return{init:function(){IFS.assesment_submit_review_page.suitableForFundingChange(),IFS.assesment_submit_review_page.beforeSubmitCheck()},suitableForFundingChange:function(){jQuery("#suitable-for-funding").change(function(){var e=jQuery("#suitable-for-funding option:selected").val(),t=jQuery("#recommendation-feedback-group");e=t.show(),jQuery("#not-suitable-feedback").prop("required","no"==e)}).trigger("change")},beforeSubmitCheck:function(){jQuery("#submission_questions").submit(function(e){var t=jQuery("#suitable-for-funding option:selected").val(),a=""===jQuery("#not-suitable-feedback").val().trim();return"no"==t&&a?(e.preventDefault(),jQuery("#feedback-empty-error").text("Please justify your decision...").show(),!1):void jQuery("#feedback-empty-error").hide()})}}}(),IFS.orgsizeToFunding=function(){"use strict";var e;return{settings:{funderOrgsizeInputs:'[name="financePosition-organisationSize"]',fundingLevelInput:"#cost-financegrantclaim",orgToFundingMapping:{SMALL:70,MEDIUM:60,LARGE:50}},init:function(){e=this.settings,jQuery("body").on("change",e.funderOrgsizeInputs,function(){var t=jQuery(this).val(),a=jQuery(e.fundingLevelInput);if(a.length&&"undefined"!=typeof e.orgToFundingMapping[t]){a.attr("max",e.orgToFundingMapping[t]).removeClass("field-error");var n=a.closest(".form-group");n.removeClass("error"),n.find(".error-message").remove(),a.trigger("change")}})}}}(),IFS.invites=function(){"use strict";var e;return{settings:{formid:".contributorsForm",inputs:".contributorsForm input",addRow:".contributorsForm .add-another-row",removeRow:".contributorsForm .remove-another-row",addOrg:'[name="add_partner"]'},init:function(){e=this.settings,jQuery("body").on("change",e.inputs,function(){IFS.invites.saveToCookie()}),jQuery("body").on("click",e.addRow,function(e){IFS.invites.addRow(e)}),jQuery("body").on("click",e.removeRow,function(e){IFS.invites.removeRow(e)}),jQuery("body").on("click",e.addOrg,function(e){IFS.invites.addOrg(e)})},saveToCookie:function(){var t=jQuery(e.formid).serialize();jQuery.ajax({url:window.location.href,method:"POST",dataType:"json",data:t})},addRow:function(e){e.preventDefault();var t=jQuery(e.target).closest("[data-invite-org]"),a=t.index(),n=t.find("[data-invite-row]").length,i='<tr class="form-group" data-invite-row>                        <td><input type="text" class="form-control width-full" value="" placeholder="name" name="organisations['+a+"].invites["+n+'].personName" /></td>                        <td><input type="email" class="form-control width-full" value="" placeholder="name@company.co.uk" name="organisations['+a+"].invites["+n+'].email" /></td>                        <td class="alignright"><button value="'+a+"_"+n+'" name="remove_person" type="submit" class="remove-another-row buttonlink">Remove</button></td>                      </tr>';t.find("tbody").append(i),IFS.invites.saveToCookie()},addOrg:function(e){e.preventDefault();var t=jQuery("[data-invite-org]"),a=t.length,n='<li data-invite-org>                    <h2 class="heading-medium">Partner Organisation "<input type="text" value="" name="organisations['+a+'].organisationName" placeholder="Organisation Name" class="form-control width-large">"</h2>                          <input type="hidden" value="" name="organisations['+a+'].organisationId" placeholder="name" class="form-control width-full">                          <table>                              <thead><tr>                                  <th>Name</th>                                  <th>E-mail</th>                                  <th>&nbsp;</th>                              </tr></thead>                              <tbody>                              <tr data-invite-row class="form-group">                                  <td><input type="text" value="" name="organisations['+a+'].invites[0].personName"  placeholder="name" class="form-control width-full"></td>                                  <td><input type="email" value="" name="organisations['+a+'].invites[0].email" placeholder="name@company.co.uk" class="form-control width-full"></td>                                  <td class="alignright"><button value="'+a+'_0" name="remove_person" type="submit" class="remove-another-row buttonlink">Remove</button></td>                              </tr>                              </tbody>                          </table>                          <p class="alignright">                              <button value="'+a+'" name="add_person" type="submit" class="add-another-row buttonlink">Add person</button>                          </p>                      </li>';t.last().after(n),IFS.invites.saveToCookie()},recountRows:function(){jQuery("[data-invite-org] input").each(function(){var e=jQuery(this),t=e.closest("[data-invite-org]").index(),a=e.closest("[data-invite-row]").index(),n=e.attr("name");if("undefined"!=typeof n){var i=n.split(".");-1!==a&&-1!==t?(0===t&&a--,i[0]="organisations["+t+"]",i[1]="invites["+a+"]"):-1!==t&&(i[0]="organisations["+t+"]"),i=i.join("."),e.attr("name",i)}}),IFS.invites.saveToCookie()},removeRow:function(e){e.preventDefault();var t=jQuery(e.target);1==t.closest("[data-invite-org]").find("tbody tr").length?(console.log("a"),t.closest("[data-invite-org]").remove()):(console.log("b"),t.closest("tr").remove()),IFS.invites.recountRows()}}}(),IFS.repeatableRows=function(){"use strict";return{init:function(){jQuery("body").on("click","[data-repeatable-container] .add-another-row",IFS.repeatableRows.addCostsRowHandler),jQuery("body").on("click","[data-repeatable-container] .delete-row",IFS.repeatableRows.removeCostsRowHandler)},generateFragmentUrl:function(e){var t,a=e.attr("href"),n=a.split("?"),i=n[0],r=2==n.length?"&"+n[1]:"",o=e.closest(".question");-1!==o.attr("id").indexOf("form-input-")&&(t=o.attr("id").replace("form-input-",""));var s=i+"/"+t+"?singleFragment=true"+r;return s},addCostsRowHandler:function(e){var t=jQuery(this),a=IFS.repeatableRows.generateFragmentUrl(t),n=t.closest("[data-repeatable-container]"),i=n.attr("data-repeatable-container");return jQuery.ajax({url:a,beforeSend:function(){t.before('<span class="form-hint">Adding a new row</span>')}}).done(function(e){var t=jQuery("<div>"+e+"</div>"),a=t.find("[data-repeatable-container="+i+"]");n.replaceWith(a),jQuery("body").trigger("updateSerializedFormState")}),e.preventDefault(),!1},removeCostsRowHandler:function(e){var t=jQuery(this),a=IFS.repeatableRows.generateFragmentUrl(t);return jQuery.get(a,function(){var e=t.attr("data-cost-row"),a=jQuery("[data-cost-row="+e+"]"),n=t.closest("[data-repeatable-container]");a.remove(),n.find("[data-calculation-fields]").each(function(){var e=jQuery(this);e.attr({"data-calculation-rawvalue":0,value:"£ 0"}).val("£ 0");var t=e.attr("data-calculation-fields");jQuery(t).trigger("change")}),jQuery("body").trigger("updateSerializedFormState")}),e.preventDefault(),!1}}}();var IFSLoader={common:{init:function(){IFS.collapsible.init(),IFS.conditionalForms.init(),IFS.wordCount.init(),IFS.editor.init(),IFS.formValidation.init()},finalize:function(){IFS.pieChart.init(),IFS.modal.init(),IFS.closeCss.init()}},"app-form":{init:function(){IFS.unsavedChanges.init(),IFS.autoSave.init(),IFS.finance.init(),IFS.repeatableRows.init(),IFS.orgsizeToFunding.init()}},"app-details":{init:function(){IFS.application_page.init()}},"assessment-details":{init:function(){IFS.assesment_feedback_page.init()}},"assessment-submit-review":{init:function(){IFS.assesment_submit_review_page.init()}},"app-invite":{init:function(){IFS.invites.init()}}},UTIL=function(){"use strict";return{fire:function(e,t,a){var n=IFSLoader;t=void 0===t?"init":t,""!==e&&n[e]&&"function"==typeof n[e][t]&&n[e][t](a)},loadEvents:function(){var e=document.body.id;UTIL.fire("common"),jQuery.each(document.body.className.split(/\s+/),function(t,a){UTIL.fire(a),UTIL.fire(a,e)}),UTIL.fire("common","finalize")}}}();jQuery(document).ready(function(){UTIL.loadEvents()});