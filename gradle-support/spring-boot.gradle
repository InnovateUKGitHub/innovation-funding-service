apply from: rootProject.file("gradle-support/java.gradle")

apply plugin: 'io.spring.dependency-management'
apply plugin: 'org.springframework.boot'

ext.isStubDevMode = { ->
    if (System.getenv("SPRING_PROFILES_ACTIVE").equals("STUBDEV")) {
        println("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")
        println("XXXXXXXXX Compiling Dev Mode XXXXXXXXXX")
        println("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")
        return true
    }
    return false
}

dependencies {

    // Enforced platform is composite of IFS libraries, spring boot and spring cloud
    implementation enforcedPlatform (project(':common:bom'))

    // https://github.com/spring-projects/spring-data-jpa/issues/2472
    // Remove me when 5.6.9.Final is released and in spring boot release train (at least 2.6.8)
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'

    implementation "org.springframework.boot:spring-boot-starter-actuator"
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation project(":common:starter:ifs-starter-logging")

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

springBoot {
    buildInfo {
        properties {
            additional = [
                    'buildNumber': java.util.Optional.ofNullable(System.getenv("bamboo_buildNumber")).orElse("[not available]"),
                    'gitCommitId': java.util.Optional.ofNullable(System.getenv("bamboo_planRepository_revision")).orElse("[not available]"),
                    'gitBranch': java.util.Optional.ofNullable(System.getenv("bamboo_planRepository_branchName")).orElse("[not available]")
            ]
        }
    }
}

