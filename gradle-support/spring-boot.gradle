apply from: rootProject.file("gradle-support/java.gradle")

apply plugin: 'io.spring.dependency-management'
apply plugin: 'org.springframework.boot'

ext.isStubDevMode = { ->
    if (System.getenv("SPRING_PROFILES_ACTIVE") != null && System.getenv("SPRING_PROFILES_ACTIVE").contains("STUBDEV")) {
        println("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")
        println("XXXXXXXXX Compiling Dev Mode XXXXXXXXXX")
        println("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")
        return true
    }
    return false
}

dependencies {

    // Enforced platform is composite of IFS libraries, spring boot and spring cloud
    implementation enforcedPlatform (project(':common:bom'))

    implementation "org.springframework.boot:spring-boot-starter-actuator"
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation project(":common:starter:ifs-starter-logging")

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

springBoot {
    buildInfo {
        properties {
            additional = [
                    'buildNumber': java.util.Optional.ofNullable(System.getenv("bamboo_buildNumber")).orElse("[not available]"),
                    'gitCommitId': java.util.Optional.ofNullable(System.getenv("bamboo_planRepository_revision")).orElse("[not available]"),
                    'gitBranch': java.util.Optional.ofNullable(System.getenv("bamboo_planRepository_branchName")).orElse("[not available]")
            ]
        }
    }
}

