apiVersion: skaffold/v2beta11
kind: Config
metadata:
  name: innovation-funding-service
build:
  artifacts:
    - image: data-service
      context: .
      jib:
        type: gradle
        project: ifs-data-layer:ifs-data-service
        args:
          - -DskipTests
          - --no-daemon
    - image: sil-stub
      context: .
      jib:
        type: gradle
        project: ifs-sil-stub
        args:
          - -DskipTests
          - --no-daemon
    - image: registration-service
      context: .
      jib:
        type: gradle
        project: ifs-registration-service
        args:
          - -DskipTests
          - --no-daemon
    - image: finance-data-service
      context: .
      jib:
        type: gradle
        project: ifs-data-layer:ifs-finance-data-service
        args:
          - -DskipTests
          - --no-daemon
    - image: survey-data-service
      context: .
      jib:
        type: gradle
        project: ifs-data-layer:ifs-survey-data-service
        args:
          - -DskipTests
          - --no-daemon
    - image: data-service-alerts
      context: .
      jib:
        type: gradle
        project: ifs-data-layer:data-service-alerts
        args:
          - -DskipTests
          - --no-daemon
    - image: survey-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-survey-service
        args:
          - -DskipTests
          - --no-daemon
    - image: project-setup-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-project-setup-service
        args:
          - -DskipTests
          - --no-daemon
    - image: project-setup-mgt-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-project-setup-mgt-service
        args:
          - -DskipTests
          - --no-daemon
    - image: front-door-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-front-door-service
        args:
          - -DskipTests
          - --no-daemon
    - image: competition-mgt-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-competition-mgt-service
        args:
          - -DskipTests
          - --no-daemon
    - image: assessment-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-assessment-service
        args:
          - -DskipTests
          - --no-daemon
    - image: application-service
      context: .
      jib:
        type: gradle
        project: ifs-web-service:ifs-application-service
        args:
          - -DskipTests
          - --no-daemon
  local:
    # Experiment with build concurrency
    # 2/3 seems to be the sweet spot and build takes 2 mins
    concurrency: 2
    useDockerCLI: true
    useBuildkit: false
    tryImportMissing: true
    push: false
deploy:
  statusCheckDeadlineSeconds: 600
  kustomize:
    paths:
      - os-files/kustomize/env/stub/local/dev
