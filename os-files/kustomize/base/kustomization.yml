apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

commonAnnotations:
  deployedWith: kustomize
  environment: base

patches:
- path: patches/health-check-patch.yml
  target:
    kind: Deployment
    annotationSelector: "monitor=monitor"

- path: patches/spring-profiles-active-env.yml
  target:
    kind: Deployment
    annotationSelector: "monitor=monitor"

- path: data-layer/patches/db-rolling-update-patch.yml
  target:
    kind: Deployment
    annotationSelector: "waitForDb=waitForDb"

resources:
###############################################################################
############### Auth ##########################################################
###############################################################################
  - auth/idp/idp.yml
  - auth/idp/idp-deployment.yml
  - auth/idp/sp-secrets.yml
  - auth/idp/idp-keys-secrets.yml
  - auth/idp/idp-config.yml
  - auth/idp/shibboleth-config.yml
  - auth/ldap/ldap.yml
  - auth/ldap/ldap-deployment.yml
  - auth/ldap/ldap-config.yml
  - auth/ldap/ldap-keys-secrets.yml
  - auth/sp/sp.yml
  - auth/sp/sp-deployment.yml

  - auth/sp/sp-keys-secrets.yml

###############################################################################
###############################################################################

###############################################################################
############### Data Services #################################################
###############################################################################
  - data-layer/db-config.yml
  # data service
  - data-layer/data-service/data-service.yml
  - data-layer/data-service/data-service-config.yml
  - data-layer/data-service/data-service-deployment.yml
  # data service alerts
  - data-layer/data-service-alerts/data-service-alerts.yml
  - data-layer/data-service-alerts/data-service-alerts-deployment.yml
  # finance data service
  - data-layer/finance-data-service/finance-data-service.yml
  - data-layer/finance-data-service/finance-data-service-config.yml
  - data-layer/finance-data-service/finance-data-service-deployment.yml
  # survey data service
  - data-layer/survey-data-service/survey-data-service.yml
  - data-layer/survey-data-service/survey-data-service-deployment.yml
  # application service
  - data-layer/application-service/application-service.yml
  - data-layer/application-service/application-service-deployment.yml

################################################################################
################################################################################

###############################################################################
############### Web Layer #####################################################
###############################################################################

################################################################################
################################################################################

  # config-maps
  - cache-config.yml
  - feature-toggle-config.yml
  - new-relic-config.yml
  - web-config.yml
  - docusign-config.yml
  - flyway-config.yml


