
buildscript {

    repositories {
        maven { url "https://repo.spring.io/milestone" }
        maven { url "https://plugins.gradle.org/m2/"}
        mavenCentral()

    }
}

repositories {
    maven { url "https://repo.spring.io/milestone" }
    maven { url "https://plugins.gradle.org/m2/"}
    mavenCentral()
}

task pullHub(type: Exec) {
    doFirst {
        commandLine 'docker', 'pull', 'docker-ifs.devops.innovateuk.org/releases/innovateuk/seleniumhub:1.0'
    }
}

task stopHub(type: Exec) {
    doFirst {
        ignoreExitValue = true
        commandLine 'docker', 'stop', 'hub'
    }
}

task removeHub(type: Exec, dependsOn: stopHub) {
    doFirst {
        ignoreExitValue = true
        commandLine 'docker', 'rm', 'hub'
    }
}

task deployHub(type: Exec, dependsOn: [pullHub, removeHub]) {
    doFirst {
        commandLine 'docker', 'run', '-d', '--name', 'hub', '-p', '4444:4444', '-p', '3000:3000',
                '-e', 'GRID_BROWSER_TIMEOUT=90000',
                '-e', 'GRID_TIMEOUT=100000',
                '--network=ifs',
                'docker-ifs.devops.innovateuk.org/releases/innovateuk/seleniumhub:1.0'
    }
    //docker run -d --name hub -p 4444:4444 -p 3000:3000 -e GRID_BROWSER_TIMEOUT=90000 -e GRID_TIMEOUT=100000 --network=ifs innovateuk/seleniumhub
}

task deployChrome(type: Exec) {
    doFirst {
        commandLine 'docker', 'pull', 'davidrums/node-chrome-debug-proxy:3.0.1-dysprosium'
    }
}

task stopChrome(type: Exec) {
    doFirst {
        ignoreExitValue = true
        commandLine 'docker', 'stop', 'chrome'
    }
}

task removeChrome(type: Exec, dependsOn: stopChrome) {
    doFirst {
        ignoreExitValue = true
        commandLine 'docker', 'rm', 'chrome'
    }
}

task runChrome(type: Exec, dependsOn: [pullChrome, removeChrome]) {
    doFirst {
        commandLine 'docker', 'run', '-d', '--name', 'chrome', '-p', '5900:5900',
                '-v', '/dev/shm:/dev/shm', '-e', 'NODE_MAX_SESSION=20',
                '-e', 'NODE_MAX_INSTANCES=20', '-e', 'NODE_REGISTER_CYCLE=600',
                '-e', 'HUB_PORT_4444_TCP_ADDR=hub', '-e', 'HUB_PORT_4444_TCP_PORT=4444',
                '-e', 'DBUS_SESSION_BUS_ADDRESS=/dev/null', '-e', 'no_proxy=localhost',
                '-e', 'HUB_ENV_no_proxy=localhost', '--network=ifs',
                'davidrums/node-chrome-debug-proxy:3.0.1-dysprosium'
    }
    // docker run -d --name chrome -p 5900:5900 -v /dev/shm:/dev/shm -e NODE_MAX_SESSION=20 -e NODE_MAX_INSTANCES=20 -e NODE_REGISTER_CYCLE=600 -e HUB_PORT_4444_TCP_ADDR=hub -e HUB_PORT_4444_TCP_PORT=4444 -e DBUS_SESSION_BUS_ADDRESS=/dev/null -e no_proxy=localhost -e HUB_ENV_no_proxy=localhost --network=ifs davidrums/node-chrome-debug-proxy:3.0.1-dysprosium
}
