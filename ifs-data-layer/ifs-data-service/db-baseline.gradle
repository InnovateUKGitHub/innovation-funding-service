import com.bmuschko.gradle.docker.tasks.image.*

buildscript {

    repositories {
        maven { url "https://repo.spring.io/milestone" }
        maven { url "https://plugins.gradle.org/m2/"}
        mavenCentral()
    }

    dependencies {
        classpath "com.bmuschko:gradle-docker-plugin:3.2.6"
    }

}


// use fully qualified class name
apply plugin: com.bmuschko.gradle.docker.DockerRemoteApiPlugin
task dbBaselineDockerEnv {
    dependsOn "build"

    def inputDir = project.file("$project.buildDir/docker-db-baseline")
    doFirst {
        copy {
            from file('src/main/docker/Dockerfile-dbbaseline')
            rename 'Dockerfile-dbbaseline', 'Dockerfile'
            into inputDir
        }
        copy {
            from file('src/main/resources')
            include 'db/**/*.sql'
            into inputDir
        }
        copy {
            from file("${rootProject.projectDir}/setup-files/scripts/docker/baseline-db.sh")
            into inputDir
        }
    }
}

task dbBaselineDocker(type: DockerBuildImage) {
    dependsOn "dbBaselineDockerEnv"
    tag = 'innovateuk/dbbaseline'
    inputDir = project.file("$project.buildDir/docker-db-baseline")
}